<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[idea操作]]></title>
      <url>/2018/02/12/idea%E6%93%8D%E4%BD%9C/</url>
      <content type="html"><![CDATA[<h1 id="1-idea操作"><a href="#1-idea操作" class="headerlink" title="1 idea操作"></a>1 idea操作</h1><h2 id="设置idea的eclipse模式的快捷键"><a href="#设置idea的eclipse模式的快捷键" class="headerlink" title="设置idea的eclipse模式的快捷键"></a>设置idea的eclipse模式的快捷键</h2><p>windows:Configure-&gt;setting-&gt;keymap-&gt;keymaps-&gt;eclipse<br>Mac:Configure-&gt;preferences-&gt;keymap-&gt;keymaps-&gt;eclipse(Mac OS X)<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/idea/idea1.gif" alt="idea1"></p>
<h2 id="设置idea的maven打包"><a href="#设置idea的maven打包" class="headerlink" title="设置idea的maven打包"></a>设置idea的maven打包</h2><p><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/idea/idea2.gif" alt="idea2"></p>
<h2 id="创建idea的web项目"><a href="#创建idea的web项目" class="headerlink" title="创建idea的web项目"></a>创建idea的web项目</h2><p><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/idea/idea3.gif" alt="idea3"><br> 创建的项目没法创建Java类，需要右键项目-&gt;Mark Directoys-&gt;sources root<br><a href="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/video/idea/idea.avi" target="_blank" rel="noopener">idea操作完整视频下载</a></p>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[IDEA中pom常见错误及解决方法]]></title>
      <url>/2018/02/10/IDEA%E4%B8%ADpom%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      <content type="html"><![CDATA[<h1 id="1-inspects-a-maven-model-for-resolution-problems"><a href="#1-inspects-a-maven-model-for-resolution-problems" class="headerlink" title="1 inspects a maven model for resolution problems"></a>1 inspects a maven model for resolution problems</h1><h2 id="第一种-找到pom-xml"><a href="#第一种-找到pom-xml" class="headerlink" title="第一种   找到pom.xml"></a>第一种   找到pom.xml</h2><pre><code>右击  --&gt; Maven --&gt; reImport
</code></pre><h2 id="第二种-查看jar包是否下载正确"><a href="#第二种-查看jar包是否下载正确" class="headerlink" title="第二种 查看jar包是否下载正确"></a>第二种 查看jar包是否下载正确</h2>]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hive sql]]></title>
      <url>/2018/02/06/Hive%20sql/</url>
      <content type="html"><![CDATA[<h1 id="分组top-N"><a href="#分组top-N" class="headerlink" title="分组top N"></a>分组top N</h1><p>Hive在0.11.0版本开始加入了row_number、rank、dense_rank分析函数，可以查询分组排序后的top值</p>
<p><strong>说明：</strong></p>
<p>row_number() over ([partition col1] [order by col2])</p>
<p>rank() over ([partition col1] [order by col2])</p>
<p>dense_rank() over ([partition col1] [order by col2])</p>
<p>它们都是根据col1字段分组，然后对col2字段进行排序，对排序后的每行生成一个行号，这个行号从1开始递增</p>
<p>col1、col2都可以是多个字段，用’,’分隔</p>
<p>区别：</p>
<p>1）row_number：不管col2字段的值是否相等，行号一直递增，比如：有两条记录的值相等，但一个是第一，一个是第二</p>
<p>3）dense_rank：上下两条记录的col2相等时，下一个col2值的行号递增1，比如：有两条并列第一，下一个是第二</p>
<p>row_number可以实现分页查询</p>
<p>实例：</p>
<ol>
<li><code>hive&gt; create table t(name string, sub string, score int) row format delimited fields terminated by &#39;\t&#39;;</code></li>
</ol>
<p>数据在附件的a.txt里</p>
<ol>
<li><code>a    chinese    98</code></li>
<li><code>a    english    90</code></li>
<li><code>d    chinese    88</code></li>
<li><code>c    english    82</code></li>
<li><code>c    math    98</code></li>
<li><code>b    math    89</code></li>
<li><code>b    chinese    79</code></li>
<li><code>z    english    90</code></li>
<li><code>z    math    89</code></li>
<li><code>z    chinese    80</code></li>
<li><code>e    math    99</code></li>
<li><code>e    english    87</code></li>
<li><code>d    english    90</code></li>
</ol>
<p><strong>1、row_number</strong></p>
<ol>
<li><code>hive (test)&gt; select *, row_number() over (partition by sub order by score) as od from t;</code></li>
</ol>
<p><strong>2、rank</strong></p>
<ol>
<li><code>hive (test)&gt; select *, rank() over (partition by sub order by score) as od from t;</code></li>
</ol>
<p><strong>3、dense_ran</strong></p>
<ol>
<li><code>hive (test)&gt; select *, dense_rank() over (partition by sub order by score desc) from t;</code></li>
</ol>
<p>业务实例：</p>
<p>统计每个学科的前三名</p>
<ol>
<li><code>select * from (select *, row_number() over (partition by sub order by score desc) as od from t ) t where od&lt;=3;</code></li>
</ol>
<p>语文成绩是80分的排名是多少</p>
<ol>
<li><code>hive (test)&gt; select od from (select *, row_number() over (partition by sub order by score desc) as od from t )t where sub=&#39;chinese&#39; and score=80;</code></li>
</ol>
<p>分页查询</p>
<ol>
<li><code>hive (test)&gt; select * from (select *, row_number() over () as rn from t) t1 where rn between 1 and 5;</code></li>
</ol>
<h1 id="UV"><a href="#UV" class="headerlink" title="UV"></a>UV</h1><p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hive/20180312174642168.png" alt="img"></p>
<p>select store,count(distinct uid) as uv from Visit group by store;</p>
<h1 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h1><p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hive/20180312174739253.png" alt="img"></p>
<p>select * from Users order by age desc, total;</p>
<h1 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h1><p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hive/20180312174821660.png" alt="img"></p>
<p>select  stage_someone, count(distinct UID)  from  LifeStage  lateral  view  explode(split(stage,’,’))  LifeStage_tmp  as stage_someone  group  by  stage_someone;</p>
<h1 id="列转行"><a href="#列转行" class="headerlink" title="列转行"></a>列转行</h1><p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hive/2018031217492340.png" alt="img"></p>
<p>select UID,concat_ws(‘,’,collect_set(stage)) as stages from LifeStage group by UID;</p>
<h1 id="sql除法"><a href="#sql除法" class="headerlink" title="sql除法"></a>sql除法</h1><p>a    chinese    98</p>
<p>a    english    90</p>
<p>d    chinese    88</p>
<p>c    english    82</p>
<p>c    math    98</p>
<p>b    math    89</p>
<p>b    chinese    79</p>
<p>z    english    90</p>
<p>z    math    89</p>
<p>z    chinese    80</p>
<p>e    math    99</p>
<p>e    english    87</p>
<p>d    english    90</p>
<p>求a的chinese成绩/english成绩</p>
<p>select name,t1.score/t2.score from (select <em> from t where sub=’chinese’) t1 inner join (select </em> from t where sub=’english’) t2 on t1.name=t2.name where t1.name=’a’;</p>
]]></content>
      
        <categories>
            
            <category> 大数据 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hive sql </tag>
            
            <tag> 复习 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[solr cloud安装部署]]></title>
      <url>/2018/02/05/solr%20cloud%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/</url>
      <content type="html"><![CDATA[<h1 id="第一部分：初始化环境"><a href="#第一部分：初始化环境" class="headerlink" title="第一部分：初始化环境"></a>第一部分：初始化环境</h1><h2 id="1、初始化环境"><a href="#1、初始化环境" class="headerlink" title="1、初始化环境"></a>1、初始化环境</h2><ul>
<li>准备三台linux服务器</li>
<li>在服务器上创建三个目录<ul>
<li>software目录:software目录是用来存放软件安装包<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /<span class="keyword">export</span>/software</span><br></pre></td></tr></table></figure></li>
<li>servers目录：servers目录用来用来安装软件<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /<span class="keyword">export</span>/servers</span><br></pre></td></tr></table></figure></li>
<li>data目录：data目录用来存放软件运行的数据、日志<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /<span class="keyword">export</span>/data</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>关闭三台机器的防火墙<ul>
<li>永久关闭，需要重启<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure></li>
<li>临时管理，重启失效<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables stop</span><br></pre></td></tr></table></figure></li>
<li>关闭之后可查看防火墙状态<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables status</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="2、准备solr安装包"><a href="#2、准备solr安装包" class="headerlink" title="2、准备solr安装包"></a>2、准备solr安装包</h2><ul>
<li>上传solr-4.10.2的安装包 到 /export/software 目录</li>
<li>上传 tomcat-</li>
</ul>
<h2 id="3、解压安装包"><a href="#3、解压安装包" class="headerlink" title="3、解压安装包"></a>3、解压安装包</h2><ul>
<li>解压solr<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf solr<span class="number">-4.10</span><span class="number">.2</span>.tgz -C /<span class="keyword">export</span>/servers/servers/</span><br></pre></td></tr></table></figure></li>
<li>解压 tomcat<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-tomcat<span class="number">-7.0</span><span class="number">.57</span>.tar.gz -C /<span class="keyword">export</span>/servers/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4、创建solr的工作目录"><a href="#4、创建solr的工作目录" class="headerlink" title="4、创建solr的工作目录"></a>4、创建solr的工作目录</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /<span class="keyword">export</span>/data/solr_home</span><br></pre></td></tr></table></figure>
<h2 id="5、tomcat-软连接创建"><a href="#5、tomcat-软连接创建" class="headerlink" title="5、tomcat 软连接创建"></a>5、tomcat 软连接创建</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s apache-tomcat<span class="number">-7.0</span><span class="number">.57</span>/ tomcat4solr</span><br></pre></td></tr></table></figure>
<h1 id="第二部分：在Linux上部署单机版本的solr"><a href="#第二部分：在Linux上部署单机版本的solr" class="headerlink" title="第二部分：在Linux上部署单机版本的solr"></a>第二部分：在Linux上部署单机版本的solr</h1><h2 id="1、将solr-war包拷贝到tomcat的webapps下"><a href="#1、将solr-war包拷贝到tomcat的webapps下" class="headerlink" title="1、将solr.war包拷贝到tomcat的webapps下"></a>1、将solr.war包拷贝到tomcat的webapps下</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/solr<span class="number">-4.10</span><span class="number">.2</span>/example/webapps</span><br><span class="line">cp solr.war /<span class="keyword">export</span>/servers/tomcat4solr/webapps/</span><br></pre></td></tr></table></figure>
<h2 id="2、启动下tomcat，让tomcat帮解压solr-war，然后关闭tomcat"><a href="#2、启动下tomcat，让tomcat帮解压solr-war，然后关闭tomcat" class="headerlink" title="2、启动下tomcat，让tomcat帮解压solr.war，然后关闭tomcat"></a>2、启动下tomcat，让tomcat帮解压solr.war，然后关闭tomcat</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/tomcat4solr/bin/</span><br><span class="line">./startup.sh </span><br><span class="line">./shutdown.sh</span><br></pre></td></tr></table></figure>
<h2 id="3、修改solr-web项目的配置文件，指定solrhome"><a href="#3、修改solr-web项目的配置文件，指定solrhome" class="headerlink" title="3、修改solr web项目的配置文件，指定solrhome"></a>3、修改solr web项目的配置文件，指定solrhome</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/tomcat4solr/webapps/solr/WEB-INF/</span><br><span class="line">vi web.xml</span><br></pre></td></tr></table></figure>
<p>修改内容,并保存。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/solrhome.png" alt="solrhome"></p>
<ul>
<li>第一步 去掉注释</li>
<li>第二步 修改 env-entry-type 为 /export/data/solr_home</li>
</ul>
<h2 id="4、拷贝一个solr-core到solr-home下"><a href="#4、拷贝一个solr-core到solr-home下" class="headerlink" title="4、拷贝一个solr core到solr_home下"></a>4、拷贝一个solr core到solr_home下</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/solr<span class="number">-4.10</span><span class="number">.2</span>/example/solr</span><br><span class="line">cp -r collection1/ /<span class="keyword">export</span>/data/solr_home/</span><br></pre></td></tr></table></figure>
<h2 id="5、为solr的运行准备配置lib"><a href="#5、为solr的运行准备配置lib" class="headerlink" title="5、为solr的运行准备配置lib"></a>5、为solr的运行准备配置lib</h2><ul>
<li>先创建lib目录<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/data/solr_home/</span><br><span class="line">mkdir lib</span><br></pre></td></tr></table></figure></li>
<li>然后将依赖拷贝过来<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd lib/</span><br><span class="line">cp -r /<span class="keyword">export</span>/servers/solr<span class="number">-4.10</span><span class="number">.2</span>/contrib/ .</span><br><span class="line">cp -r /<span class="keyword">export</span>/servers/solr<span class="number">-4.10</span><span class="number">.2</span>/dist/ .</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="6、修改collection1-的solrconfig-xml文件，配置lib路径"><a href="#6、修改collection1-的solrconfig-xml文件，配置lib路径" class="headerlink" title="6、修改collection1 的solrconfig.xml文件，配置lib路径"></a>6、修改collection1 的solrconfig.xml文件，配置lib路径</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/data/solr_home/collection1/conf</span><br><span class="line">vi solrconfig.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>原始内容<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/solrconfig1.png" alt="solrconfig1"></li>
<li>修改后的内容<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/solrconfig2.png" alt="solrconfig2"></li>
</ul>
<h2 id="7、将ext扩展的jar包拷贝到solr的web项目下"><a href="#7、将ext扩展的jar包拷贝到solr的web项目下" class="headerlink" title="7、将ext扩展的jar包拷贝到solr的web项目下"></a>7、将ext扩展的jar包拷贝到solr的web项目下</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/tomcat4solr/webapps/solr/WEB-INF/lib/</span><br><span class="line">cp -r /<span class="keyword">export</span>/servers/solr<span class="number">-4.10</span><span class="number">.2</span>/example/lib/ext<span class="comment">/* .</span></span><br></pre></td></tr></table></figure>
<h2 id="8、启动solr"><a href="#8、启动solr" class="headerlink" title="8、启动solr"></a>8、启动solr</h2><p>启动solr即使启动tomcat<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/tomcat4solr/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure></p>
<h2 id="9、访问单机版本的solr服务"><a href="#9、访问单机版本的solr服务" class="headerlink" title="9、访问单机版本的solr服务"></a>9、访问单机版本的solr服务</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//&#123;u solr hostname&#125;:8080/solr</span></span><br></pre></td></tr></table></figure>
<h1 id="第三部分-配置集群"><a href="#第三部分-配置集群" class="headerlink" title="第三部分:配置集群"></a>第三部分:配置集群</h1><h2 id="1、梳理修改了哪些目录"><a href="#1、梳理修改了哪些目录" class="headerlink" title="1、梳理修改了哪些目录"></a>1、梳理修改了哪些目录</h2><ul>
<li>三个标准目录<ul>
<li>/export/data/</li>
<li>/export/servers/</li>
<li>/export/software/</li>
</ul>
</li>
<li>安装目录<ul>
<li>/export/data/solr_home</li>
<li>/export/servers/tomcat4solr<br>总结，需要将两个solr的安装目录拷贝到其他机器上。</li>
</ul>
</li>
</ul>
<h2 id="2、在其他机器上创建工作目录"><a href="#2、在其他机器上创建工作目录" class="headerlink" title="2、在其他机器上创建工作目录"></a>2、在其他机器上创建工作目录</h2><p>在hadoop02上操作<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /<span class="keyword">export</span>/data/solr_home</span><br><span class="line">mkdir -p /<span class="keyword">export</span>/servers/tomcat4solr</span><br></pre></td></tr></table></figure><br>在hadoop03上操作<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /<span class="keyword">export</span>/data/solr_home</span><br><span class="line">mkdir -p /<span class="keyword">export</span>/servers/tomcat4solr</span><br></pre></td></tr></table></figure></p>
<h2 id="3、拷贝安装内容到其它机器"><a href="#3、拷贝安装内容到其它机器" class="headerlink" title="3、拷贝安装内容到其它机器"></a>3、拷贝安装内容到其它机器</h2><p>在hadoop01上执行<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scp -r /<span class="keyword">export</span>/data/solr_home<span class="comment">/* hadoop02:/export/data/solr_home/</span></span><br><span class="line"><span class="comment">scp -r /export/servers/tomcat4solr/* hadoop02:/export/servers/tomcat4solr/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">scp -r /export/data/solr_home/* hadoop03:/export/data/solr_home/</span></span><br><span class="line"><span class="comment">scp -r /export/servers/tomcat4solr/* hadoop03:/export/servers/tomcat4solr/</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4、启动zookeeper集群"><a href="#4、启动zookeeper集群" class="headerlink" title="4、启动zookeeper集群"></a>4、启动zookeeper集群</h2><h2 id="5、将solr的配置文件上传到zookeeper"><a href="#5、将solr的配置文件上传到zookeeper" class="headerlink" title="5、将solr的配置文件上传到zookeeper"></a>5、将solr的配置文件上传到zookeeper</h2><p>主要是solrconfig.xml和scheme.xml、<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">export</span>/servers/solr<span class="number">-4.10</span><span class="number">.2</span>/example/scripts/cloud-scripts</span><br><span class="line"></span><br><span class="line">./zkcli.sh -zkhost zk01:<span class="number">2181</span>,zk02:<span class="number">2181</span>,zk03:<span class="number">2181</span> -cmd upconfig -confdir /<span class="keyword">export</span>/data/solr_home/collection1/conf/ -confname solrconf</span><br></pre></td></tr></table></figure></p>
<h2 id="6、检查配置文件是否上传到zookeeper上"><a href="#6、检查配置文件是否上传到zookeeper上" class="headerlink" title="6、检查配置文件是否上传到zookeeper上"></a>6、检查配置文件是否上传到zookeeper上</h2><p>使用zookeeper的客户端命令查看zookeeper的目录树<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkCli.sh</span><br></pre></td></tr></table></figure><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/zkcli.png" alt="zkcli"><br>也可以使用zookeeper可视化工具查看</p>
<h2 id="7、修改集群中每个solr的solr-xml文件"><a href="#7、修改集群中每个solr的solr-xml文件" class="headerlink" title="7、修改集群中每个solr的solr.xml文件"></a>7、修改集群中每个solr的solr.xml文件</h2><ul>
<li>修改配置文件<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp /<span class="keyword">export</span>/servers/solr<span class="number">-4.10</span><span class="number">.2</span>/example/solr/solr.xml /<span class="keyword">export</span>/data/solr_home/</span><br><span class="line">cd /<span class="keyword">export</span>/data/solr_home/</span><br><span class="line">vi solr.xml</span><br></pre></td></tr></table></figure>
<img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/solr.png" alt="solr"></li>
<li>发送给其他节点<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp solr.xml hadoop02:$PWD</span><br><span class="line">scp solr.xml hadoop03:$PWD</span><br></pre></td></tr></table></figure>
<h2 id="8、让solr和zookeeper产生关系"><a href="#8、让solr和zookeeper产生关系" class="headerlink" title="8、让solr和zookeeper产生关系"></a>8、让solr和zookeeper产生关系</h2>修改每一台solr的tomcat 的 bin目录下catalina.sh文件中加入DzkHost指定zookeeper服务器地址。<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/tomcat4solr/bin</span><br><span class="line">vi catalina.sh</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> JAVA_OPTS=<span class="string">"-DzkHost=zk01:2181,zk02:2181,zk03:2181"</span></span><br></pre></td></tr></table></figure>
<img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/solr_zookeeper.png" alt="solr_zookeeper"><br>然后分发到到其它机器上<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp catalina.sh hadoop02:$PWD</span><br><span class="line">scp catalina.sh hadoop03:$PWD</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9、依次启动tomcat"><a href="#9、依次启动tomcat" class="headerlink" title="9、依次启动tomcat"></a>9、依次启动tomcat</h2><p>在hadoop01上<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/tomcat4solr/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure><br>在hadoop02上<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/tomcat4solr/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure><br>在hadoop03上<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /<span class="keyword">export</span>/servers/tomcat4solr/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure><br>然后访问任意一台solr服务，可以看到集群配置成功。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/solr_ui.png" alt="solr_ui"></p>
<h1 id="第四部分：配置新的集群"><a href="#第四部分：配置新的集群" class="headerlink" title="第四部分：配置新的集群"></a>第四部分：配置新的集群</h1><h2 id="1、配置命令"><a href="#1、配置命令" class="headerlink" title="1、配置命令"></a>1、配置命令</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//hadoop01:8080/solr/admin/collections?action=CREATE&amp;name=mycore2&amp;numShards=2&amp;replicationFactor=2&amp;maxShardsPerNode=8&amp;property.schema=schema.xml&amp;property.config=solrconfig.xml</span></span><br></pre></td></tr></table></figure>
<h2 id="2、命令说明"><a href="#2、命令说明" class="headerlink" title="2、命令说明"></a>2、命令说明</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name指明collection名称</span><br><span class="line">numShards指明分片数</span><br><span class="line">replicationFactor指明副本数</span><br><span class="line">maxShardsPerNode 每个节点最大分片数（默认为<span class="number">1</span>）</span><br><span class="line">property.schema：指定使用的schema.xml，这个文件必须在zookeeper上。</span><br><span class="line">property.config：指定使用的solrconfig.xml，这个文件必须在zookeeper上。</span><br></pre></td></tr></table></figure>
<h2 id="3、执行效果"><a href="#3、执行效果" class="headerlink" title="3、执行效果"></a>3、执行效果</h2><p><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/solr_ui1.png" alt="solr_ui1"><br>查看cloud管理界面：<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/solr/solr_ui2.png" alt="solr_ui2"></p>
<h2 id="4、其他可选操作"><a href="#4、其他可选操作" class="headerlink" title="4、其他可选操作"></a>4、其他可选操作</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">删除core命令；</span><br><span class="line">http:<span class="comment">//node01:8080/solr/admin/collections?action=DELETE&amp;name=collection1</span></span><br><span class="line">执行后原来的collection1删除，如下：</span><br><span class="line"></span><br><span class="line">查询所有的core</span><br><span class="line">http:<span class="comment">//node01:8080/solr/admin/collections?action=LIST</span></span><br><span class="line"></span><br><span class="line">显示集群的状态</span><br><span class="line">http:<span class="comment">//node01:8080/solr/admin/collections?action=CLUSTERSTATUS</span></span><br><span class="line"></span><br><span class="line">分裂shard</span><br><span class="line">http:<span class="comment">//node01:8080/solr/admin/collections?action=SPLITSHARD&amp;collection=mycore9&amp;shard=shard1</span></span><br><span class="line"></span><br><span class="line">删除shard</span><br><span class="line">http:<span class="comment">//node01:8080/solr/admin/collections?action=DELETESHARD&amp;shard=shard1&amp;collection=mycore9</span></span><br></pre></td></tr></table></figure>
<h1 id="第五部分：使用Java-Api操作集群"><a href="#第五部分：使用Java-Api操作集群" class="headerlink" title="第五部分：使用Java Api操作集群"></a>第五部分：使用Java Api操作集群</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.solr&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;solr-solrj&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.10.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;commons-logging&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-logging-api&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.1&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.ss.solr;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import org.apache.solr.client.solrj.SolrQuery;</span><br><span class="line">import org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line">import org.apache.solr.client.solrj.impl.CloudSolrServer;</span><br><span class="line">import org.apache.solr.client.solrj.response.QueryResponse;</span><br><span class="line">import org.apache.solr.common.SolrInputDocument;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * solrcloud 操作和solr的操作基本一样</span></span><br><span class="line"><span class="comment"> * 唯一不同的是，solr创建是httpsolrserver，solr cloud创建是cloudsolrserver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="keyword">class</span> SolrCloudTest &#123;</span><br><span class="line">	</span><br><span class="line">	public <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) throws Exception &#123;</span><br><span class="line">		<span class="comment">// 1.创建一个solr cloud的连接，需要指定zookeeper的地址，需要制定操作的索引库</span></span><br><span class="line">		CloudSolrServer cloudSolrServer = new CloudSolrServer(<span class="string">"zk01:2181,zk02:2181,zk03:2181"</span>);</span><br><span class="line">		cloudSolrServer.setDefaultCollection(<span class="string">"aaa"</span>);</span><br><span class="line">		cloudSolrServer.connect();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 2.创建索引</span></span><br><span class="line">		SolrInputDocument solrInputDocument = new SolrInputDocument();</span><br><span class="line">		solrInputDocument.addField(<span class="string">"id"</span>, <span class="string">"300"</span>);</span><br><span class="line">		solrInputDocument.addField(<span class="string">"name"</span>, <span class="string">"我爱我的祖国"</span>);</span><br><span class="line">		solrInputDocument.addField(<span class="string">"price"</span>, <span class="string">"520"</span>);</span><br><span class="line">		solrInputDocument.addField(<span class="string">"url"</span>, <span class="string">"http://www.itcast.cn"</span>);</span><br><span class="line">		cloudSolrServer.add(solrInputDocument);</span><br><span class="line">		cloudSolrServer.commit();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 3.查询代码</span></span><br><span class="line">		SolrQuery solrQuery = new SolrQuery(<span class="string">"name:祖国"</span>);</span><br><span class="line">		QueryResponse res = cloudSolrServer.query(solrQuery);</span><br><span class="line">		List&lt;Product&gt; beans = res.getBeans(Product.class);</span><br><span class="line">		<span class="keyword">for</span> (Product product : beans) &#123;</span><br><span class="line">			System.out.println(product);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 4.删除文档</span></span><br><span class="line"><span class="comment">//		cloudSolrServer.deleteById("100");</span></span><br><span class="line">		cloudSolrServer.deleteByQuery(<span class="string">"name:祖国"</span>);</span><br><span class="line">		cloudSolrServer.commit();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 收尾工作-关闭连接</span></span><br><span class="line">		cloudSolrServer.shutdown();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> solr </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[使用spark-sql操作hive中的表]]></title>
      <url>/2018/02/02/%E4%BD%BF%E7%94%A8spark-sql%E6%93%8D%E4%BD%9Chive%E4%B8%AD%E7%9A%84%E8%A1%A8/</url>
      <content type="html"><![CDATA[<h1 id="SparkSQL操作Hive中的表数据"><a href="#SparkSQL操作Hive中的表数据" class="headerlink" title="SparkSQL操作Hive中的表数据"></a>SparkSQL操作Hive中的表数据</h1><p>spark可以通过读取hive的元数据来兼容hive，读取hive的表数据，然后在spark引擎中进行sql统计分析。<br>注意：hive表的字符集应为latin1</p>
<h1 id="1、启动hive的元数据服务"><a href="#1、启动hive的元数据服务" class="headerlink" title="1、启动hive的元数据服务"></a>1、启动hive的元数据服务</h1><p>hive可以通过服务的形式对外提供元数据读写操作，通过简单的配置即可<br>编辑 $HIVE_HOME/conf/hive-site.xml,增加如下内容:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hive.metastore.uris&lt;/name&gt;</span><br><span class="line">&lt;value&gt;thrift:<span class="comment">//master:9083&lt;/value&gt;</span></span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure><br> 启动hive metastore<br>[hadoop@centos-linux-7  ~]${HIVE_HOME}/bin/hive –service metastore  1&gt;/dev/null  2&gt;&amp;1  &amp;</p>
<p> 查看 metastore:<br>[hadoop@centos-linux-7  ~] jobs<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hive/%E5%90%AF%E5%8A%A8megastore.png" alt="启动megastore"></p>
<h1 id="2、spark配置"><a href="#2、spark配置" class="headerlink" title="2、spark配置"></a>2、spark配置</h1><p>将hive的配置文件拷贝给spark<br>将 $HIVE_HOME/conf/hive-site.xml copy $SPARK_HOME/conf/<br>将mysql的jdbc驱动包拷贝给spark<br>将 $HIVE_HOME/lib/mysql-connector-java-5.1.12.jar copy或者软链到$SPARK_HOME/lib/</p>
<h1 id="3-启动spark-sql"><a href="#3-启动spark-sql" class="headerlink" title="3.启动spark-sql"></a>3.启动spark-sql</h1><p>所有命令启动spark-sql<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-sql --master spark:<span class="comment">//master:7077</span></span><br></pre></td></tr></table></figure><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hive/%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A51.png" alt="启动spark-sql"><br>现在可以尽情的操作hive了，<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hive/%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C1.png" alt="查询语句1"><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hive/%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C1.png" alt="查询结果1"></p>
]]></content>
      
        <categories>
            
            <category> 大数据 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> spark </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[tomcat版本约束]]></title>
      <url>/2018/01/25/tomcat%E7%89%88%E6%9C%AC%E7%BA%A6%E6%9D%9F/</url>
      <content type="html"><![CDATA[<h1 id="tomcat版本约束"><a href="#tomcat版本约束" class="headerlink" title="tomcat版本约束"></a>tomcat版本约束</h1><table>
<thead>
<tr>
<th>Servlet约束</th>
<th>JSP约束</th>
<th>EL约束</th>
<th style="text-align:center">WebSocket约束</th>
<th style="text-align:center">JASPIC约束</th>
<th style="text-align:center">Apache Tomcat版本</th>
<th style="text-align:center">Tomcat最新发布的版本</th>
<th style="text-align:center">支持的Java版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>4.0</td>
<td>2.3</td>
<td>3.0.</td>
<td style="text-align:center">1.1.</td>
<td style="text-align:center">1.1.</td>
<td style="text-align:center">9.0.x</td>
<td style="text-align:center">9.0.2(测试版)</td>
<td style="text-align:center">8 and later</td>
</tr>
<tr>
<td>3.1</td>
<td>2.3</td>
<td>3.0.</td>
<td style="text-align:center">1.1.</td>
<td style="text-align:center">1.1.</td>
<td style="text-align:center">8.5.x</td>
<td style="text-align:center">8.5.24</td>
<td style="text-align:center">7 and later</td>
</tr>
<tr>
<td>3.1</td>
<td>2.3</td>
<td>3.0.</td>
<td style="text-align:center">1.1.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">8.0.x(已废弃)</td>
<td style="text-align:center">8.0.48(已废弃)</td>
<td style="text-align:center">7 and later</td>
</tr>
<tr>
<td>3.0</td>
<td>2.2</td>
<td>2.2.</td>
<td style="text-align:center">1.1.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">7.0.x</td>
<td style="text-align:center">7.0.82</td>
<td style="text-align:center">6 and later(7 and later for WebSocket)</td>
</tr>
<tr>
<td>2.5</td>
<td>2.1</td>
<td>2.1.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">6.0.x(已归档)</td>
<td style="text-align:center">6.0.53(已归档)</td>
<td style="text-align:center">5 and later</td>
</tr>
<tr>
<td>2.4</td>
<td>2.0</td>
<td>N/A.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">5.5.x(已归档)</td>
<td style="text-align:center">5.5.36(已归档)</td>
<td style="text-align:center">1.4 and later</td>
</tr>
<tr>
<td>2.3</td>
<td>1.2</td>
<td>N/A.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">4.1.x(已归档)</td>
<td style="text-align:center">4.1.40(已归档)</td>
<td style="text-align:center">1.3 and later</td>
</tr>
<tr>
<td>2.2</td>
<td>1.1</td>
<td>N/A.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">N/A.</td>
<td style="text-align:center">3.3.x(已归档)</td>
<td style="text-align:center">3.3.2(已归档)</td>
<td style="text-align:center">1.1 and later</td>
</tr>
</tbody>
</table>
<p>⚠️所有已废弃，已归档和测试版的tomcat不建议下载      </p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[机器学习和深入学习资料转载]]></title>
      <url>/2018/01/08/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99%E8%BD%AC%E8%BD%BD/</url>
      <content type="html"><![CDATA[<h1 id="1-数据集转载"><a href="#1-数据集转载" class="headerlink" title="1.数据集转载"></a>1.数据集转载</h1><p><a href="http://blog.csdn.net/yangdashi888/article/details/70503874" target="_blank" rel="noopener">深度学习常用的数据集，包括各种数据跟图像数据</a></p>
<p><a href="http://blog.csdn.net/c2a2o2/article/details/74942545" target="_blank" rel="noopener">机器学习数据集</a></p>
<p><a href="https://site.douban.com/146782/widget/notes/15524697/note/519440833/" target="_blank" rel="noopener">公开的海量数据集 Public Research-Quality Datasets</a></p>
]]></content>
      
        <categories>
            
            <category> 资料转载 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> spark </tag>
            
            <tag> 资料转载 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[spark资料转载]]></title>
      <url>/2018/01/08/spark%E8%B5%84%E6%96%99%E8%BD%AC%E8%BD%BD/</url>
      <content type="html"><![CDATA[<h1 id="大数据资料转载"><a href="#大数据资料转载" class="headerlink" title="大数据资料转载"></a>大数据资料转载</h1><p><a href="http://spark.apachecn.org/docs/cn/2.2.0/index.html" target="_blank" rel="noopener">spark中文官网</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1005705?fromSource=gwzcw.700962.700962.700962" target="_blank" rel="noopener">Spark MLlib 算法系列之 FM</a></p>
<p><a href="http://shujuren.org/article/420.html" target="_blank" rel="noopener">大数据框架对比：Hadoop、Storm、Samza、Spark和Flink</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1030060" target="_blank" rel="noopener">大数据奇葩说：盘点10个有趣的大数据</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1030050" target="_blank" rel="noopener">大数据实时推荐-不只是统计</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1004886" target="_blank" rel="noopener">Spark Cache 性能测试</a></p>
]]></content>
      
        <categories>
            
            <category> 资料转载 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> spark </tag>
            
            <tag> 资料转载 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hadoop异常]]></title>
      <url>/2017/12/30/Hadoop%E5%BC%82%E5%B8%B8/</url>
      <content type="html"><![CDATA[<h1 id="1-java-io-IOException-Inconsistent-checkpoint-fields"><a href="#1-java-io-IOException-Inconsistent-checkpoint-fields" class="headerlink" title="1.java.io.IOException: Inconsistent checkpoint fields."></a>1.java.io.IOException: Inconsistent checkpoint fields.</h1><p>异常类型：java.io.IOException: Inconsistent checkpoint fields.<br>LV = -63 namespaceID = 1546098189 cTime = 1516970325460 ; clusterId = CID-6d672012-5fd7-499a-92ae-80393083d28a ; blockpoolId = BP-1045570623-10.211.55.8-1516970325460.</p>
<h2 id="1-看看core-site-xml文件中的“hadoop-tmp-dir”有没有配好"><a href="#1-看看core-site-xml文件中的“hadoop-tmp-dir”有没有配好" class="headerlink" title="1.看看core-site.xml文件中的“hadoop.tmp.dir”有没有配好"></a>1.看看core-site.xml文件中的“hadoop.tmp.dir”有没有配好</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">   &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">   &lt;value&gt;file:/home/parallels/hadoop/hadoop-2.8.2/tmp&lt;/value&gt;</span><br><span class="line">   &lt;description&gt; 存放临时文件的目录 &lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<h2 id="2-看看防火墙有没有关"><a href="#2-看看防火墙有没有关" class="headerlink" title="2.看看防火墙有没有关"></a>2.看看防火墙有没有关</h2><p>cenOS 7:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service  停止firewall</span><br><span class="line">systemctl disable firewalld.service  禁止firewall开机启动</span><br><span class="line">firewall-cmd --state #查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</span><br></pre></td></tr></table></figure><br>cenOS 6：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig iptables off  永久关闭防火墙</span><br><span class="line">service iptables stop  停止防火墙</span><br><span class="line">service iptables status   查询防火墙状态</span><br></pre></td></tr></table></figure></p>
<h2 id="3-多次namenode导致data文件夹的VERSION和name文件夹的VERSION不一致"><a href="#3-多次namenode导致data文件夹的VERSION和name文件夹的VERSION不一致" class="headerlink" title="3.多次namenode导致data文件夹的VERSION和name文件夹的VERSION不一致"></a>3.多次namenode导致data文件夹的VERSION和name文件夹的VERSION不一致</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(1)删除hdfs/data/current文件夹</span><br><span class="line">(2)删除hdfs/name/current文件夹</span><br><span class="line">(3)删除tmp文件夹里的文件</span><br><span class="line">(4)hadoop namenode -format</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> 大数据异常 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> 异常 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hadoop web页面和spark web页面不能访问]]></title>
      <url>/2017/12/21/Hadoop%20web%E9%A1%B5%E9%9D%A2%E5%92%8Cspark%20web%E9%A1%B5%E9%9D%A2%E4%B8%8D%E8%83%BD%E8%AE%BF%E9%97%AE/</url>
      <content type="html"><![CDATA[<h1 id="1-CentOS-7-0默认使用的是firewall作为防火墙。"><a href="#1-CentOS-7-0默认使用的是firewall作为防火墙。" class="headerlink" title="1.CentOS 7.0默认使用的是firewall作为防火墙。"></a>1.CentOS 7.0默认使用的是firewall作为防火墙。</h1><h2 id="1-1、关闭firewall"><a href="#1-1、关闭firewall" class="headerlink" title="1.1、关闭firewall"></a>1.1、关闭firewall</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service  停止firewall</span><br><span class="line">systemctl disable firewalld.service  禁止firewall开机启动</span><br><span class="line">firewall-cmd --state #查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</span><br></pre></td></tr></table></figure>
<h2 id="1-2、如果使用的是防火墙iptables"><a href="#1-2、如果使用的是防火墙iptables" class="headerlink" title="1.2、如果使用的是防火墙iptables"></a>1.2、如果使用的是防火墙iptables</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig iptables off  永久关闭防火墙</span><br><span class="line">service iptables stop  停止防火墙</span><br><span class="line">service iptables status   查询防火墙状态</span><br></pre></td></tr></table></figure>
<h1 id="2-格式化Hadoop"><a href="#2-格式化Hadoop" class="headerlink" title="2.格式化Hadoop"></a>2.格式化Hadoop</h1><p>在hadoop中使用命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop namenode -format</span><br></pre></td></tr></table></figure></p>
<h1 id="3-查看端口是否打开"><a href="#3-查看端口是否打开" class="headerlink" title="3.查看端口是否打开"></a>3.查看端口是否打开</h1><p>启动集群，使用命令netstat -an | grep 50070和netstat -an | grep 8080查看端口是否打开</p>
]]></content>
      
        <categories>
            
            <category> 大数据异常 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> spark </tag>
            
            <tag> 异常 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[容器部署Docker入门]]></title>
      <url>/2017/12/15/%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2Docker%E5%85%A5%E9%97%A8/</url>
      <content type="html"><![CDATA[<h1 id="1-Docker简介"><a href="#1-Docker简介" class="headerlink" title="1.Docker简介"></a>1.Docker简介</h1><h2 id="1-1虚拟化"><a href="#1-1虚拟化" class="headerlink" title="1.1虚拟化"></a>1.1虚拟化</h2><h3 id="1-1-1什么是虚拟化"><a href="#1-1-1什么是虚拟化" class="headerlink" title="1.1.1什么是虚拟化"></a>1.1.1什么是虚拟化</h3><p>在计算机中，虚拟化（英语：Virtualization）是一种资源管理技术，是将计算机的各种实体资源，如服务器、网络、内存及存储等，予以抽象、转换后呈现出来，打破实体结构间的不可切割的障碍，使用户可以比原本的组态更好的方式来应用这些资源。这些资源的新虚拟部份是不受现有资源的架设方式，地域或物理组态所限制。一般所指的虚拟化资源包括计算能力和资料存储。</p>
<p>在实际的生产环境中，虚拟化技术主要用来解决高性能的物理硬件产能过剩和老的旧的硬件产能过低的重组重用，透明化底层物理硬件，从而最大化的利用物理硬件   对资源充分利用</p>
<p>虚拟化技术种类很多，例如：软件虚拟化、硬件虚拟化、内存虚拟化、网络虚拟化(vip)、桌面虚拟化、服务虚拟化、虚拟机等等。</p>
<h3 id="1-1-2虚拟化种类"><a href="#1-1-2虚拟化种类" class="headerlink" title="1.1.2虚拟化种类"></a>1.1.2虚拟化种类</h3><p>（1）全虚拟化架构</p>
<p>虚拟机的监视器（hypervisor）是类似于用户的应用程序运行在主机的OS之上，如VMware的workstation，这种虚拟化产品提供了虚拟的硬件。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image3.png" alt="image3"></p>
<p>（2）OS层虚拟化架构</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image4.png" alt="image4"> </p>
<p>（3）硬件层虚拟化</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image5.png" alt="image5"></p>
<p>硬件层的虚拟化具有高性能和隔离性，因为hypervisor直接在硬件上运行，有利于控制VM的OS访问硬件资源，使用这种解决方案的产品有VMware ESXi 和 Xen server</p>
<p>Hypervisor是一种运行在物理服务器和操作系统之间的中间软件层,可允许多个操作系统和应用共享一套基础物理硬件，因此也可以看作是虚拟环境中的“元”操作系统，它可以协调访问服务器上的所有物理设备和虚拟机，也叫虚拟机监视器（Virtual Machine Monitor，VMM）。</p>
<p>Hypervisor是所有虚拟化技术的核心。当服务器启动并执行Hypervisor时，它会给每一台虚拟机分配适量的内存、CPU、网络和磁盘，并加载所有虚拟机的客户操作系统。  宿主机</p>
<p>Hypervisor是所有虚拟化技术的核心，软硬件架构和管理更高效、更灵活，硬件的效能能够更好地发挥出来。常见的产品有：VMware、KVM、Xen等等。Openstack</p>
<h2 id="1-2什么是Docker"><a href="#1-2什么是Docker" class="headerlink" title="1.2什么是Docker"></a>1.2什么是Docker</h2><p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image6.png" alt="image6"></p>
<h3 id="1-2-1容器技术"><a href="#1-2-1容器技术" class="headerlink" title="1.2.1容器技术"></a>1.2.1容器技术</h3><p>在计算机的世界中，容器拥有一段漫长且传奇的历史。容器与管理程序虚拟化（hypervisor virtualization，HV）有所不同，管理程序虚拟化通过中间层将一台或者多台独立的机器虚拟运行与物理硬件之上，而容器则是直接运行在操作系统内核之上的用户空间。因此，容器虚拟化也被称为“操作系统级虚拟化”，容器技术可以让多个独立的用户空间运行在同一台宿主机上。</p>
<p>由于“客居”于操作系统，容器只能运行与底层宿主机相同或者相似的操作系统，这看起来并不是非常灵活。例如：可以在Ubuntu服务中运行Redhat Enterprise Linux，但无法再Ubuntu服务器上运行Microsoft Windows。</p>
<p>相对于彻底隔离的管理程序虚拟化，容器被认为是不安全的。而反对这一观点的人则认为，由于虚拟容器所虚拟的是一个完整的操作系统，这无疑增大了攻击范围，而且还要考虑管理程序层潜在的暴露风险。</p>
<p>尽管有诸多局限性，容器还是被广泛部署于各种各样的应用场合。在超大规模的多租户服务部署、轻量级沙盒以及对安全要求不太高的隔离环境中，容器技术非常流行。最常见的一个例子就是“权限隔离监牢”（chroot jail），它创建一个隔离的目录环境来运行进程。如果权限隔离监牢正在运行的进程被入侵者攻破，入侵者便会发现自己“身陷囹圄”，因为权限不足被困在容器所创建的目录中，无法对宿主机进一步破坏。</p>
<p>最新的容器技术引入了OpenVZ、Solaris Zones以及Linux容器（LXC）。使用这些新技术，容器不在仅仅是一个单纯的运行环境。在自己的权限类内，容器更像是一个完整的宿主机。对Docker来说，它得益于现代Linux特性，如控件组（control group）、命名空间（namespace）技术，容器和宿主机之间的隔离更加彻底，容器有独立的网络和存储栈，还拥有自己的资源管理能力，使得同一台宿主机中的多个容器可以友好的共存。</p>
<p>容器被认为是精益技术，因为容器需要的开销有限。和传统虚拟化以及半虚拟化相比，容器不需要模拟层（emulation layer）和管理层（hypervisor layer），而是使用操作系统的系统调用接口。这降低了运行单个容器所需的开销，也使得宿主机中可以运行更多的容器。</p>
<p>尽管有着光辉的历史，容器仍未得到广泛的认可。一个很重要的原因就是容器技术的复杂性：容器本身就比较复杂，不易安装，管理和自动化也很困难。而Docker就是为了改变这一切而生的。</p>
<h3 id="1-2-2容器与虚拟机比较"><a href="#1-2-2容器与虚拟机比较" class="headerlink" title="1.2.2容器与虚拟机比较"></a>1.2.2容器与虚拟机比较</h3><p>1.本质上的区别</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image7.png" alt="image7"></p>
<p>2.使用上的区别</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image8.png" alt="image8"></p>
<p>虚拟机已死，容器才是未来。</p>
<h3 id="1-2-3-Docker特点"><a href="#1-2-3-Docker特点" class="headerlink" title="1.2.3 Docker特点"></a>1.2.3 Docker特点</h3><p>（1）上手快。</p>
<p>用户只需要几分钟，就可以把自己的程序“Docker化”。Docker依赖于“写时复制”（copy-on-write）模型，使修改应用程序也非常迅速，可以说达到“随心所致，代码即改”的境界。</p>
<p>​    随后，就可以创建容器来运行应用程序了。大多数Docker容器只需要不到1秒中即可启动。由于去除了管理程序的开销，Docker容器拥有很高的性能，同时同一台宿主机中也可以运行更多的容器，使用户尽可能的充分利用系统资源。</p>
<p>（2）职责的逻辑分类</p>
<p>使用Docker，开发人员只需要关心容器中运行的应用程序，而运维人员只需要关心如何管理容器。Docker设计的目的就是要加强开发人员写代码的开发环境与应用程序要部署的生产环境一致性。从而降低那种“开发时一切正常，肯定是运维的问题（测试环境都是正常的，上线后出了问题就归结为肯定是运维的问题）”</p>
<p>（3）快速高效的开发生命周期**</p>
<p>Docker的目标之一就是缩短代码从开发、测试到部署、上线运行的周期，让你的应用程序具备可移植性，易于构建，并易于协作。（通俗一点说，Docker就像一个盒子，里面可以装很多物件，如果需要这些物件的可以直接将该大盒子拿走，而不需要从该盒子中一件件的取。）</p>
<p>（4）鼓励使用面向服务的架构**</p>
<p>Docker还鼓励面向服务的体系结构和微服务架构。Docker推荐单个容器只运行一个应用程序或进程，这样就形成了一个分布式的应用程序模型，在这种模型下，应用程序或者服务都可以表示为一系列内部互联的容器，从而使分布式部署应用程序，扩展或调试应用程序都变得非常简单，同时也提高了程序的内省性。（当然，可以在一个容器中运行多个应用程序）</p>
<h2 id="1-3-Docker组件"><a href="#1-3-Docker组件" class="headerlink" title="1.3 Docker组件"></a>1.3 Docker组件</h2><h3 id="1-3-1-Docker客户端和服务器"><a href="#1-3-1-Docker客户端和服务器" class="headerlink" title="1.3.1 Docker客户端和服务器"></a>1.3.1 Docker客户端和服务器</h3><p>Docker是一个客户端-服务器（C/S）架构程序。Docker客户端只需要向Docker服务器或者守护进程发出请求，服务器或者守护进程将完成所有工作并返回结果。Docker提供了一个命令行工具Docker以及一整套RESTful API。你可以在同一台宿主机上运行Docker守护进程和客户端，也可以从本地的Docker客户端连接到运行在另一台宿主机上的远程Docker守护进程。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image9.png" alt="image9"></p>
<h3 id="1-3-2-Docker镜像"><a href="#1-3-2-Docker镜像" class="headerlink" title="1.3.2 Docker镜像"></a>1.3.2 Docker镜像</h3><p>镜像是构建Docker的基石。用户基于镜像来运行自己的容器。镜像也是Docker生命周期中的“构建”部分。镜像是基于联合文件系统的一种层式结构，由一系列指令一步一步构建出来。例如：</p>
<p>添加一个文件；</p>
<p>执行一个命令；</p>
<p>打开一个窗口。</p>
<p>也可以将镜像当作容器的“源代码”。镜像体积很小，非常“便携”，易于分享、存储和更新。</p>
<h3 id="1-3-3-Registry（注册中心）"><a href="#1-3-3-Registry（注册中心）" class="headerlink" title="1.3.3 Registry（注册中心）"></a>1.3.3 Registry（注册中心）</h3><p>Docker用Registry来保存用户构建的镜像。Registry分为公共和私有两种。Docker公司运营公共的Registry叫做Docker Hub。用户可以在Docker Hub注册账号，分享并保存自己的镜像（说明：在Docker Hub下载镜像巨慢，可以自己构建私有的Registry）。</p>
<h3 id="1-3-4-Docker容器"><a href="#1-3-4-Docker容器" class="headerlink" title="1.3.4 Docker容器"></a>1.3.4 Docker容器</h3><p>Docker可以帮助你构建和部署容器，你只需要把自己的应用程序或者服务打包放进容器即可。容器是基于镜像启动起来的，容器中可以运行一个或多个进程。我们可以认为，镜像是Docker生命周期中的构建或者打包阶段，而容器则是启动或者执行阶段。  容器基于镜像启动，一旦容器启动完成后，我们就可以登录到容器中安装自己需要的软件或者服务。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image10.png" alt="image10"></p>
<p>所以Docker容器就是：</p>
<p>一个镜像格式；</p>
<p>一些列标准操作；</p>
<p>一个执行环境。</p>
<p>Docker借鉴了标准集装箱的概念。标准集装箱将货物运往世界各地，Docker将这个模型运用到自己的设计中，唯一不同的是：集装箱运输货物，而Docker运输软件。</p>
<p>​    和集装箱一样，Docker在执行上述操作时，并不关心容器中到底装了什么，它不管是web服务器，还是数据库，或者是应用程序服务器什么的。所有的容器都按照相同的方式将内容“装载”进去。</p>
<p>​    Docker也不关心你要把容器运到何方：我们可以在自己的笔记本中构建容器，上传到Registry，然后下载到一个物理的或者虚拟的服务器来测试，在把容器部署到具体的主机中。像标准集装箱一样，Docker容器方便替换，可以叠加，易于分发，并且尽量通用。</p>
<p>​    使用Docker，我们可以快速的构建一个应用程序服务器、一个消息总线、一套实用工具、一个持续集成（CI）测试环境或者任意一种应用程序、服务或工具。我们可以在本地构建一个完整的测试环境，也可以为生产或开发快速复制一套复杂的应用程序栈。</p>
<h1 id="2-Docker安装与启动"><a href="#2-Docker安装与启动" class="headerlink" title="2.Docker安装与启动"></a>2.Docker安装与启动</h1><h2 id="2-1安装环境说明"><a href="#2-1安装环境说明" class="headerlink" title="2.1安装环境说明"></a>2.1安装环境说明</h2><p>Docker官方建议在Ubuntu中安装，因为Docker是基于Ubuntu发布的，而且一般Docker出现的问题Ubuntu是最先更新或者打补丁的。在很多版本的CentOS中是不支持更新最新的一些补丁包的。</p>
<p>​    由于我们学习的环境都使用的是CentOS，因此这里我们将Docker安装到CentOS上。注意：这里建议安装在CentOS7.x以上的版本，在CentOS6.x的版本中，安装前需要安装其他很多的环境而且Docker很多补丁不支持更新。</p>
<h2 id="2-2在VMware-Workstation中安装CentOS7"><a href="#2-2在VMware-Workstation中安装CentOS7" class="headerlink" title="2.2在VMware Workstation中安装CentOS7"></a>2.2在VMware Workstation中安装CentOS7</h2><p>资料已经准备了安装好的镜像，直接挂载即可。</p>
<p>挂载后，使用ip addr命令查看本地IP</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image11.png" alt="image11"></p>
<h2 id="2-3安装Docker"><a href="#2-3安装Docker" class="headerlink" title="2.3安装Docker"></a>2.3安装Docker</h2><p>使用yum命令在线安装</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker</span><br></pre></td></tr></table></figure>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image12.png" alt="image12"></p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image13.png" alt="image13"></p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image14.png" alt="image14"></p>
<h2 id="2-4安装后查看Docker版本"><a href="#2-4安装后查看Docker版本" class="headerlink" title="2.4安装后查看Docker版本"></a>2.4安装后查看Docker版本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image15.png" alt="image15"></p>
<h2 id="2-5启动与停止Docker"><a href="#2-5启动与停止Docker" class="headerlink" title="2.5启动与停止Docker"></a>2.5启动与停止Docker</h2><p><strong>systemctl</strong>命令是系统服务管理器指令，它是 service 和 chkconfig 两个命令组合。</p>
<ul>
<li>启动docker：systemctl start docker</li>
<li>停止docker：systemctl stop docker</li>
<li>重启docker：systemctl restart docker</li>
<li>查看docker状态：systemctl status docker</li>
<li><p>开机启动：systemctl enable docker</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image16.png" alt="image16"></p>
</li>
<li><p>查看docker概要信息：docker info</p>
</li>
<li>查看docker帮助文档：docker –help</li>
</ul>
<h1 id="3-Docker镜像操作"><a href="#3-Docker镜像操作" class="headerlink" title="3.Docker镜像操作"></a>3.Docker镜像操作</h1><h2 id="3-1什么是Docker镜像"><a href="#3-1什么是Docker镜像" class="headerlink" title="3.1什么是Docker镜像"></a>3.1什么是Docker镜像</h2><p>Docker镜像是由文件系统叠加而成（是一种文件的存储形式）。最底端是一个文件引导系统，即bootfs，这很像典型的Linux/Unix的引导文件系统。Docker用户几乎永远不会和引导系统有什么交互。实际上，当一个容器启动后，它将会被移动到内存中，而引导文件系统则会被卸载，以留出更多的内存供磁盘镜像使用。Docker容器启动是需要的一些文件，而这些文件就可以称为Docker镜像。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image17.png" alt="image17"></p>
<h2 id="3-2列出镜像"><a href="#3-2列出镜像" class="headerlink" title="3.2列出镜像"></a>3.2列出镜像</h2><p>列出docker下的所有镜像：docker images</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image18.png" alt="image18"></p>
<ul>
<li>REPOSITORY：镜像所在的仓库名称</li>
<li>TAG：镜像标签</li>
<li>IMAGE ID：镜像ID</li>
<li>CREATED：镜像的创建日期（不是获取该镜像的日期）</li>
<li>SIZE：镜像大小</li>
<li><p>这些镜像都是存储在Docker宿主机的/var/lib/docker目录下</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image19.png" alt="image19"></p>
</li>
</ul>
<p>为了区分同一个仓库下的不同镜像，Docker提供了一种称为标签（Tag）的功能。每个镜像在列出来时都带有一个标签，例如12.10、12.04等等。每个标签对组成特定镜像的一些镜像层进行标记（比如，标签12.04就是对所有Ubuntu12.04镜像层的标记）。这种机制使得同一个仓库中可以存储多个镜像。— 版本号</p>
<p>​    我们在运行同一个仓库中的不同镜像时，可以通过在仓库名后面加上一个冒号和标签名来指定该仓库中的某一具体的镜像，例如docker run –name custom_container_name –i –t docker.io/ubunto:12.04 /bin/bash，表明从镜像Ubuntu:12.04启动一个容器，而这个镜像的操作系统就是Ubuntu:12.04。在构建容器时指定仓库的标签也是一个好习惯。</p>
<h2 id="3-3搜索镜像"><a href="#3-3搜索镜像" class="headerlink" title="3.3搜索镜像"></a>3.3搜索镜像</h2><p>如果你需要从网络中查找需要的镜像，可以通过以下命令搜索</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search 镜像名称</span><br></pre></td></tr></table></figure>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image20.png" alt="image20"> </p>
<ul>
<li>NAME：仓库名称</li>
<li>DESCRIPTION：镜像描述</li>
<li>STARS：用户评价，反应一个镜像的受欢迎程度</li>
<li>OFFICIAL：是否官方</li>
</ul>
<p>AUTOMATED：自动构建，表示该镜像由Docker Hub自动构建流程创建的</p>
<h2 id="3-4拉取镜像"><a href="#3-4拉取镜像" class="headerlink" title="3.4拉取镜像"></a>3.4拉取镜像</h2><h3 id="3-4-1从Docker-Hub拉取"><a href="#3-4-1从Docker-Hub拉取" class="headerlink" title="3.4.1从Docker Hub拉取"></a>3.4.1从Docker Hub拉取</h3><p>Docker镜像首页，包括官方镜像和其它公开镜像。Docker Hub上最受欢迎的10大镜像（通过Docker registry API获取不了镜像被pull的个数，只能通过镜像的stars数量，来衡量镜像的流行度。毫无疑问，拥有最高stars数量的库都是官方库）。 </p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image21.png" alt="image21"></p>
<p>国情的原因，国内下载 Docker HUB 官方的相关镜像比较慢，可以使用国内（docker.io）的一些镜像加速器，镜像保持和官方一致，关键是速度块，推荐使用。Mirror与Private Registry的区别：</p>
<p>Private Registry（私有仓库）是开发者或者企业自建的镜像存储库，通常用来保存企业内部的 Docker 镜像，用于内部开发流程和产品的发布、版本控制。</p>
<p>Mirror是一种代理中转服务，我们(比如daocloud)提供的Mirror服务，直接对接Docker Hub的官方Registry。Docker Hub 上有数以十万计的各类 Docker 镜像。</p>
<p>在使用Private Registry时，需要在Docker Pull 或Dockerfile中直接键入Private Registry 的地址，通常这样会导致与 Private Registry 的绑定，缺乏灵活性。</p>
<p>使用 Mirror 服务，只需要在 Docker 守护进程（Daemon）的配置文件中加入 Mirror 参数，即可在全局范围内透明的访问官方的 Docker Hub，避免了对 Dockerfile 镜像引用来源的修改。</p>
<p>简单来说，Mirror类似CDN，本质是官方的cache；Private Registry类似私服，跟官方没什么关系。对用户来说，由于用户是要拖docker hub上的image，对应的是Mirror。yum/apt-get的Mirror又有点不一样，它其实是把官方的库文件整个拖到自己的服务器上做镜像，并定时与官方做同步；而Docker Mirror只会缓存曾经使用过的image。</p>
<p>使用命令拉取：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos:7</span><br></pre></td></tr></table></figure>
<p>目前国内访问docker hub速度上有点尴尬，使用docker Mirror势在必行。现有国内提供docker镜像加速服务的商家有不少，下面重点ustc镜像。</p>
<h3 id="3-4-2-ustc的镜像"><a href="#3-4-2-ustc的镜像" class="headerlink" title="3.4.2 ustc的镜像"></a>3.4.2 ustc的镜像</h3><p>ustc是老牌的linux镜像服务提供者了，还在遥远的ubuntu 5.04版本的时候就在用。ustc的docker镜像加速器速度很快。ustc docker mirror的优势之一就是不需要注册，是真正的公共服务。</p>
<p><a href="https://lug.ustc.edu.cn/wiki/mirrors/help/docker" target="_blank" rel="noopener">https://lug.ustc.edu.cn/wiki/mirrors/help/docker</a></p>
<p><strong>步骤：</strong></p>
<p>（1）编辑该文件：vi /etc/docker/daemon.json  // 如果该文件不存在就手动创建；说明：在centos7.x下，通过vi。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image22.png" alt="image22"></p>
<p>（2）在该文件中输入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）注意：一定要重启docker服务，如果重启docker后无法加速，可以重新启动OS</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image23.png" alt="image23"></p>
<p>然后通过docker pull命令下载镜像：速度杠杠的。</p>
<h3 id="3-5删除镜像"><a href="#3-5删除镜像" class="headerlink" title="3.5删除镜像"></a>3.5删除镜像</h3><ol>
<li>docker rmi $IMAGE_ID：删除指定镜像</li>
<li><p>docker rmi <code>docker images -q</code>：删除所有镜像</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image24.png" alt="image24"></p>
</li>
</ol>
<h1 id="4-Docker容器操作"><a href="#4-Docker容器操作" class="headerlink" title="4.Docker容器操作"></a>4.Docker容器操作</h1><h2 id="4-1查看容器"><a href="#4-1查看容器" class="headerlink" title="4.1查看容器"></a>4.1查看容器</h2><ul>
<li><p>查看正在运行容器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看所有的容器（启动过的历史容器）：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps –a</span><br></pre></td></tr></table></figure>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image25.png" alt="image25"></p>
<ul>
<li>查看最后一次运行的容器：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps –l</span><br></pre></td></tr></table></figure>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image26.png" alt="image26"></p>
<ul>
<li>查看停止的容器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -f status=exited</span><br></pre></td></tr></table></figure>
<h2 id="4-2创建与启动容器"><a href="#4-2创建与启动容器" class="headerlink" title="4.2创建与启动容器"></a>4.2创建与启动容器</h2><ul>
<li>创建容器常用的参数说明：</li>
<li>创建容器命令：docker run</li>
<li>-i：表示运行容器</li>
<li>-t：表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端。</li>
<li>–name :为创建的容器命名。</li>
<li>-v：表示目录映射关系（前者是宿主机目录，后者是映射到宿主机上的目录），可以使用多个－v做多个目录或文件映射。注意：最好做目录映射，在宿主机上做修改，然后共享到容器上。</li>
<li>-d：在run后面加上-d参数,则会创建一个守护式容器在后台运行（这样创建容器后不会自动登录容器，如果只加-i -t两个参数，创建后就会自动进去容器）。</li>
<li>-p：表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个－p做多个端口映射</li>
</ul>
<h3 id="4-1-1交互式容器"><a href="#4-1-1交互式容器" class="headerlink" title="4.1.1交互式容器"></a>4.1.1交互式容器</h3><p>创建一个交互式容器并取名为mycentos</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=mycentos centos:7 /bin/bash</span><br></pre></td></tr></table></figure>
<p>这时我们通过ps命令查看，发现可以看到启动的容器，状态为启动状态</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image27.png" alt="image27"></p>
<p>使用exit命令 退出当前容器</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image28.png" alt="image28"></p>
<p>然后用ps -a 命令查看发现该容器也随之停止：</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image29.png" alt="image29"></p>
<h3 id="4-1-2守护式容器"><a href="#4-1-2守护式容器" class="headerlink" title="4.1.2守护式容器"></a>4.1.2守护式容器</h3><p>创建一个守护式容器：如果对于一个需要长期运行的容器来说，我们可以创建一个守护式容器。命令如下（容器名称不能重复）：</p>
<ul>
<li>登录守护式容器方式：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=mycentos2 centos:7</span><br></pre></td></tr></table></figure>
<p>docker exec -it container_name (或者 container_id)  /bin/bash（exit退出时，容器不会停止）</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image30.png" alt="image30"></p>
<h2 id="4-3停止与启动容器"><a href="#4-3停止与启动容器" class="headerlink" title="4.3停止与启动容器"></a>4.3停止与启动容器</h2><ul>
<li><p>停止正在运行的容器：docker stop $CONTAINER_NAME/ID</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image31.png" alt="image31"></p>
</li>
<li><p>启动已运行过的容器：docker start $CONTAINER_NAME/ID</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image32.png" alt="image32"></p>
</li>
</ul>
<h2 id="4-4文件拷贝"><a href="#4-4文件拷贝" class="headerlink" title="4.4文件拷贝"></a>4.4文件拷贝</h2><p>如果我们需要将文件拷贝到容器内可以使用cp命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 需要拷贝的文件或目录 容器名称:容器目录</span><br></pre></td></tr></table></figure>
<p>也可以将文件从容器内拷贝出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器名称:容器目录 需要拷贝的文件或目录</span><br></pre></td></tr></table></figure>
<h2 id="4-5目录挂载"><a href="#4-5目录挂载" class="headerlink" title="4.5目录挂载"></a>4.5目录挂载</h2><p>我们可以在创建容器的时候，将宿主机的目录与容器内的目录进行映射，这样我们就可以通过修改宿主机某个目录的文件从而去影响容器。</p>
<p>创建容器 添加-v参数 后边为   宿主机目录:容器目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di -v /usr/local/myhtml:/usr/local/myhtml --name=mycentos2 centos:7</span><br></pre></td></tr></table></figure>
<p>如果你共享的是多级的目录，可能会出现权限不足的提示。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image33.png" alt="image33"></p>
<p>这是因为CentOS7中的安全模块selinux把权限禁掉了，我们需要添加参数  –privileged=true  来解决挂载的目录没有权限的问题</p>
<h2 id="4-6查看容器IP地址"><a href="#4-6查看容器IP地址" class="headerlink" title="4.6查看容器IP地址"></a>4.6查看容器IP地址</h2><p>我们可以通过以下命令查看容器运行的各种数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect mycentos2</span><br></pre></td></tr></table></figure>
<p>也可以直接执行下面的命令直接输出IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format=&apos;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&apos; mycentos2</span><br></pre></td></tr></table></figure>
<h2 id="4-7删除容器"><a href="#4-7删除容器" class="headerlink" title="4.7删除容器"></a>4.7删除容器</h2><ul>
<li><p>删除指定的容器：docker rm $CONTAINER_ID/NAME</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image34.png" alt="image34"></p>
</li>
</ul>
<p>注意，只能删除停止的容器</p>
<ul>
<li><p>删除所有容器：docker rm <code>docker ps -a -q</code></p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image35.png" alt="image35"></p>
</li>
</ul>
<h1 id="5-部署应用"><a href="#5-部署应用" class="headerlink" title="5.部署应用"></a>5.部署应用</h1><h2 id="5-1-MySQL部署"><a href="#5-1-MySQL部署" class="headerlink" title="5.1 MySQL部署"></a>5.1 MySQL部署</h2><h3 id="5-1-1拉取MySQL镜像"><a href="#5-1-1拉取MySQL镜像" class="headerlink" title="5.1.1拉取MySQL镜像"></a>5.1.1拉取MySQL镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image36.png" alt="image36"></p>
<p>查看镜像</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image37.png" alt="image37"></p>
<h3 id="5-1-2创建MySQL容器"><a href="#5-1-2创建MySQL容器" class="headerlink" title="5.1.2创建MySQL容器"></a>5.1.2创建MySQL容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name pinyougou_mysql -p 33306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql</span><br></pre></td></tr></table></figure>
<p>-p 代表端口映射，格式为  宿主机映射端口:容器运行端口</p>
<p>-e 代表添加环境变量  MYSQL_ROOT_PASSWORD是root用户的登陆密码</p>
<h3 id="5-1-3进入MySQL容器-登陆MySQL"><a href="#5-1-3进入MySQL容器-登陆MySQL" class="headerlink" title="5.1.3进入MySQL容器,登陆MySQL"></a>5.1.3进入MySQL容器,登陆MySQL</h3><p>进入mysql容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it pinyougou_mysql /bin/bash</span><br></pre></td></tr></table></figure>
<p>登陆mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>
<h3 id="5-1-4远程登陆MySQL"><a href="#5-1-4远程登陆MySQL" class="headerlink" title="5.1.4远程登陆MySQL"></a>5.1.4远程登陆MySQL</h3><p>我们在我们本机的电脑上去连接虚拟机Centos中的Docker容器，这里192.168.247.130是虚拟机操作系统的IP</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image38.png" alt="image38"></p>
<h3 id="5-1-5查看容器IP地址"><a href="#5-1-5查看容器IP地址" class="headerlink" title="5.1.5查看容器IP地址"></a>5.1.5查看容器IP地址</h3><p>我们可以通过以下命令查看容器运行的各种数据</p>
<p>运行效果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect pinyougou_mysql</span><br></pre></td></tr></table></figure>
<p>我们可以看到我们的数据库服务器的IP是172.17.0.2 </p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image40.png" alt="image40"></p>
<h2 id="5-2-tomcat部署"><a href="#5-2-tomcat部署" class="headerlink" title="5.2 tomcat部署"></a>5.2 tomcat部署</h2><h3 id="5-2-1拉取tomcat镜像"><a href="#5-2-1拉取tomcat镜像" class="headerlink" title="5.2.1拉取tomcat镜像"></a>5.2.1拉取tomcat镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat:7-jre7</span><br></pre></td></tr></table></figure>
<h3 id="5-2-2创建tomca容器"><a href="#5-2-2创建tomca容器" class="headerlink" title="5.2.2创建tomca容器"></a>5.2.2创建tomca容器</h3><p>创建容器用于部署单点登录系统（CAS）  -p表示地址映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=pinyougou_tomcat -p 9000:8080 </span><br><span class="line">-v /usr/local/myhtml:/usr/local/tomcat/webapps --privileged=true tomcat:7-jre7</span><br></pre></td></tr></table></figure>
<h3 id="5-2-3部署web应用"><a href="#5-2-3部署web应用" class="headerlink" title="5.2.3部署web应用"></a>5.2.3部署web应用</h3><p>（1）修改cas系统的配置文件，修改数据库连接的url </p>
<p>测试：地址栏输入：<a href="http://192.168.247.135:9000/cas/login" target="_blank" rel="noopener">http://192.168.247.135:9000/cas/login</a> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"</span><br><span class="line">		p:driverClass=<span class="string">"com.mysql.jdbc.Driver"</span></span><br><span class="line">		p:jdbcUrl=<span class="string">"jdbc:mysql://172.17.0.6:3306/pinyougoudb?characterEncoding=utf8"</span></span><br><span class="line">		p:user=<span class="string">"root"</span></span><br><span class="line">		p:password=<span class="string">"123456"</span> /&gt;</span><br></pre></td></tr></table></figure>
<h2 id="5-3-Nginx部署"><a href="#5-3-Nginx部署" class="headerlink" title="5.3 Nginx部署"></a>5.3 Nginx部署</h2><h3 id="5-3-1拉取Nginx镜像"><a href="#5-3-1拉取Nginx镜像" class="headerlink" title="5.3.1拉取Nginx镜像"></a>5.3.1拉取Nginx镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>
<h3 id="5-3-2创建Nginx容器"><a href="#5-3-2创建Nginx容器" class="headerlink" title="5.3.2创建Nginx容器"></a>5.3.2创建Nginx容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=pinyougou_nginx -p 80:80  nginx/bin/bash</span><br></pre></td></tr></table></figure>
<h3 id="5-3-3测试Nginx"><a href="#5-3-3测试Nginx" class="headerlink" title="5.3.3测试Nginx"></a>5.3.3测试Nginx</h3><p>浏览器地址栏输入： <a href="http://192.168.247.135" target="_blank" rel="noopener">http://192.168.247.135</a> </p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/docker/image42.png" alt="image42"></p>
<h3 id="5-3-4配置反向代理"><a href="#5-3-4配置反向代理" class="headerlink" title="5.3.4配置反向代理"></a>5.3.4配置反向代理</h3><p>官方的nginx镜像,nginx配置文件nginx.conf 在/etc/nginx/目录下。</p>
<p>在容器内编辑配置文件不方便，我们可以先将配置文件从容器内拷贝到宿主机，编辑修改后再拷贝回去。</p>
<p>（1）从容器拷贝配置文件到宿主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp pinyougou_nginx:/etc/nginx/nginx.conf nginx.conf</span><br></pre></td></tr></table></figure>
<p>（2）编辑nginx.conf，添加反向代理配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcat-cas &#123;</span><br><span class="line">	server <span class="number">172.17</span><span class="number">.0</span><span class="number">.7</span>:<span class="number">8080</span>;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">	listen <span class="number">80</span>;</span><br><span class="line">	server_name passport.pinyougou.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://tomcat-cas;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）将修改后的配置文件拷贝到容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp nginx.conf  pinyougou_nginx:/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<p>（4）重新启动容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart pinyougou_nginx</span><br></pre></td></tr></table></figure>
<p>（5）设置域名指向</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.247.135 passport.pinyougou.com</span><br></pre></td></tr></table></figure>
<p>浏览器测试：<a href="http://passport.pinyougou.com/cas/login" target="_blank" rel="noopener">http://passport.pinyougou.com/cas/login</a></p>
<h2 id="5-4-Redis部署"><a href="#5-4-Redis部署" class="headerlink" title="5.4 Redis部署"></a>5.4 Redis部署</h2><h3 id="5-4-1拉取Redis镜像"><a href="#5-4-1拉取Redis镜像" class="headerlink" title="5.4.1拉取Redis镜像"></a>5.4.1拉取Redis镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure>
<h3 id="5-4-2创建Redis容器"><a href="#5-4-2创建Redis容器" class="headerlink" title="5.4.2创建Redis容器"></a>5.4.2创建Redis容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=pinyougou_redis -p 6379:6379 redis</span><br></pre></td></tr></table></figure>
<h3 id="5-4-3客户端测试"><a href="#5-4-3客户端测试" class="headerlink" title="5.4.3客户端测试"></a>5.4.3客户端测试</h3><p>在你的本地电脑命令提示符下，用window版本redis测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.247.135</span><br></pre></td></tr></table></figure>
<h1 id="6-备份与迁移"><a href="#6-备份与迁移" class="headerlink" title="6.备份与迁移"></a>6.备份与迁移</h1><h2 id="6-1容器保存为镜像"><a href="#6-1容器保存为镜像" class="headerlink" title="6.1容器保存为镜像"></a>6.1容器保存为镜像</h2><p>我们可以通过以下命令将容器保存为镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit pinyougou_nginx mynginx</span><br></pre></td></tr></table></figure>
<p>pinyougou_nginx是容器名称</p>
<p>mynginx是新的镜像名称</p>
<p>此镜像的内容就是你当前容器的内容，接下来你可以用此镜像再次运行新的容器</p>
<h2 id="6-2镜像备份"><a href="#6-2镜像备份" class="headerlink" title="6.2镜像备份"></a>6.2镜像备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker  save -o mynginx.tar mynginx</span><br></pre></td></tr></table></figure>
<p>-o 输出到的文件</p>
<p>执行后，运行ls命令即可看到打成的tar包</p>
<h2 id="6-3镜像恢复与迁移"><a href="#6-3镜像恢复与迁移" class="headerlink" title="6.3镜像恢复与迁移"></a>6.3镜像恢复与迁移</h2><p>首先我们先删除掉mynginx镜像</p>
<p>然后执行此命令进行恢复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i mynginx.tar</span><br></pre></td></tr></table></figure>
<p>-i 输入的文件</p>
<p>执行后再次查看镜像，可以看到镜像已经恢复</p>
]]></content>
      
        <categories>
            
            <category> docker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> docker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[spring Boot简介及入门]]></title>
      <url>/2017/12/14/spring%20Boot%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%85%A5%E9%97%A8/</url>
      <content type="html"><![CDATA[<h1 id="1-Spring-Boot简介"><a href="#1-Spring-Boot简介" class="headerlink" title="1.Spring Boot简介"></a>1.Spring Boot简介</h1><p>​       Spring 诞生时是 Java 企业版（Java Enterprise Edition，JEE，也称 J2EE）的轻量级代替品。无需开发重量级的 Enterprise JavaBean（EJB），Spring 为企业级Java 开发提供了一种相对简单的方法，通过依赖注入和面向切面编程，用简单的Java 对象（Plain Old Java Object，POJO）实现了 EJB 的功能。</p>
<p>​       虽然 Spring 的组件代码是轻量级的，但它的配置却是重量级的。一开始，Spring 用 XML 配置，而且是很多 XML 配置。Spring 2.5 引入了基于注解的组件扫描，这消除了大量针对应用程序自身组件的显式 XML 配置。Spring 3.0 引入了基于 Java 的配置，这是一种类型安全的可重构配置方式，可以代替 XML。所有这些配置都代表了开发时的损耗。因为在思考 Spring 特性配置和解决业务问题之间需要进行思维切换，所以写配置挤占了写应用程序逻辑的时间。和所有框架一样，Spring 实用，但与此同时它要求的回报也不少。</p>
<p>​       除此之外，项目的依赖管理也是件吃力不讨好的事情。决定项目里要用哪些库就已经够让人头痛的了，你还要知道这些库的哪个版本和其他库不会有冲突，这难题实在太棘手。并且，依赖管理也是一种损耗，添加依赖不是写应用程序代码。一旦选错了依赖的版本，随之而来的不兼容问题毫无疑问会是生产力杀手。Spring Boot 让这一切成为了过去。</p>
<p>​       Spring Boot 是 Spring 社区较新的一个项目。该项目的目的是帮助开发者更容易的创建基于 Spring 的应用程序和服务，让更多人的人更快的对 Spring 进行入门体验，为 Spring 生态系统提供了一种固定的、约定优于配置风格的框架。</p>
<p>Spring Boot 具有如下特性：</p>
<p>（1）为基于 Spring 的开发提供更快的入门体验</p>
<p>（2）开箱即用，没有代码生成，也无需 XML 配置。同时也可以修改默认值来满足特定的需求。</p>
<p>（3）提供了一些大型项目中常见的非功能性特性，如嵌入式服务器、安全、指标，健康检测、外部配置等。</p>
<p>（4）Spring Boot 并不是不对 Spring 功能上的增强，而是提供了一种快速使用 Spring 的方式。</p>
<h1 id="2-Spring-Boot入门Demo"><a href="#2-Spring-Boot入门Demo" class="headerlink" title="2.Spring Boot入门Demo"></a>2.Spring Boot入门Demo</h1><h2 id="2-1起步依赖"><a href="#2-1起步依赖" class="headerlink" title="2.1起步依赖"></a>2.1起步依赖</h2><p>创建Maven工程 springboot_demo（打包方式jar）  </p>
<p>在pom.xml中添加如下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      </span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​     spring Boot会自动加载所需要的jar包,而这些jar包正式我们做开发时需要导入的jar包。因为这些jar包被我们刚才引入的spring-boot-starter-web所引用了，所以我们引用spring-boot-starter-web后会自动把依赖传递过来。</p>
<h2 id="2-2-变更JDK版本"><a href="#2-2-变更JDK版本" class="headerlink" title="2.2 变更JDK版本"></a>2.2 变更JDK版本</h2><p>​       我们发现默认情况下工程的JDK版本是1.6 ,而我们通常用使用1.7的版本，所以我们需要在pom.xml中添加以下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>添加后更新工程，会发现版本已经变更为1.7</p>
<h2 id="2-3-引导类"><a href="#2-3-引导类" class="headerlink" title="2.3 引导类"></a>2.3 引导类</h2><p>我们需要创建一个引导类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.sms.demo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单解释一下，@SpringBootApplication其实就是以下三个注解的总和</p>
<p>@Configuration： 用于定义一个配置类</p>
<p>@EnableAutoConfiguration ：Spring Boot会自动根据你jar包的依赖来自动配置项目。</p>
<p>@ComponentScan： 告诉Spring 哪个packages 的用注解标识的类 会被spring自动扫描并且装入bean容器。</p>
<p>我们直接执行这个引导类，会发现控制台出现的这个标识</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/spring_boot/image4.png" alt="image4"></p>
<h2 id="2-4-Spring-MVC实现Hello-World输出"><a href="#2-4-Spring-MVC实现Hello-World输出" class="headerlink" title="2.4 Spring MVC实现Hello World输出"></a>2.4 Spring MVC实现Hello World输出</h2><p>我们现在开始使用spring MVC框架，实现json数据的输出。如果按照我们原来的做法，需要在web.xml中添加一个DispatcherServlet的配置，再添加一个spring的配置文件，配置文件中需要添加如下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!-- 使用组件扫描，不用将controller在spring中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.itcast.demo.controller"</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 使用注解驱动不用在下边定义映射器和适配置器 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter"</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"supportedMediaTypes"</span> <span class="attr">value</span>=<span class="string">"application/json"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"features"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>WriteMapNullValue<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>WriteDateUseDateFormat<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是我们用SpringBoot，这一切都省了。我们直接写Controller类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.sms.demo.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/info"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">info</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"HelloWorld"</span>;		</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们运行启动类来运行程序</p>
<p>在浏览器地址栏输入 <a href="http://localhost:8080/info" target="_blank" rel="noopener">http://localhost:8080/info</a> 即可看到运行结果</p>
<h1 id="3-springBoot支持修改配置文件"><a href="#3-springBoot支持修改配置文件" class="headerlink" title="3 springBoot支持修改配置文件"></a>3 springBoot支持修改配置文件</h1><h2 id="3-1-修改tomcat启动端口"><a href="#3-1-修改tomcat启动端口" class="headerlink" title="3.1 修改tomcat启动端口"></a>3.1 修改tomcat启动端口</h2><p>在src/main/resources下创建application.properties</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port=8088</span><br></pre></td></tr></table></figure>
<p>重新运行引导类。地址栏输入</p>
<p><a href="http://localhost:8088/info" target="_blank" rel="noopener">http://localhost:8088/info</a></p>
<h2 id="3-2-读取配置文件信息"><a href="#3-2-读取配置文件信息" class="headerlink" title="3.2 读取配置文件信息"></a>3.2 读取配置文件信息</h2><p>在src/main/resources下的application.properties 增加配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http://www.baidu.com</span><br></pre></td></tr></table></figure>
<p>我要在类中读取这个配置信息，修改HelloWorldController  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Environment env;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/info"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">info</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"HelloWorld~~"</span>+env.getProperty(<span class="string">"url"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> springBoot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springBoot </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hadoop集群的搭建]]></title>
      <url>/2017/12/14/Hadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E6%90%AD%E5%BB%BA/</url>
      <content type="html"><![CDATA[<h1 id="1-准备Linux环境"><a href="#1-准备Linux环境" class="headerlink" title="1.准备Linux环境"></a>1.准备Linux环境</h1><p>​    </p>
<h2 id="1-1修改各个虚拟机主机名"><a href="#1-1修改各个虚拟机主机名" class="headerlink" title="1.1修改各个虚拟机主机名"></a>1.1修改各个虚拟机主机名</h2><pre><code>vi /etc/sysconfig/network

NETWORKING=yes
HOSTNAME=node-1    
</code></pre><h2 id="1-2修改主机名和IP的映射关系"><a href="#1-2修改主机名和IP的映射关系" class="headerlink" title="1.2修改主机名和IP的映射关系"></a>1.2修改主机名和IP的映射关系</h2><pre><code>vi /etc/hosts

192.168.1.101    node-1
192.168.1.102    node-2
192.168.1.103    node-3
</code></pre><h2 id="1-3关闭防火墙"><a href="#1-3关闭防火墙" class="headerlink" title="1.3关闭防火墙"></a>1.3关闭防火墙</h2><pre><code>#查看防火墙状态
service iptables status
#关闭防火墙
service iptables stop
#查看防火墙开机启动状态
chkconfig iptables --list
#关闭防火墙开机启动
chkconfig iptables off
</code></pre><h2 id="1-4-配置ssh免登陆"><a href="#1-4-配置ssh免登陆" class="headerlink" title="1.4.配置ssh免登陆"></a>1.4.配置ssh免登陆</h2><p>生成ssh免登陆密钥</p>
<p>ssh-keygen -t rsa （四个回车）</p>
<p>执行完这个命令后，会生成两个文件id_rsa（私钥）、id_rsa.pub（公钥）<br>将公钥拷贝到要免密登陆的目标机器上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id node-2</span><br></pre></td></tr></table></figure>
<h2 id="1-5-同步集群时间"><a href="#1-5-同步集群时间" class="headerlink" title="1.5 同步集群时间"></a>1.5 同步集群时间</h2><p>常用的手动进行时间的同步</p>
<pre><code>date -s &quot;2017-03-03 03:03:03&quot;
</code></pre><p>或者网络同步：<br>    yum install ntpdate</p>
<pre><code>ntpdate cn.pool.ntp.org
</code></pre><hr>
<h1 id="2-安装JDK"><a href="#2-安装JDK" class="headerlink" title="2.安装JDK"></a>2.安装JDK</h1><h2 id="2-1上传jdk"><a href="#2-1上传jdk" class="headerlink" title="2.1上传jdk"></a>2.1上传jdk</h2><pre><code>rz jdk-8u65-linux-x64.tar.gz
</code></pre><h2 id="2-2解压jdk"><a href="#2-2解压jdk" class="headerlink" title="2.2解压jdk"></a>2.2解压jdk</h2><pre><code>tar -zxvf jdk-8u65-linux-x64.tar.gz -C /root/apps
</code></pre><h2 id="2-3将java添加到环境变量中"><a href="#2-3将java添加到环境变量中" class="headerlink" title="2.3将java添加到环境变量中"></a>2.3将java添加到环境变量中</h2><pre><code>vim /etc/profile
#在文件最后添加
export JAVA_HOME=/root/apps/jdk1.8.0_65
export PATH=$PATH:$JAVA_HOME/bin
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

#刷新配置
source /etc/profile
</code></pre><hr>
<h1 id="3-安装hadoop2-7-4"><a href="#3-安装hadoop2-7-4" class="headerlink" title="3.安装hadoop2.7.4"></a>3.安装hadoop2.7.4</h1><pre><code>hadoop-2.7.4-with-centos-6.7.tar.gz
解压安装包
tar zxvf hadoop-2.7.4-with-centos-6.7.tar.gz
</code></pre><p>注意：1.hadoop2.x的配置文件目录：$HADOOP_HOME/etc/hadoop</p>
<p>​       2.生产环境下需要根据生产机器重新编译Hadoop:<a href="https://minrui.red/2017/12/11/hadoop%E7%BC%96%E8%AF%91/" target="_blank" rel="noopener">https://minrui.red/2017/12/11/hadoop%E7%BC%96%E8%AF%91/</a></p>
<h2 id="3-1配置hadoop"><a href="#3-1配置hadoop" class="headerlink" title="3.1配置hadoop"></a>3.1配置hadoop</h2><p>第一个：hadoop-env.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi hadoop-env.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/root/apps/jdk1.8.0_65</span><br></pre></td></tr></table></figure>
<p>第二个：core-site.xml</p>
<pre><code> &lt;!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 --&gt;
&lt;property&gt;
        &lt;name&gt;fs.defaultFS&lt;/name&gt;
        &lt;value&gt;hdfs://master:9000&lt;/value&gt;
　　　　 &lt;description&gt; 设定 namenode 的 主机名 及 端口 &lt;/description&gt;
&lt;/property&gt;
&lt;!-- 指定hadoop运行时产生文件的存储目录,默认/tmp/hadoop-${user.name} --&gt;
&lt;property&gt;
   &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
   &lt;value&gt;/home/hadoop/hadoop-2.4.1/tmp&lt;/value&gt;
&lt;/property&gt;
</code></pre><p>第三个：hdfs-site.xml   </p>
<pre><code>&lt;!-- 指定HDFS副本的数量 --&gt;
&lt;property&gt;
  &lt;name&gt;dfs.replication&lt;/name&gt;
  &lt;value&gt;2&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
     &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;
      &lt;value&gt;node-22:50090&lt;/value&gt;
&lt;/property&gt;
</code></pre><hr>
<p>第四个：mapred-site.xml<br>​<br>mv mapred-site.xml.template mapred-site.xml<br>vi mapred-site.xml</p>
<pre><code>&lt;!-- 指定mr运行时框架，这里指定在yarn上，默认是local --&gt;
&lt;property&gt;
  &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
  &lt;value&gt;yarn&lt;/value&gt;
&lt;/property&gt;
</code></pre><p>第五个：yarn-site.xml</p>
<pre><code>&lt;!-- 指定YARN的老大（ResourceManager）的地址 --&gt;
&lt;property&gt;
  &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;
  &lt;value&gt;node-1&lt;/value&gt;
&lt;/property&gt;
&lt;!-- NodeManager上运行的附属服务。需配置成mapreduce_shuffle，才可运行MapReduce程序默认值：&quot;&quot; --&gt;
&lt;property&gt;
  &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
  &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
&lt;/property&gt;
</code></pre><p>第六个：slaves文件，里面写上从节点所在的主机名字vi slaves</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node-1</span><br><span class="line">node-2</span><br><span class="line">node-3</span><br></pre></td></tr></table></figure>
<p>3.2将hadoop添加到环境变量<br>​    vim /etc/proflie<br>        export JAVA_HOME=/root/apps/jdk1.8.0_65<br>        export HADOOP_HOME=/root/apps/hadoop-2.7.4<br>        export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</p>
<p>source /etc/profile</p>
<hr>
<pre><code>3.3格式化namenode（本质是对namenode进行初始化）
    hdfs namenode -format (hadoop namenode -format)

3.4启动hadoop
    先启动HDFS
    sbin/start-dfs.sh

    再启动YARN
    sbin/start-yarn.sh

3.5验证是否启动成功
    使用jps命令验证
    27408 NameNode
    28218 Jps
    27643 SecondaryNameNode   (secondarynamenode)
    28066 NodeManager
    27803 ResourceManager
    27512 DataNode

    http://192.168.1.101:50070 （HDFS管理界面）
    http://192.168.1.101:8088 （MR管理界面）
</code></pre><p>​<br>启动后如果没异常，使用jps查看服务<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/jps1.png" alt="jps1"><br>如果没问题，去浏览器查看web页面<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/hadoop-web.png" alt="hadoop-web"></p>
]]></content>
      
        <categories>
            
            <category> 大数据 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> 集群搭建 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Spring Boot配置文件application]]></title>
      <url>/2017/12/14/Spring%20Boot%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6application/</url>
      <content type="html"><![CDATA[<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br></pre></td><td class="code"><pre><span class="line">#########COMMON SPRING BOOT PROPERTIES</span><br><span class="line">######========CORE PROPERTIES===========</span><br><span class="line">#SPRING CONFIG (ConfigFileApplicationListener)</span><br><span class="line"></span><br><span class="line">spring.config.name= # config file name (default to 'application')</span><br><span class="line">spring.config.location= # location of config file</span><br><span class="line"></span><br><span class="line">#PROFILES</span><br><span class="line">spring.profiles= # comma list of active profiles</span><br><span class="line"></span><br><span class="line">#APPLICATION SETTINGS (SpringApplication)</span><br><span class="line">spring.main.sources=</span><br><span class="line">spring.main.web-environment= # detect by default</span><br><span class="line">spring.main.show-banner=true</span><br><span class="line">spring.main....= # see class for all properties</span><br><span class="line"></span><br><span class="line">#LOGGING</span><br><span class="line">logging.path=/var/logs</span><br><span class="line">logging.file=myapp.log</span><br><span class="line">logging.config=</span><br><span class="line"></span><br><span class="line">#IDENTITY (ContextIdApplicationContextInitializer)</span><br><span class="line">spring.application.name=</span><br><span class="line">spring.application.index=</span><br><span class="line"></span><br><span class="line">#EMBEDDED SERVER CONFIGURATION (ServerProperties)</span><br><span class="line">server.port=8080</span><br><span class="line">server.address= # bind to a specific NIC</span><br><span class="line">server.session-timeout= # session timeout in seconds</span><br><span class="line">server.context-path= # the context path, defaults to '/'</span><br><span class="line">server.servlet-path= # the servlet path, defaults to '/'</span><br><span class="line">server.tomcat.access-log-pattern= # log pattern of the access log</span><br><span class="line">server.tomcat.access-log-enabled=false # is access logging enabled</span><br><span class="line">server.tomcat.protocol-header=x-forwarded-proto # ssl forward headers</span><br><span class="line">server.tomcat.remote-ip-header=x-forwarded-for</span><br><span class="line">server.tomcat.basedir=/tmp # base dir (usually not needed, defaults to tmp)</span><br><span class="line">server.tomcat.background-processor-delay=30; # in seconds</span><br><span class="line">server.tomcat.max-threads = 0 # number of threads in protocol handler</span><br><span class="line">server.tomcat.uri-encoding = UTF-8 # character encoding to use for URL decoding</span><br><span class="line"></span><br><span class="line">#SPRING MVC (HttpMapperProperties)</span><br><span class="line">http.mappers.json-pretty-print=false # pretty print JSON</span><br><span class="line">http.mappers.json-sort-keys=false # sort keys</span><br><span class="line">spring.mvc.locale= # set fixed locale, e.g. enUK</span><br><span class="line">spring.mvc.date-format= # set fixed date format, e.g. dd/MM/yyyy</span><br><span class="line">spring.mvc.message-codes-resolver-format= # PREFIXERRORCODE / POSTFIXERROR_CODE</span><br><span class="line">spring.view.prefix= # MVC view prefix</span><br><span class="line">spring.view.suffix= # ... and suffix</span><br><span class="line">spring.resources.cache-period= # cache timeouts in headers sent to browser</span><br><span class="line">spring.resources.add-mappings=true # if default mappings should be added</span><br><span class="line"></span><br><span class="line">#THYMELEAF (ThymeleafAutoConfiguration)</span><br><span class="line">spring.thymeleaf.prefix=classpath:/templates/</span><br><span class="line">spring.thymeleaf.suffix=.html</span><br><span class="line">spring.thymeleaf.mode=HTML5</span><br><span class="line">spring.thymeleaf.encoding=UTF-8</span><br><span class="line">spring.thymeleaf.content-type=text/html # ;charset=<span class="tag">&lt;<span class="name">encoding</span>&gt;</span> is added</span><br><span class="line">spring.thymeleaf.cache=true # set to false for hot refresh</span><br><span class="line"></span><br><span class="line">#FREEMARKER (FreeMarkerAutoConfiguration)</span><br><span class="line">spring.freemarker.allowRequestOverride=false</span><br><span class="line">spring.freemarker.allowSessionOverride=false</span><br><span class="line">spring.freemarker.cache=true</span><br><span class="line">spring.freemarker.checkTemplateLocation=true</span><br><span class="line">spring.freemarker.contentType=text/html</span><br><span class="line">spring.freemarker.exposeRequestAttributes=false</span><br><span class="line">spring.freemarker.exposeSessionAttributes=false</span><br><span class="line">spring.freemarker.exposeSpringMacroHelpers=false</span><br><span class="line">spring.freemarker.prefix=</span><br><span class="line">spring.freemarker.requestContextAttribute=</span><br><span class="line">spring.freemarker.settings.*=</span><br><span class="line">spring.freemarker.suffix=.ftl</span><br><span class="line">spring.freemarker.templateEncoding=UTF-8</span><br><span class="line">spring.freemarker.templateLoaderPath=classpath:/templates/</span><br><span class="line">spring.freemarker.viewNames= # whitelist of view names that can be resolved</span><br><span class="line"></span><br><span class="line">#GROOVY TEMPLATES (GroovyTemplateAutoConfiguration)</span><br><span class="line">spring.groovy.template.allowRequestOverride=false</span><br><span class="line">spring.groovy.template.allowSessionOverride=false</span><br><span class="line">spring.groovy.template.cache=true</span><br><span class="line">spring.groovy.template.configuration.*= # See Groovy's TemplateConfiguration</span><br><span class="line">spring.groovy.template.contentType=text/html</span><br><span class="line">spring.groovy.template.prefix=classpath:/templates/</span><br><span class="line">spring.groovy.template.suffix=.tpl</span><br><span class="line">spring.groovy.template.templateEncoding=UTF-8</span><br><span class="line">spring.groovy.template.viewNames= # whitelist of view names that can be resolved</span><br><span class="line"></span><br><span class="line">#VELOCITY TEMPLATES (VelocityAutoConfiguration)</span><br><span class="line">spring.velocity.allowRequestOverride=false</span><br><span class="line">spring.velocity.allowSessionOverride=false</span><br><span class="line">spring.velocity.cache=true</span><br><span class="line">spring.velocity.checkTemplateLocation=true</span><br><span class="line">spring.velocity.contentType=text/html</span><br><span class="line">spring.velocity.dateToolAttribute=</span><br><span class="line">spring.velocity.exposeRequestAttributes=false</span><br><span class="line">spring.velocity.exposeSessionAttributes=false</span><br><span class="line">spring.velocity.exposeSpringMacroHelpers=false</span><br><span class="line">spring.velocity.numberToolAttribute=</span><br><span class="line">spring.velocity.prefix=</span><br><span class="line">spring.velocity.properties.*=</span><br><span class="line">spring.velocity.requestContextAttribute=</span><br><span class="line">spring.velocity.resourceLoaderPath=classpath:/templates/</span><br><span class="line">spring.velocity.suffix=.vm</span><br><span class="line">spring.velocity.templateEncoding=UTF-8</span><br><span class="line">spring.velocity.viewNames= # whitelist of view names that can be resolved</span><br><span class="line"></span><br><span class="line">#INTERNATIONALIZATION (MessageSourceAutoConfiguration)</span><br><span class="line">spring.messages.basename=messages</span><br><span class="line">spring.messages.cacheSeconds=-1</span><br><span class="line">spring.messages.encoding=UTF-8</span><br><span class="line"></span><br><span class="line">#SECURITY (SecurityProperties)</span><br><span class="line">security.user.name=user # login username</span><br><span class="line">security.user.password= # login password</span><br><span class="line">security.user.role=USER # role assigned to the user</span><br><span class="line">security.require-ssl=false # advanced settings ...</span><br><span class="line">security.enable-csrf=false</span><br><span class="line">security.basic.enabled=true</span><br><span class="line">security.basic.realm=Spring</span><br><span class="line">security.basic.path= # /**</span><br><span class="line">security.headers.xss=false</span><br><span class="line">security.headers.cache=false</span><br><span class="line">security.headers.frame=false</span><br><span class="line">security.headers.contentType=false</span><br><span class="line">security.headers.hsts=all # none / domain / all</span><br><span class="line">security.sessions=stateless # always / never / if_required / stateless</span><br><span class="line">security.ignored=false</span><br><span class="line"></span><br><span class="line">#DATASOURCE (DataSourceAutoConfiguration &amp; DataSourceProperties)</span><br><span class="line">spring.datasource.name= # name of the data source</span><br><span class="line">spring.datasource.initialize=true # populate using data.sql</span><br><span class="line">spring.datasource.schema= # a schema (DDL) script resource reference</span><br><span class="line">spring.datasource.data= # a data (DML) script resource reference</span><br><span class="line">spring.datasource.platform= # the platform to use in the schema resource (schema-$&#123;platform&#125;.sql)</span><br><span class="line">spring.datasource.continueOnError=false # continue even if can't be initialized</span><br><span class="line">spring.datasource.separator=; # statement separator in SQL initialization scripts</span><br><span class="line">spring.datasource.driverClassName= # JDBC Settings...</span><br><span class="line">spring.datasource.url=</span><br><span class="line">spring.datasource.username=</span><br><span class="line">spring.datasource.password=</span><br><span class="line">spring.datasource.max-active=100 # Advanced configuration...</span><br><span class="line">spring.datasource.max-idle=8</span><br><span class="line">spring.datasource.min-idle=8</span><br><span class="line">spring.datasource.initial-size=10</span><br><span class="line">spring.datasource.validation-query=</span><br><span class="line">spring.datasource.test-on-borrow=false</span><br><span class="line">spring.datasource.test-on-return=false</span><br><span class="line">spring.datasource.test-while-idle=</span><br><span class="line">spring.datasource.time-between-eviction-runs-millis=</span><br><span class="line">spring.datasource.min-evictable-idle-time-millis=</span><br><span class="line">spring.datasource.max-wait-millis=</span><br><span class="line"></span><br><span class="line">#MONGODB (MongoProperties)</span><br><span class="line">spring.data.mongodb.host= # the db host</span><br><span class="line">spring.data.mongodb.port=27017 # the connection port (defaults to 27107)</span><br><span class="line">spring.data.mongodb.uri=mongodb://localhost/test # connection URL</span><br><span class="line">spring.data.mongo.repositories.enabled=true # if spring data repository support is enabled</span><br><span class="line"></span><br><span class="line">#JPA (JpaBaseConfiguration, HibernateJpaAutoConfiguration)</span><br><span class="line">spring.jpa.properties.*= # properties to set on the JPA connection</span><br><span class="line">spring.jpa.openInView=true</span><br><span class="line">spring.jpa.show-sql=true</span><br><span class="line">spring.jpa.database-platform=</span><br><span class="line">spring.jpa.database=</span><br><span class="line">spring.jpa.generate-ddl=false # ignored by Hibernate, might be useful for other vendors</span><br><span class="line">spring.jpa.hibernate.naming-strategy= # naming classname</span><br><span class="line">spring.jpa.hibernate.ddl-auto= # defaults to create-drop for embedded dbs</span><br><span class="line">spring.data.jpa.repositories.enabled=true # if spring data repository support is enabled</span><br><span class="line"></span><br><span class="line">#SOLR (SolrProperties&#125;)</span><br><span class="line">spring.data.solr.host=http://127.0.0.1:8983/solr</span><br><span class="line">spring.data.solr.zkHost=</span><br><span class="line">spring.data.solr.repositories.enabled=true # if spring data repository support is enabled</span><br><span class="line"></span><br><span class="line">#ELASTICSEARCH (ElasticsearchProperties&#125;)</span><br><span class="line">spring.data.elasticsearch.cluster-name= # The cluster name (defaults to elasticsearch)</span><br><span class="line">spring.data.elasticsearch.cluster-nodes= # The address(es) of the server node (comma-separated; if not specified starts a client node)</span><br><span class="line">spring.data.elasticsearch.local=true # if local mode should be used with client nodes</span><br><span class="line">spring.data.elasticsearch.repositories.enabled=true # if spring data repository support is enabled</span><br><span class="line"></span><br><span class="line">#FLYWAY (FlywayProperties)</span><br><span class="line">flyway.locations=classpath:db/migrations # locations of migrations scripts</span><br><span class="line">flyway.schemas= # schemas to update</span><br><span class="line">flyway.initVersion= 1 # version to start migration</span><br><span class="line">flyway.prefix=V</span><br><span class="line">flyway.suffix=.sql</span><br><span class="line">flyway.enabled=true</span><br><span class="line">flyway.url= # JDBC url if you want Flyway to create its own DataSource</span><br><span class="line">flyway.user= # JDBC username if you want Flyway to create its own DataSource</span><br><span class="line">flyway.password= # JDBC password if you want Flyway to create its own DataSource</span><br><span class="line"></span><br><span class="line">#LIQUIBASE (LiquibaseProperties)</span><br><span class="line">liquibase.change-log=classpath:/db/changelog/db.changelog-master.yaml</span><br><span class="line">liquibase.contexts= # runtime contexts to use</span><br><span class="line">liquibase.default-schema= # default database schema to use</span><br><span class="line">liquibase.drop-first=false</span><br><span class="line">liquibase.enabled=true</span><br><span class="line"></span><br><span class="line">#JMX</span><br><span class="line">spring.jmx.enabled=true # Expose MBeans from Spring</span><br><span class="line"></span><br><span class="line">#ABBIT (RabbitProperties)</span><br><span class="line">spring.rabbitmq.host= # connection host</span><br><span class="line">spring.rabbitmq.port= # connection port</span><br><span class="line">spring.rabbitmq.addresses= # connection addresses (e.g. myhost:9999,otherhost:1111)</span><br><span class="line">spring.rabbitmq.username= # login user</span><br><span class="line">spring.rabbitmq.password= # login password</span><br><span class="line">spring.rabbitmq.virtualhost=</span><br><span class="line">spring.rabbitmq.dynamic=</span><br><span class="line"></span><br><span class="line">#REDIS (RedisProperties)</span><br><span class="line">spring.redis.host=localhost # server host</span><br><span class="line">spring.redis.password= # server password</span><br><span class="line">spring.redis.port=6379 # connection port</span><br><span class="line">spring.redis.pool.max-idle=8 # pool settings ...</span><br><span class="line">spring.redis.pool.min-idle=0</span><br><span class="line">spring.redis.pool.max-active=8</span><br><span class="line">spring.redis.pool.max-wait=-1</span><br><span class="line"></span><br><span class="line">#ACTIVEMQ (ActiveMQProperties)</span><br><span class="line">spring.activemq.broker-url=tcp://localhost:61616 # connection URL</span><br><span class="line">spring.activemq.user=</span><br><span class="line">spring.activemq.password=</span><br><span class="line">spring.activemq.in-memory=true # broker kind to create if no broker-url is specified</span><br><span class="line">spring.activemq.pooled=false</span><br><span class="line"></span><br><span class="line">#HornetQ (HornetQProperties)</span><br><span class="line">spring.hornetq.mode= # connection mode (native, embedded)</span><br><span class="line">spring.hornetq.host=localhost # hornetQ host (native mode)</span><br><span class="line">spring.hornetq.port=5445 # hornetQ port (native mode)</span><br><span class="line">spring.hornetq.embedded.enabled=true # if the embedded server is enabled (needs hornetq-jms-server.jar)</span><br><span class="line">spring.hornetq.embedded.serverId= # auto-generated id of the embedded server (integer)</span><br><span class="line">spring.hornetq.embedded.persistent=false # message persistence</span><br><span class="line">spring.hornetq.embedded.data-directory= # location of data content (when persistence is enabled)</span><br><span class="line">spring.hornetq.embedded.queues= # comma separate queues to create on startup</span><br><span class="line">spring.hornetq.embedded.topics= # comma separate topics to create on startup</span><br><span class="line">spring.hornetq.embedded.cluster-password= # customer password (randomly generated by default)</span><br><span class="line"></span><br><span class="line">#JMS (JmsProperties)</span><br><span class="line">spring.jms.pub-sub-domain= # false for queue (default), true for topic</span><br><span class="line"></span><br><span class="line">#SPRING BATCH (BatchDatabaseInitializer)</span><br><span class="line">spring.batch.job.names=job1,job2</span><br><span class="line">spring.batch.job.enabled=true</span><br><span class="line">spring.batch.initializer.enabled=true</span><br><span class="line">spring.batch.schema= # batch schema to load</span><br><span class="line"></span><br><span class="line">#AOP</span><br><span class="line">spring.aop.auto=</span><br><span class="line">spring.aop.proxy-target-class=</span><br><span class="line"></span><br><span class="line">#FILE ENCODING (FileEncodingApplicationListener)</span><br><span class="line">spring.mandatory-file-encoding=false</span><br><span class="line"></span><br><span class="line">#SPRING SOCIAL (SocialWebAutoConfiguration)</span><br><span class="line">spring.social.auto-connection-views=true # Set to true for default connection views or false if you provide your own</span><br><span class="line"></span><br><span class="line">#SPRING SOCIAL FACEBOOK (FacebookAutoConfiguration)</span><br><span class="line">spring.social.facebook.app-id= # your application's Facebook App ID</span><br><span class="line">spring.social.facebook.app-secret= # your application's Facebook App Secret</span><br><span class="line"></span><br><span class="line">#SPRING SOCIAL LINKEDIN (LinkedInAutoConfiguration)</span><br><span class="line">spring.social.linkedin.app-id= # your application's LinkedIn App ID</span><br><span class="line">spring.social.linkedin.app-secret= # your application's LinkedIn App Secret</span><br><span class="line"></span><br><span class="line">#SPRING SOCIAL TWITTER (TwitterAutoConfiguration)</span><br><span class="line">spring.social.twitter.app-id= # your application's Twitter App ID</span><br><span class="line">spring.social.twitter.app-secret= # your application's Twitter App Secret</span><br><span class="line"></span><br><span class="line">#SPRING MOBILE SITE PREFERENCE (SitePreferenceAutoConfiguration)</span><br><span class="line">spring.mobile.sitepreference.enabled=true # enabled by default</span><br><span class="line"></span><br><span class="line">#SPRING MOBILE DEVICE VIEWS (DeviceDelegatingViewResolverAutoConfiguration)</span><br><span class="line">spring.mobile.devicedelegatingviewresolver.enabled=true # disabled by default</span><br><span class="line">spring.mobile.devicedelegatingviewresolver.normalPrefix=</span><br><span class="line">spring.mobile.devicedelegatingviewresolver.normalSuffix=</span><br><span class="line">spring.mobile.devicedelegatingviewresolver.mobilePrefix=mobile/</span><br><span class="line">spring.mobile.devicedelegatingviewresolver.mobileSuffix=</span><br><span class="line">spring.mobile.devicedelegatingviewresolver.tabletPrefix=tablet/</span><br><span class="line">spring.mobile.devicedelegatingviewresolver.tabletSuffix=</span><br><span class="line"></span><br><span class="line">######========ACTUATOR PROPERTIES===========</span><br><span class="line"></span><br><span class="line">#MANAGEMENT HTTP SERVER (ManagementServerProperties)</span><br><span class="line">management.port= # defaults to 'server.port'</span><br><span class="line">management.address= # bind to a specific NIC</span><br><span class="line">management.contextPath= # default to '/'</span><br><span class="line"></span><br><span class="line">#ENDPOINTS (AbstractEndpoint subclasses)</span><br><span class="line">endpoints.autoconfig.id=autoconfig</span><br><span class="line">endpoints.autoconfig.sensitive=true</span><br><span class="line">endpoints.autoconfig.enabled=true</span><br><span class="line">endpoints.beans.id=beans</span><br><span class="line">endpoints.beans.sensitive=true</span><br><span class="line">endpoints.beans.enabled=true</span><br><span class="line">endpoints.configprops.id=configprops</span><br><span class="line">endpoints.configprops.sensitive=true</span><br><span class="line">endpoints.configprops.enabled=true</span><br><span class="line">endpoints.configprops.keys-to-sanitize=password,secret</span><br><span class="line">endpoints.dump.id=dump</span><br><span class="line">endpoints.dump.sensitive=true</span><br><span class="line">endpoints.dump.enabled=true</span><br><span class="line">endpoints.env.id=env</span><br><span class="line">endpoints.env.sensitive=true</span><br><span class="line">endpoints.env.enabled=true</span><br><span class="line">endpoints.health.id=health</span><br><span class="line">endpoints.health.sensitive=false</span><br><span class="line">endpoints.health.enabled=true</span><br><span class="line">endpoints.info.id=info</span><br><span class="line">endpoints.info.sensitive=false</span><br><span class="line">endpoints.info.enabled=true</span><br><span class="line">endpoints.metrics.id=metrics</span><br><span class="line">endpoints.metrics.sensitive=true</span><br><span class="line">endpoints.metrics.enabled=true</span><br><span class="line">endpoints.shutdown.id=shutdown</span><br><span class="line">endpoints.shutdown.sensitive=true</span><br><span class="line">endpoints.shutdown.enabled=false</span><br><span class="line">endpoints.trace.id=trace</span><br><span class="line">endpoints.trace.sensitive=true</span><br><span class="line">endpoints.trace.enabled=true</span><br><span class="line"></span><br><span class="line">#MVC ONLY ENDPOINTS</span><br><span class="line">endpoints.jolokia.path=jolokia</span><br><span class="line">endpoints.jolokia.sensitive=true</span><br><span class="line">endpoints.jolokia.enabled=true # when using Jolokia</span><br><span class="line">endpoints.error.path=/error</span><br><span class="line"></span><br><span class="line">#JMX ENDPOINT (EndpointMBeanExportProperties)</span><br><span class="line">endpoints.jmx.enabled=true</span><br><span class="line">endpoints.jmx.domain= # the JMX domain, defaults to 'org.springboot'</span><br><span class="line">endpoints.jmx.unique-names=false</span><br><span class="line">endpoints.jmx.enabled=true</span><br><span class="line">endpoints.jmx.staticNames=</span><br><span class="line"></span><br><span class="line">#JOLOKIA (JolokiaProperties)</span><br><span class="line">jolokia.config.*= # See Jolokia manual</span><br><span class="line"></span><br><span class="line">#REMOTE SHELL</span><br><span class="line">shell.auth=simple # jaas, key, simple, spring</span><br><span class="line">shell.command-refresh-interval=-1</span><br><span class="line">shell.command-path-pattern= # classpath:/commands/, classpath:/crash/commands/</span><br><span class="line">shell.config-path-patterns= # classpath:/crash/</span><br><span class="line">shell.disabled-plugins=false # don't expose plugins</span><br><span class="line">shell.ssh.enabled= # ssh settings ...</span><br><span class="line">shell.ssh.keyPath=</span><br><span class="line">shell.ssh.port=</span><br><span class="line">shell.telnet.enabled= # telnet settings ...</span><br><span class="line">shell.telnet.port=</span><br><span class="line">shell.auth.jaas.domain= # authentication settings ...</span><br><span class="line">shell.auth.key.path=</span><br><span class="line">shell.auth.simple.user.name=</span><br><span class="line">shell.auth.simple.user.password=</span><br><span class="line">shell.auth.spring.roles=</span><br><span class="line"></span><br><span class="line">#GIT INFO</span><br><span class="line">spring.git.properties= # resource ref to generated git info properties file</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> springBoot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springBoot </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Spring Boot应用启动器]]></title>
      <url>/2017/12/14/Spring%20Boot%E5%BA%94%E7%94%A8%E5%90%AF%E5%8A%A8%E5%99%A8/</url>
      <content type="html"><![CDATA[<h1 id="Spring-Boot应用启动器"><a href="#Spring-Boot应用启动器" class="headerlink" title="Spring Boot应用启动器"></a>Spring Boot应用启动器</h1><h2 id="spring-Boot应用启动器基本的一共有44种，具体如下："><a href="#spring-Boot应用启动器基本的一共有44种，具体如下：" class="headerlink" title="spring Boot应用启动器基本的一共有44种，具体如下："></a>spring Boot应用启动器基本的一共有44种，具体如下：</h2><p>1）spring-boot-starter<br>这是Spring Boot的核心启动器，包含了自动配置、日志和YAML。</p>
<p>2）spring-boot-starter-actuator<br>帮助监控和管理应用。</p>
<p>3）spring-boot-starter-amqp<br>通过spring-rabbit来支持AMQP协议（Advanced Message Queuing Protocol）。</p>
<p>4）spring-boot-starter-aop<br>支持面向方面的编程即AOP，包括spring-aop和AspectJ。</p>
<p>5）spring-boot-starter-artemis<br>通过Apache Artemis支持JMS的API（<a href="http://lib.csdn.net/base/java" target="_blank" rel="noopener">Java </a>Message Service API）。</p>
<p>6）spring-boot-starter-batch<br>支持Spring Batch，包括HSQLDB<a href="http://lib.csdn.net/base/mysql" target="_blank" rel="noopener">数据库</a>。</p>
<p>7）spring-boot-starter-cache<br>支持Spring的Cache抽象。</p>
<p>8）spring-boot-starter-cloud-connectors<br>支持Spring Cloud Connectors，简化了在像Cloud Foundry或Heroku这样的云平台上连接服务。</p>
<p>9）spring-boot-starter-data-elasticsearch<br>支持ElasticSearch搜索和分析引擎，包括spring-data-elasticsearch。</p>
<p>10）spring-boot-starter-data-gemfire<br>支持GemFire分布式数据存储，包括spring-data-gemfire。</p>
<p>11）spring-boot-starter-data-jpa<br>支持JPA（<a href="http://lib.csdn.net/base/javase" target="_blank" rel="noopener">Java</a> Persistence API），包括spring-data-jpa、spring-orm、<a href="http://lib.csdn.net/base/javaee" target="_blank" rel="noopener">hibernate</a>。</p>
<p>12）spring-boot-starter-data-<a href="http://lib.csdn.net/base/mongodb" target="_blank" rel="noopener">MongoDB</a><br>支持MongoDB数据，包括spring-data-mongodb。</p>
<p>13）spring-boot-starter-data-rest<br>通过spring-data-rest-webmvc，支持通过REST暴露Spring Data数据仓库。</p>
<p>14）spring-boot-starter-data-solr<br>支持Apache Solr搜索平台，包括spring-data-solr。</p>
<p>15）spring-boot-starter-freemarker<br>支持FreeMarker模板引擎。</p>
<p>16）spring-boot-starter-groovy-templates<br>支持Groovy模板引擎。</p>
<p>17）spring-boot-starter-hateoas<br>通过spring-hateoas支持基于HATEOAS的RESTful Web服务。</p>
<p>18）spring-boot-starter-hornetq<br>通过HornetQ支持JMS。</p>
<p>19）spring-boot-starter-integration<br>支持通用的spring-integration模块。</p>
<p>20）spring-boot-starter-jdbc<br>支持JDBC数据库。</p>
<p>21）spring-boot-starter-jersey<br>支持Jersey RESTful Web服务框架。</p>
<p>22）spring-boot-starter-jta-atomikos<br>通过Atomikos支持JTA分布式事务处理。</p>
<p>23）spring-boot-starter-jta-bitronix<br>通过Bitronix支持JTA分布式事务处理。</p>
<p>24）spring-boot-starter-mail<br>支持javax.mail模块。</p>
<p>25）spring-boot-starter-mobile<br>支持spring-mobile。</p>
<p>26）spring-boot-starter-mustache<br>支持Mustache模板引擎。</p>
<p>27）spring-boot-starter-<a href="http://lib.csdn.net/base/redis" target="_blank" rel="noopener">Redis</a><br>支持Redis键值存储数据库，包括spring-redis。</p>
<p>28）spring-boot-starter-security<br>支持spring-security。</p>
<p>29）spring-boot-starter-social-facebook<br>支持spring-social-facebook</p>
<p>30）spring-boot-starter-social-linkedin<br>支持pring-social-linkedin</p>
<p>31）spring-boot-starter-social-twitter<br>支持pring-social-twitter</p>
<p>32）spring-boot-starter-test<br>支持常规的<a href="http://lib.csdn.net/base/softwaretest" target="_blank" rel="noopener">测试</a>依赖，包括JUnit、Hamcrest、Mockito以及spring-test模块。</p>
<p>33）spring-boot-starter-thymeleaf<br>支持Thymeleaf模板引擎，包括与Spring的集成。</p>
<p>34）spring-boot-starter-velocity<br>支持Velocity模板引擎。</p>
<p>35）spring-boot-starter-web<br>S支持全栈式Web开发，包括Tomcat和spring-webmvc。</p>
<p>36）spring-boot-starter-websocket<br>支持WebSocket开发。</p>
<p>37）spring-boot-starter-ws<br>支持Spring Web Services。</p>
<h2 id="Spring-Boot应用启动器面向生产环境的还有2种，具体如下："><a href="#Spring-Boot应用启动器面向生产环境的还有2种，具体如下：" class="headerlink" title="Spring Boot应用启动器面向生产环境的还有2种，具体如下："></a>Spring Boot应用启动器面向生产环境的还有2种，具体如下：</h2><p>1）spring-boot-starter-actuator<br>增加了面向产品上线相关的功能，比如测量和监控。</p>
<p>2）spring-boot-starter-remote-shell<br>增加了远程ssh shell的支持。</p>
<h2 id="Spring-Boot应用启动器还有一些替换技术的启动器，具体如下："><a href="#Spring-Boot应用启动器还有一些替换技术的启动器，具体如下：" class="headerlink" title="Spring Boot应用启动器还有一些替换技术的启动器，具体如下："></a>Spring Boot应用启动器还有一些替换技术的启动器，具体如下：</h2><p>1）spring-boot-starter-jetty<br>引入了Jetty HTTP引擎（用于替换Tomcat）。</p>
<p>2）spring-boot-starter-log4j<br>支持Log4J日志框架。</p>
<p>3）spring-boot-starter-logging<br>引入了Spring Boot默认的日志框架Logback。</p>
<p>4）spring-boot-starter-tomcat<br>引入了Spring Boot默认的HTTP引擎Tomcat。</p>
<p>5）spring-boot-starter-undertow<br>引入了Undertow HTTP引擎（用于替换Tomcat）。</p>
]]></content>
      
        <categories>
            
            <category> springBoot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springBoot </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[hadoop编译]]></title>
      <url>/2017/12/11/hadoop%E7%BC%96%E8%AF%91/</url>
      <content type="html"><![CDATA[<p>一、说明</p>
<p>官网下的Hadoop jar包是通用版，实际生产环境下有可能出现一些问题，因此我们需要重新编译hadoop的jar包，使其适应生产环境</p>
<p>二、安装JDK</p>
<p>　   JDK的安装百度一下有很多文章，我使用的是 jdk-7u71-linux-x64.tar.gz。在oracle的官网上也能够下载。jdk的安装在linux下就是一个加压缩的过程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> cd  /root</span><br><span class="line"></span><br><span class="line"> tar -zxvf jdk-7u71-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line"> 配置环境变量：vim /etc/profile</span><br><span class="line"></span><br><span class="line"> 输入命令进入编辑模式：i</span><br><span class="line"></span><br><span class="line">在文件最后添加：export JAVA_HOME=/root/jdk1.7.0_71</span><br><span class="line"></span><br><span class="line"> export PATH=.:PATH:JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line">保存退出（按下Esc，输入冒号，输入wq回车）</span><br><span class="line"></span><br><span class="line"> 使环境变量生效：source  /etc/profile</span><br><span class="line"></span><br><span class="line"> 检测安装是否成功：</span><br><span class="line"></span><br><span class="line"> java  -version</span><br><span class="line"></span><br><span class="line"> javac  -version</span><br></pre></td></tr></table></figure>
<p>三、安装maven</p>
<p>​    这个和安装jdk是一样的，安装成后同样需要配置环境变量　</p>
<p>链接:<a href="https://pan.baidu.com/s/1wjOj9qxGqoU_dUS2-hFFKg" target="_blank" rel="noopener">https://pan.baidu.com/s/1wjOj9qxGqoU_dUS2-hFFKg</a>  密码:0n6b</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export MAVEN_HOME=/usr/mvn/apache-maven-3.2.5</span><br><span class="line"></span><br><span class="line">export PATH=.:PATH:JAVA_HOME/bin:$MAVEN_HOME/bin</span><br></pre></td></tr></table></figure>
<p>​    同样，输入命令使配置文件生效　</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<p>​    检测是否安装成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn  -version</span><br></pre></td></tr></table></figure>
<p>​    能够看到关于maven的一些信息，包括所使用的jdk</p>
<p>四、安装protobuf　　</p>
<p>​    这一步比较关键，protobuf最好是提前下载然后上传上去。安装protobuf前，需要安装一些其他的东西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum  install  gcc    安装c++</span><br><span class="line"></span><br><span class="line">yum  install  gcc-c++          然后会两次提示输入 y（yes/no）</span><br><span class="line"></span><br><span class="line">yum install  make          可能会提示因为make已经是最新版本，而不会安装，这个无所谓，反正是最新版本，就不安装了</span><br></pre></td></tr></table></figure>
<p>  接下来便是安装protobuf，同样是一个解压缩的过程</p>
<p>链接:<a href="https://pan.baidu.com/s/12PT2s-cs-3rO2xevl9QiTA" target="_blank" rel="noopener">https://pan.baidu.com/s/12PT2s-cs-3rO2xevl9QiTA</a>  密码:po5j</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd  /root</span><br><span class="line"></span><br><span class="line">tar -zxvf protobuf-2.5.0.tar.gz</span><br></pre></td></tr></table></figure>
<p>​    然后进入到安装目录中，以此输入一下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd  /protobuf-2.5.0</span><br><span class="line"></span><br><span class="line"> ./ configure</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make  install</span><br></pre></td></tr></table></figure>
<p>   我在进行上面第二个命令，对configure进行预编译时报错，查看异常后，是c++没有安装成功，便再一次执行了：yum install  gcc-c++ 命令，OK<br>   make  命令执行的时间比较长，最后一个命令的执行安装，如果出现错误，重新来过即可</p>
<p>   测试   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc  --version</span><br></pre></td></tr></table></figure>
<p>五、安装CMake</p>
<p>　   CMake 需要2.6以上的版本，在安装的时候会提示输入 y/N，同时由于安装这个组件是需要联网的，故根据网速不同，安装的进度也不一样　</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum  install  cmake     </span><br><span class="line">yum  install  openssl-devel</span><br><span class="line">yum  install  ncurses-devel</span><br></pre></td></tr></table></figure>
<p>六、ant安装</p>
<p>链接:<a href="https://pan.baidu.com/s/1wulCv25ix1lWztjnG8SJtw" target="_blank" rel="noopener">https://pan.baidu.com/s/1wulCv25ix1lWztjnG8SJtw</a>  密码:fal7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf  apache-ant-1.9.4-bin.tar.gz</span><br></pre></td></tr></table></figure>
<p>​    配置环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ANT_HOME=/root/apache-ant-1.9.4</span><br><span class="line">export PATH=.:PATH:JAVA_HOME/bin:MAVEN_HOME/bin:ANT_HOME/bin</span><br></pre></td></tr></table></figure>
<p>​    生效以及测试　　</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br><span class="line">ant  -version</span><br></pre></td></tr></table></figure>
<p>七、编译hadoop</p>
<p>  1、解压hadoop源码包　　</p>
<p><a href="https://pan.baidu.com/s/1vR5ZPZ9xtmOnqbCqKOa8Sg" target="_blank" rel="noopener">Hadoop-2.7.4源码</a>        提取密码:971h</p>
<p> tar -zxvf hadoop-2.5.2-src.tar.gz</p>
<p>​    进入文件夹里面，里面有一个文件BUILDINT.txt，打开即可看见里面关于编译hadoop的一些环境要求　　</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /root/hadoop-2.5.2-src/</span><br><span class="line"></span><br><span class="line">cd hadoop-2.5.2-src</span><br></pre></td></tr></table></figure>
<p>​    2、编译hadoop<br>​       进入解压后的原文件中，即上面查看BUILDING.txt文件目录，然后输入一下命令即可　</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mvn package -Pdist,native -DskipTests -Dtar</span><br><span class="line"></span><br><span class="line">        或者是下面的命令　</span><br><span class="line"></span><br><span class="line">mvn  package -DeskipTests -Pdist,native</span><br></pre></td></tr></table></figure>
<p>​    3、等带编译结果</p>
<p>​    　　编译完成后会有提示，SUCCESS / FAILURE。如下</p>
<p>　　　 <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/image2.png" alt="image2"></p>
<p>　　　　如果编译失败，向上滚动，变能够查看什么地方出错了。</p>
<p>​    4、查看编译结果　</p>
<p>　　   同样在刚刚进行编译的那个目录下，有一个 hadoop-dist文件夹，进入里面的target文件夹，然后就可以看到编译成功64位的hadoop文件，解压后的在 hadoop-2.5.2 这个文件夹中，同时还生成了一个压缩包：hadoop-2.5.2-tar.gz 这个压缩包可以拷贝到别的机器上进行安装 </p>
<p> 5、几个编译好的Hadoop版本</p>
<p><a href="https://pan.baidu.com/s/1XMxSkBX-A8VtPdE4SmRZ9Q" target="_blank" rel="noopener">centos6.7</a>        密码:c83v</p>
<p><a href="https://pan.baidu.com/s/1TltMZDqqG306VeGKDauuZw" target="_blank" rel="noopener">windows</a>          密码:8fvc</p>
<p><a href="https://pan.baidu.com/s/1uRHVUq8RDY3XoELVoNjVSA" target="_blank" rel="noopener">Mac</a>                 密码:da6s</p>
]]></content>
      
        <categories>
            
            <category> 大数据 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> 集群搭建 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[IDEA快捷键]]></title>
      <url>/2017/11/25/IDEA%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
      <content type="html"><![CDATA[<h1 id="下面列出常用的一些快捷键以及改键位置："><a href="#下面列出常用的一些快捷键以及改键位置：" class="headerlink" title="下面列出常用的一些快捷键以及改键位置："></a>下面列出常用的一些快捷键以及改键位置：</h1><table>
<thead>
<tr>
<th>快捷键含义</th>
<th>Intellij Idea中设置位置</th>
<th>快捷键组合</th>
</tr>
</thead>
<tbody>
<tr>
<td>代码控制</td>
<td></td>
<td></td>
</tr>
<tr>
<td>自动完成</td>
<td>Main menu/Code/Completion/Basic</td>
<td>ctrl+Space</td>
</tr>
<tr>
<td>自动导入</td>
<td>Main menu/Code/Optimize imports</td>
<td>command+shift+o</td>
</tr>
<tr>
<td>格式化代码</td>
<td>Main menu/Code/Reformat code</td>
<td>command+shift+f</td>
</tr>
<tr>
<td>进入定义</td>
<td>Main menu/Navigate/Declaration</td>
<td>换成Mac版Eclipse之后，这个定义是Ctrl+鼠标左键，但这个不好用，会同时打开菜单,可以改成command+鼠标左键</td>
</tr>
<tr>
<td>重命名</td>
<td>Main menu/Refactor/Rename</td>
<td>fn+shift+F6</td>
</tr>
<tr>
<td>快速修复</td>
<td>Other/Show Intention Action</td>
<td>command+1</td>
</tr>
<tr>
<td>进入并查看光标所在的类或方法</td>
<td></td>
<td>fn+F3  或 ctrl+鼠标左键</td>
</tr>
<tr>
<td>删除当前行</td>
<td>Editor Actions/Delete Line</td>
<td>command+d</td>
</tr>
<tr>
<td>复制当前行</td>
<td>Editor Actions/Duplicate Lines</td>
<td>command+ctrl+方向键下</td>
</tr>
<tr>
<td>当前行向下移动</td>
<td>Main menu/Code/Move Line Down</td>
<td>c无预定义，设定为options+方向键下</td>
</tr>
<tr>
<td>当前行向上移动</td>
<td>Main menu/Code/Move Line Up</td>
<td>无预定义，设定为options+方向键上</td>
</tr>
<tr>
<td>注释当前行</td>
<td>Main menu/Code/Comment with Line Comment</td>
<td>command+/</td>
</tr>
<tr>
<td>运行</td>
<td>Main menu/Run/Run</td>
<td>command+shift+fn+F11</td>
</tr>
<tr>
<td>跳转到某行</td>
<td>Main menu/Navigate/Line</td>
<td>command+L</td>
</tr>
<tr>
<td>返回上一个浏览位置</td>
<td>Main menu/Navigate/Back</td>
<td>command+[</td>
</tr>
<tr>
<td>跳转下一个浏览位置</td>
<td>Main menu/Navigate/Forward</td>
<td>command+]</td>
</tr>
<tr>
<td>查看当前类结构</td>
<td>Main menu/Navigate/File Structure</td>
<td>command+o</td>
</tr>
<tr>
<td>查找</td>
<td></td>
<td></td>
</tr>
<tr>
<td>当前文件查找下一个</td>
<td>Main menu/Edit/Find/Find Word At Caret</td>
<td>无预定义，建议用command+k取代Find Word Next的默认值</td>
</tr>
<tr>
<td>当前文件查找上一个</td>
<td>Main menu/Edit/Find/Find Previous</td>
<td>command+shift+k</td>
</tr>
<tr>
<td>当前文件查找/替换</td>
<td>Main menu/Edit/Find/Replace</td>
<td>无预定义，设定为command+f</td>
</tr>
<tr>
<td>全局查找选中的文本（只是查找字符串）</td>
<td>Main menu/Edit/Find/Find in Path</td>
<td>ctrl+h</td>
</tr>
<tr>
<td>全局查找选中的文本（带完整包名）</td>
<td>Main menu/Edit/Find/Find Usages</td>
<td>command+shift+G</td>
</tr>
<tr>
<td>界面设置</td>
<td></td>
<td></td>
</tr>
<tr>
<td>光标跳转到当前行开始</td>
<td>Editor Actions/Move Cart To Line Start</td>
<td>Home（fn+方向左）</td>
</tr>
<tr>
<td>光标跳转到当前行末尾</td>
<td>Editor Actions/Move Cart To Line End</td>
<td>End（fn+方向右）</td>
</tr>
<tr>
<td>光标跳转到文件开始</td>
<td>Editor Actions/Move Cart To Text Start</td>
<td>command+Home</td>
</tr>
</tbody>
</table>
<p>对于Intellij Idea中的”自动导入”快捷键，其效果不像Eclipse中那么强大，只会清理掉无用的包引入语句，并不会将所需的包自动引入。这个问题可以间接用下面的方法来解决：<br>    1    不要写完一行然后批量引入，而在需要引入的地方使用”快速修复”来逐个引入；<br>    2    复制过来的代码，按照下面的方法设置一下，当粘贴时，Intellij Idea会自动引入正确的包：<br>Preferences——Editor——Auto Import，在右侧的界面中选中全部：</p>
<p>Eclipse中又一个很好用的功能，是查找光标所在的单词，在Intellij Idea中，对应的必须设置Find Word At Caret Next，而不要设置Find Word Next。<br>如果要向上查找当前单词，用Find Word Previous</p>
]]></content>
      
        <categories>
            
            <category> 快捷键 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 快捷键 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Linux集群资源监控]]></title>
      <url>/2017/11/11/Linux%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/</url>
      <content type="html"><![CDATA[<h1 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h1><ul>
<li>Ganglia 监控套件包括三个主要部分 gmond ，gmetad，和网页接口，通常被称为ganglia-web。<br>gmond 是一个守护进程，他运行在每一个需要监测的节点上，收集监测统计，发送和接受在同一个组播或单播通道上的统计信息。</li>
<li>gmetad 也是一个守护进程，他定期检查gmonds ，从那里拉取数据，并将他们的指标存储在RRD存储引擎中。它可以查询多个集群并聚合指标。RRD也被用于生成用户界面的web前端。</li>
<li>ganglia-web 顾名思义，他应该安装在有gmetad运行的机器上，以便读取RRD文件。</li>
</ul>
<p>​    一般来说一个集群的每台机器上都需要安装gmond，只要负责展示web界面的机器安装了gmetad即可。</p>
<h1 id="二-ganglia规划"><a href="#二-ganglia规划" class="headerlink" title="二.ganglia规划"></a>二.ganglia规划</h1><p>​    <strong>主机名</strong>             ip               <strong>规划</strong>                         安装</p>
<p>   hadoop1      10.2.6.250        服务端   ganglia-gmond、ganglia-gmetad、ganglia-web</p>
<p>   hadoop2     10.2.6.246        客户端            ganglia-gmond</p>
<p>   hadoop3     10.2.6.248        客户端            ganglia-gmond</p>
<p>   hadoop4   10.2.6.249        客户端            ganglia-gmond</p>
<p>安装前确保iptables关闭.</p>
<h1 id="三-安装前的准备工作"><a href="#三-安装前的准备工作" class="headerlink" title="三.安装前的准备工作"></a>三.安装前的准备工作</h1><h2 id="3-1加载yum源，在每一台机器上面执行下面两个命令"><a href="#3-1加载yum源，在每一台机器上面执行下面两个命令" class="headerlink" title="3.1加载yum源，在每一台机器上面执行下面两个命令"></a>3.1加载yum源，在每一台机器上面执行下面两个命令</h2><p>rpm -Uvh <a href="http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm" target="_blank" rel="noopener">http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</a></p>
<p>yum  -y  install  httpd-devel  automake  autoconf  libtool  ncurses-devel  libxslt  groff  pcre-devel  pkgconfig</p>
<h2 id="四-主节点服务安装配置"><a href="#四-主节点服务安装配置" class="headerlink" title="四.主节点服务安装配置"></a>四.主节点服务安装配置</h2><h2 id="4-1主节点的服务安装（hadoop1上面的安装配置）安装ganglia-gmetad-和ganglia-web"><a href="#4-1主节点的服务安装（hadoop1上面的安装配置）安装ganglia-gmetad-和ganglia-web" class="headerlink" title="4.1主节点的服务安装（hadoop1上面的安装配置）安装ganglia-gmetad 和ganglia-web"></a>4.1主节点的服务安装（hadoop1上面的安装配置）安装ganglia-gmetad 和ganglia-web</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum search ganglia     ------------------查看ganglia在epel的安装包,复制进行安装 </span><br><span class="line">如果没有安装包，需要下载EPEL</span><br><span class="line">yum  install epel-release  //扩展包更新包  </span><br><span class="line">yum  update //更新yum源  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum -y install ganglia-web.x86_64 ganglia-gmond.x86_64  </span><br><span class="line">yum -y install ganglia-gmetad.x86_64 ----------------------(如果上一步执行了这步不用执行,web包会自动下载该依赖)  </span><br><span class="line">rpm -qa |grep ganglia          --------------------查看安装情况  </span><br><span class="line">rpm -ql ganglia-gmetad.x86_64       ------------- 复制上面命令执行结果的安装名,可查看安装路径</span><br></pre></td></tr></table></figure>
<h3 id="4-1-1配置gmetad"><a href="#4-1-1配置gmetad" class="headerlink" title="4.1.1配置gmetad"></a>4.1.1配置gmetad</h3><p>Shell<strong>代码</strong>   </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ganglia/gmetad.conf  </span><br><span class="line"></span><br><span class="line">data_source "my cluster" 10.2.6.250:8649  ---- Hadoop为cluster名称,后面是需要监控的主机名</span><br></pre></td></tr></table></figure>
<h3 id="4-1-2修改apache设置"><a href="#4-1-2修改apache设置" class="headerlink" title="4.1.2修改apache设置"></a>4.1.2修改apache设置</h3><p>Shell<strong>代码</strong>   </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> vi /etc/httpd/conf.d/ganglia.conf  </span><br><span class="line"></span><br><span class="line">文件内容Deny from all 为 allow from all </span><br><span class="line"></span><br><span class="line">修改后配置如下</span><br><span class="line"></span><br><span class="line">&lt;Location /ganglia&gt;</span><br><span class="line"></span><br><span class="line">    Order deny,allow</span><br><span class="line"></span><br><span class="line">    Allow from all</span><br><span class="line"></span><br><span class="line">    Allow from 127.0.0.1</span><br><span class="line"></span><br><span class="line">    Allow from ::1</span><br><span class="line"></span><br><span class="line">    # Allow from .example.com</span><br><span class="line"></span><br><span class="line">  &lt;/Location&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4-1-3设置启动"><a href="#4-1-3设置启动" class="headerlink" title="4.1.3设置启动"></a>4.1.3设置启动</h3><p>Shell<strong>代码</strong>   </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add gmetad  </span><br><span class="line"></span><br><span class="line"> chkconfig --add gmond  </span><br><span class="line"></span><br><span class="line"> chkconfig --add httpd</span><br></pre></td></tr></table></figure>
<h3 id="4-1-4打开端口-关闭防火墙"><a href="#4-1-4打开端口-关闭防火墙" class="headerlink" title="4.1.4打开端口/关闭防火墙"></a>4.1.4打开端口/关闭防火墙</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/iptables stop -------------------关闭防火墙,用于测试时,线上最好用打开端口方式</span><br></pre></td></tr></table></figure>
<h3 id="4-1-5关闭SELinux"><a href="#4-1-5关闭SELinux" class="headerlink" title="4.1.5关闭SELinux"></a>4.1.5关闭SELinux</h3><p>1 永久方法 – 需要重启服务器</p>
<p>修改/etc/selinux/config文件中设置SELINUX=disabled ，然后重启服务器。</p>
<p>2 临时方法 – 设置系统参数</p>
<p>使用命令setenforce 0</p>
<p>附：</p>
<p>setenforce 1 设置SELinux 成为enforcing模式</p>
<p>setenforce 0 设置SELinux 成为permissive模式</p>
<h1 id="五-监控节点的安装（每个监控节点，hadoop2，hadoop3，hadoop4都要安装）"><a href="#五-监控节点的安装（每个监控节点，hadoop2，hadoop3，hadoop4都要安装）" class="headerlink" title="五.监控节点的安装（每个监控节点，hadoop2，hadoop3，hadoop4都要安装）"></a>五.监控节点的安装（每个监控节点，hadoop2，hadoop3，hadoop4都要安装）</h1><h2 id="5-1安装ganglia-gmond"><a href="#5-1安装ganglia-gmond" class="headerlink" title="5.1安装ganglia-gmond"></a>5.1安装ganglia-gmond</h2><p>Shell<strong>代码</strong>   </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum search ganglia  </span><br><span class="line"></span><br><span class="line">yum install ganglia-gmond.x86_64</span><br></pre></td></tr></table></figure>
<h2 id="5-2配置gmond"><a href="#5-2配置gmond" class="headerlink" title="5.2配置gmond"></a>5.2配置gmond</h2><p>Shell<strong>代码</strong>   </p>
<p>vi /etc/ganglia/gmond.conf  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cluster &#123;</span><br><span class="line"></span><br><span class="line">  name = "my cluster"    ------ cluster名称,是你在gmetad.conf里配置的data_source名称 </span><br><span class="line"></span><br><span class="line">  owner = "root"</span><br><span class="line"></span><br><span class="line">  latlong = "unspecified"</span><br><span class="line"></span><br><span class="line">  url = "unspecified"</span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">udp_send_channel &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta"> #</span> mcast_join = 239.2.11.71  ----- 组播  </span><br><span class="line"></span><br><span class="line">  host=10.2.6.250    -------------- 单播 gmeta主机的ip/主机名或者主机ip地址  </span><br><span class="line"></span><br><span class="line">  port = 8649</span><br><span class="line"></span><br><span class="line">ttl = 1</span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">udp_recv_channel &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span>mcast_join = 239.2.11.71  </span><br><span class="line"></span><br><span class="line">  port = 8649</span><br><span class="line"></span><br><span class="line">  bind = 10.2.6.246</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-3配置启动"><a href="#5-3配置启动" class="headerlink" title="5.3配置启动"></a>5.3配置启动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig  --add  gmond</span><br><span class="line"></span><br><span class="line">chkconfig  --list  gmond</span><br></pre></td></tr></table></figure>
<p>此时，如果正确安装，会出现gmond           0:off   1:off   2:off   3:off   4:off   5:off   6:off</p>
<h2 id="5-4配置hosts"><a href="#5-4配置hosts" class="headerlink" title="5.4配置hosts"></a>5.4配置hosts</h2><p> vi /etc/hosts</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">10.2.6.250 hadoop1</span><br><span class="line"></span><br><span class="line">10.2.6.246 hadoop2</span><br><span class="line"></span><br><span class="line">10.2.6.248 hadoop3</span><br><span class="line"></span><br><span class="line">10.2.6.249 hadoop4</span><br></pre></td></tr></table></figure>
<p><strong>全部安装完毕后</strong></p>
<p>在主机上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">service gmetad start</span><br><span class="line"></span><br><span class="line">service gmond start</span><br><span class="line"></span><br><span class="line">service httpd start</span><br><span class="line"></span><br><span class="line">service gmetad status    -------------------验证是否启动成功</span><br><span class="line"></span><br><span class="line">service gmond status   -------------------验证是否启动成功</span><br></pre></td></tr></table></figure>
<p>在监控节点上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service gmond start  </span><br><span class="line"></span><br><span class="line">service gmond status   -------------------验证是否启动成功</span><br></pre></td></tr></table></figure>
<p>访问<a href="http://10.2.6.250/ganglia" target="_blank" rel="noopener">http://10.2.6.250/ganglia</a></p>
<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><p>Forbidden错误时,因为对apache有一个设置</p>
<p>修改 /etc/httpd/conf.d/ganglia.conf文件内容Deny from all 为 allow from all</p>
<p>There was an error collecting ganglia data (127.0.0.1:8652):fsockopen error: Permission denied </p>
<p>解决方法</p>
<p>1 永久方法 – 需要重启服务器</p>
<p>修改/etc/selinux/config文件中设置SELINUX=disabled ，然后重启服务器。</p>
<p>2 临时方法 – 设置系统参数</p>
<p>使用命令setenforce 0</p>
<p>附：</p>
<p>setenforce 1 设置SELinux 成为enforcing模式</p>
<p>setenforce 0 设置SELinux 成为permissive模式</p>
<p><strong>There was an error collecting ganglia data (127.0.0.1:8652):fsockopen error: Connection refused **</strong>解决办法**</p>
<p>卸载yum remove ganglia-web ganglia-gmetad</p>
<p>重新安装yum install ganglia-web    —– ganglia-web本身有引用gmetad</p>
<p>重启即可</p>
<p><a href="http://redhatdebian.blog.51cto.com/1197273/828992" target="_blank" rel="noopener">http://redhatdebian.blog.51cto.com/1197273/828992</a></p>
]]></content>
      
        <categories>
            
            <category> 大数据 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 集群 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Redis使用]]></title>
      <url>/2017/11/05/Redis%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<h1 id="1、Redis五种数据类型"><a href="#1、Redis五种数据类型" class="headerlink" title="1、Redis五种数据类型"></a>1、Redis五种数据类型</h1><pre><code>1、字符串（String）
2、哈希（hash）
3、字符串列表（list）
4、字符串集合（set）
5、有序字符串集合（sorted set）
</code></pre><h1 id="2、字符串类型"><a href="#2、字符串类型" class="headerlink" title="2、字符串类型"></a>2、字符串类型</h1><h2 id="2-1、赋值"><a href="#2-1、赋值" class="headerlink" title="2.1、赋值"></a>2.1、赋值</h2><p>set key value：设定key持有指定的字符串value，如果该key存在则进行覆盖操作。总是返回”OK”<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/set%20key%20value.png" alt="set key value"></p>
<h2 id="2-2、取值"><a href="#2-2、取值" class="headerlink" title="2.2、取值"></a>2.2、取值</h2><p>get key：获取key的value。如果与该key关联的value不是String类型，redis将返回错误信息，因为get命令只能用于获取String value；如果该key不存在，返回(nil)。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/get%20key.png" alt="get key"><br>getset key value：先获取该key的值，然后在设置该key的值。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/getset%20key%20value.png" alt="getset key value"></p>
<h2 id="2-3、删除"><a href="#2-3、删除" class="headerlink" title="2.3、删除"></a>2.3、删除</h2><p>del key ：删除指定key<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/del%20key.png" alt="del key"></p>
<h2 id="2-4、数值增减"><a href="#2-4、数值增减" class="headerlink" title="2.4、数值增减"></a>2.4、数值增减</h2><p>incr key：将指定的key的value原子性的递增1.如果该key不存在，其初始值为0，在incr之后其值为1。如果value的值不能转成整型，如hello，该操作将执行失败并返回相应的错误信息。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/incr%20key.png" alt="incr key"><br>decr key：将指定的key的value原子性的递减1.如果该key不存在，其初始值为0，在incr之后其值为-1。如果value的值不能转成整型，如hello，该操作将执行失败并返回相应的错误信息。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/decr%20key.png" alt="decr key"></p>
<h2 id="2-5、扩展命令"><a href="#2-5、扩展命令" class="headerlink" title="2.5、扩展命令"></a>2.5、扩展命令</h2><p>incrby key increment：将指定的key的value原子性增加increment，如果该key不存在，器初始值为0，在incrby之后，该值为increment。如果该值不能转成整型，如hello则失败并返回错误信息<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/incrby%20key%20increment.png" alt="incrby key increment"><br>decrby key decrement：将指定的key的value原子性减少decrement，如果该key不存在，器初始值为0，在decrby之后，该值为decrement。如果该值不能转成整型，如hello则失败并返回错误信息<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/decrby%20key%20decrement.png" alt="decrby key decrement"><br>append key value：拼凑字符串。如果该key存在，则在原有的value后追加该值；如果该key不存在，则重新创建一个key/value<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/append%20key%20value.png" alt="append key value"></p>
<h1 id="3、hash数据类型"><a href="#3、hash数据类型" class="headerlink" title="3、hash数据类型"></a>3、hash数据类型</h1><h2 id="3-1、概述"><a href="#3-1、概述" class="headerlink" title="3.1、概述"></a>3.1、概述</h2><p>   Redis中的Hash类型可以看成具有String Key和String Value的map容器。所以该类型非常适合于存储值对象的信息。如Username、Password和Age等。如果Hash中包含很少的字段，那么该类型的数据也将仅占用很少的磁盘空间。每一个Hash可以存储4294967295个键值对。</p>
<h2 id="3-2、存值"><a href="#3-2、存值" class="headerlink" title="3.2、存值"></a>3.2、存值</h2><p>hset key field value<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hset%20key%20field%20value.png" alt="hset key field value"><br>hmset key field value field value<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hmset%20key%20field%20value%20field%20value.png" alt="hmset key field value field value"></p>
<h2 id="3-3、取值"><a href="#3-3、取值" class="headerlink" title="3.3、取值"></a>3.3、取值</h2><p>hget key field：返回指定的key中的field的值<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hget%20key%20field.png" alt="hget key field"><br>hmget key fileds：获取key中的多个filed的值<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hmget%20key%20fileds.png" alt="hmget key fileds"><br>hgetall key：获取key中的所有filed-vaule<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hgetall%20key.png" alt="hgetall key"></p>
<h2 id="3-4、删除"><a href="#3-4、删除" class="headerlink" title="3.4、删除"></a>3.4、删除</h2><p>hdel key field [field … ] ：可以删除一个或多个字段，返回值是被删除的字段个数<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hdel%20key%20field%20%5Bfield%20%E2%80%A6%20%5D1.png" alt="hdel key field [field … ]1"><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hdel%20key%20field%20%5Bfield%20%E2%80%A6%20%5D2.png" alt="hdel key field [field … ]2"><br>del key ：删除整个内容<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/del%20key%20.png" alt="del key"></p>
<h2 id="3-5、增加数字"><a href="#3-5、增加数字" class="headerlink" title="3.5、增加数字"></a>3.5、增加数字</h2><p>hincrby key field value：为某个key的某个属性增加值<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hincrby%20key%20field%20value.png" alt="hincrby key field value"></p>
<h2 id="3-6、自学命令"><a href="#3-6、自学命令" class="headerlink" title="3.6、自学命令"></a>3.6、自学命令</h2><p>hexists key field：判断指定的key中的filed是否存在<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hexists%20key%20field.png" alt="hexists key field"><br>hlen key：获取key所包含的field的数量<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hlen%20key.png" alt="hlen key"><br>hkeys key ：获得所有的key<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hkeys%20key.png" alt="hkeys key"><br>hvals key：获得所有的value<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/hvals%20key.png" alt="hvals key"></p>
<h1 id="4、list类型"><a href="#4、list类型" class="headerlink" title="4、list类型"></a>4、list类型</h1><h2 id="4-1、概述"><a href="#4-1、概述" class="headerlink" title="4.1、概述"></a>4.1、概述</h2><p>在Redis中，List类型是按照插入顺序排序的字符串链表。和数据结构中的普通链表一样，我们可以在其头部(left)和尾部(right)添加新的元素。在插入时，如果该键并不存在，Redis将为该键创建一个新的链表。与此相反，如果链表中所有的元素均被移除，那么该键也将会被从数据库中删除。List中可以包含的最大元素数量是4294967295。<br>    从元素插入和删除的效率视角来看，如果我们是在链表的两头插入或删除元素，这将会是非常高效的操作，即使链表中已经存储了百万条记录，该操作也可以在常量时间内完成。然而需要说明的是，如果元素插入或删除操作是作用于链表中间，那将会是非常低效的。相信对于有良好数据结构基础的开发者而言，这一点并不难理解。<br>  1、ArrayList使用数组方式存储数据，所以根据索引查询数据速度快，而新增或者删除元素时需要设计到位移操作，所以比较慢。<br>  2、LinkedList使用双向链接方式存储数据，每个元素都记录前后元素的指针，所以插入、删除数据时只是更改前后元素的指针指向即可，速度非常快，然后通过下标查询元素时需要从头开始索引，所以比较慢。<br>  3、双向链表中添加数据<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image39.png" alt="image39"><br>  4、双向链表中删除数据<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image40.png" alt="image40"></p>
<h2 id="4-2、常用命令"><a href="#4-2、常用命令" class="headerlink" title="4.2、常用命令"></a>4.2、常用命令</h2><h3 id="4-2-1、两端添加"><a href="#4-2-1、两端添加" class="headerlink" title="4.2.1、两端添加"></a>4.2.1、两端添加</h3><p>lpush key values[value1 value2…]：在指定的key所关联的list的头部插入所有的values，如果该key不存在，该命令在插入的之前创建一个与该key关联的空链表，之后再向该链表的头部插入数据。插入成功，返回元素的个数。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lpush%20key%20values%5Bvalue1%20value2%E2%80%A6%5D.png" alt="lpush key values"><br>rpush key values[value1、value2…]：在该list的尾部添加元素。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/rpush%20key%20values%5Bvalue1%E3%80%81value2%E2%80%A6%5D.png" alt="rpush key values"></p>
<h3 id="4-2-2、查看列表"><a href="#4-2-2、查看列表" class="headerlink" title="4.2.2、查看列表"></a>4.2.2、查看列表</h3><p>lrange key start end：获取链表中从start到end的元素的值，start、end从0开始计数；也可为负数，若为-1则表示链表尾部的元素，-2则表示倒数第二个，依次类推…<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lrange%20key%20start%20end1.png" alt="lrange key start end1"><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lrange%20key%20start%20end2.png" alt="lrange key start end2"></p>
<h3 id="4-2-3、两端弹出"><a href="#4-2-3、两端弹出" class="headerlink" title="4.2.3、两端弹出"></a>4.2.3、两端弹出</h3><p>lpop key：返回并弹出指定的key关联的链表中的第一个元素，即头部元素。如果该key不存在，返回nil；若key存在，则返回链表的头部元素。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lpop%20key.png" alt="lpop key"><br>rpop key：从尾部弹出元素。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/rpop%20key.png" alt="rpop key"></p>
<h3 id="4-2-4、获取列表中元素的个数"><a href="#4-2-4、获取列表中元素的个数" class="headerlink" title="4.2.4、获取列表中元素的个数"></a>4.2.4、获取列表中元素的个数</h3><p>llen key：返回指定的key关联的链表中的元素的数量。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/llen%20key.png" alt="llen key"></p>
<h3 id="4-2-5、扩展命令"><a href="#4-2-5、扩展命令" class="headerlink" title="4.2.5、扩展命令"></a>4.2.5、扩展命令</h3><p>lpushx key value：仅当参数中指定的key存在时，向关联的list的头部插入value。如果不存在，将不进行插入<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lpushx%20key%20value.png" alt="lpushx key value"><br>rpushx key value：在该list的尾部添加元素<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/rpushx%20key%20value.png" alt="rpushx key value"><br>lrem key count value：删除count个值为value的元素，如果count大于0，从头向尾遍历并删除count个值为value的元素，如果count小于0，则从尾向头遍历并删除。如果count等于0，则删除链表中所有等于value的元素。<br>0)初始化数据<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lrem%20key%20count%20value.png" alt="lrem key count value"><br> 1) 从头删除，2个数字“3”<br>lrem mylist3 2 3<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lrem%20mylist3%202%203.png" alt="lrem mylist3 2 3"><br>2) 从尾删除，2个数字“1”<br>lrem mylist3 -2 1<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lrem%20mylist3%20-2%201.png" alt="lrem mylist3 -2 1"><br>3) 删除所有数字“2”<br>lrem mylist3 0 2<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lrem%20mylist3%200%202.png" alt="lrem mylist3 0 2"><br>lset key index value：设置链表中的index的脚标的元素值，0代表链表的头元素，-1代表链表的尾元素。操作链表的脚标不存在则抛异常。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/lset%20key%20index%20value.png" alt="lset key index value"><br>linsert key before|after pivot value：在pivot元素前或者后插入value这个元素。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/linsert%20key%20before%7Cafter%20pivot%20value.png" alt="linsert key before|after pivot value"><br>rpoplpush resource destination：将链表中的尾部元素弹出并添加到头部。[循环操作]<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/rpoplpush%20resource%20destination.png" alt="rpoplpush resource destination"><br>1) 将mylist5右端弹出，压入到mylist6左边。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/mylist5.png" alt="mylist5"><br>2) 将mylist6右端数据弹出，压入到左端<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/mylist6.png" alt="mylist6"></p>
<h2 id="4-3、使用场景"><a href="#4-3、使用场景" class="headerlink" title="4.3、使用场景"></a>4.3、使用场景</h2><p>rpoplpush的使用场景：<br>Redis链表经常会被用于消息队列的服务，以完成多程序之间的消息交换。假设一个应用程序正在执行LPUSH操作向链表中添加新的元素，我们通常将这样的程序称之为”生产者(Producer)”，而另外一个应用程序正在执行RPOP操作从链表中取出元素，我们称这样的程序为”消费者(Consumer)”。如果此时，消费者程序在取出消息元素后立刻崩溃，由于该消息已经被取出且没有被正常处理，那么我们就可以认为该消息已经丢失，由此可能会导致业务数据丢失，或业务状态的不一致等现象的发生。然而通过使用RPOPLPUSH命令，消费者程序在从主消息队列中取出消息之后再将其插入到备份队列中，直到消费者程序完成正常的处理逻辑后再将该消息从备份队列中删除。同时我们还可以提供一个守护进程，当发现备份队列中的消息过期时，可以重新将其再放回到主消息队列中，以便其它的消费者程序继续处理。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/rpoplpush%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF.png" alt="rpoplpush的使用场景"></p>
<h1 id="5、存储set"><a href="#5、存储set" class="headerlink" title="5、存储set"></a>5、存储set</h1><h2 id="5-1、概述"><a href="#5-1、概述" class="headerlink" title="5.1、概述"></a>5.1、概述</h2><pre><code>在Redis中，我们可以将Set类型看作为没有排序的字符集合，和List类型一样，我们也可以在该类型的数据值上执行添加、删除或判断某一元素是否存在等操作。需要说明的是，这些操作的时间复杂度为O(1)，即常量时间内完成次操作。Set可包含的最大元素数量是4294967295。
和List类型不同的是，Set集合中不允许出现重复的元素，这一点和C++标准库中的set容器是完全相同的。换句话说，如果多次添加相同元素，Set中将仅保留该元素的一份拷贝。和List类型相比，Set类型在功能上还存在着一个非常重要的特性，即在服务器端完成多个Sets之间的聚合计算操作，如unions、intersections和differences。由于这些操作均在服务端完成，因此效率极高，而且也节省了大量的网络IO开销。
</code></pre><h2 id="5-2、常用命令"><a href="#5-2、常用命令" class="headerlink" title="5.2、常用命令"></a>5.2、常用命令</h2><h3 id="5-2-1、添加-删除元素"><a href="#5-2-1、添加-删除元素" class="headerlink" title="5.2.1、添加/删除元素"></a>5.2.1、添加/删除元素</h3><p>sadd key values[value1、value2…]：向set中添加数据，如果该key的值已有则不会重复添加<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sadd%20key%20values.png" alt="sadd key values"><br>srem key members[member1、member2…]：删除set中指定的成员<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/srem%20key%20members.png" alt="srem key members"></p>
<h3 id="5-2-2、获得集合中的元素"><a href="#5-2-2、获得集合中的元素" class="headerlink" title="5.2.2、获得集合中的元素"></a>5.2.2、获得集合中的元素</h3><p>smembers key：获取set中所有的成员<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/smembers%20key.png" alt="smembers key"><br>sismember key member：判断参数中指定的成员是否在该set中，1表示存在，0表示不存在或者该key本身就不存在。（无论集合中有多少元素都可以极速的返回结果）<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sismember%20key%20member.png" alt="sismember key member"></p>
<h3 id="5-2-3、集合的差集运算-A-B"><a href="#5-2-3、集合的差集运算-A-B" class="headerlink" title="5.2.3、集合的差集运算 A-B"></a>5.2.3、集合的差集运算 A-B</h3><p>sdiff key1 key2…：返回key1与key2中相差的成员，而且与key的顺序有关。即返回差集。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sdiff%20key1%20key2_1.png" alt="sdiff key1 key2_1">（属于A并且不属于B的元素构成的集合）<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sdiff%20key1%20key2_2.png" alt="sdiff key1 key2_2"></p>
<h3 id="5-2-4、集合的交集运算-A-∩-B"><a href="#5-2-4、集合的交集运算-A-∩-B" class="headerlink" title="5.2.4、集合的交集运算 A ∩ B"></a>5.2.4、集合的交集运算 A ∩ B</h3><p>sinter key1 key2 key3…：返回交集。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sinter%20key1%20key2%20key3.png" alt="sinter key1 key2 key3">（属于A且属于B的元素构成的集合）<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image67.png" alt="image67"></p>
<h3 id="5-2-5、集合的并集运算-A-∪-B"><a href="#5-2-5、集合的并集运算-A-∪-B" class="headerlink" title="5.2.5、集合的并集运算 A ∪ B"></a>5.2.5、集合的并集运算 A ∪ B</h3><p>sunion key1 key2 key3…：返回并集<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sunion%20key1%20key2%20key3_1.png" alt="sunion key1 key2 key3_1">（属于A或者属于B的元素构成的集合）<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sunion%20key1%20key2%20key3_2.png" alt="sunion key1 key2 key3_2"></p>
<h3 id="5-2-6、扩展命令"><a href="#5-2-6、扩展命令" class="headerlink" title="5.2.6、扩展命令"></a>5.2.6、扩展命令</h3><p>scard key：获取set中成员的数量<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/scard%20key.png" alt="scard key"><br>srandmember key：随机返回set中的一个成员<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/srandmember%20key.png" alt="srandmember key"><br>sdiffstore destination key1 key2…：将key1、key2相差的成员存储在destination上<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sdiffstore%20destination%20key1%20key2.png" alt="sdiffstore destination key1 key2"><br>sinterstore destination key[key…]：将返回的交集存储在destination上<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sinterstore%20destination%20key.png" alt="sinterstore destination key"><br>sunionstore destination key[key…]：将返回的并集存储在destination上<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/sunionstore%20destination%20key.png" alt="sunionstore destination key"></p>
<h2 id="5-3、使用场景"><a href="#5-3、使用场景" class="headerlink" title="5.3、使用场景"></a>5.3、使用场景</h2><p>  1、可以使用Redis的Set数据类型跟踪一些唯一性数据，比如访问某一博客的唯一IP地址信息。对于此场景，我们仅需在每次访问该博客时将访问者的IP存入Redis中，Set数据类型会自动保证IP地址的唯一性。<br>  2、充分利用Set类型的服务端聚合操作方便、高效的特性，可以用于维护数据对象之间的关联关系。比如所有购买某一电子设备的客户ID被存储在一个指定的Set中，而购买另外一种电子产品的客户ID被存储在另外一个Set中，如果此时我们想获取有哪些客户同时购买了这两种商品时，Set的intersections命令就可以充分发挥它的方便和效率的优势了。</p>
<h1 id="6、存储sortedset"><a href="#6、存储sortedset" class="headerlink" title="6、存储sortedset"></a>6、存储sortedset</h1><h2 id="6-1、概述"><a href="#6-1、概述" class="headerlink" title="6.1、概述"></a>6.1、概述</h2><p>  Sorted-Set和Set类型极为相似，它们都是字符串的集合，都不允许重复的成员出现在一个Set中。它们之间的主要差别是Sorted-Set中的每一个成员都会有一个分数(score)与之关联，Redis正是通过分数来为集合中的成员进行从小到大的排序。然而需要额外指出的是，尽管Sorted-Set中的成员必须是唯一的，但是分数(score)却是可以重复的。<br>  在Sorted-Set中添加、删除或更新一个成员都是非常快速的操作，其时间复杂度为集合中成员数量的对数。由于Sorted-Set中的成员在集合中的位置是有序的，因此，即便是访问位于集合中部的成员也仍然是非常高效的。事实上，Redis所具有的这一特征在很多其它类型的数据库中是很难实现的，换句话说，在该点上要想达到和Redis同样的高效，在其它数据库中进行建模是非常困难的。<br>    例如：游戏排名、微博热点话题等使用场景。</p>
<h2 id="6-2、常用命令"><a href="#6-2、常用命令" class="headerlink" title="6.2、常用命令"></a>6.2、常用命令</h2><h3 id="6-2-1、添加元素"><a href="#6-2-1、添加元素" class="headerlink" title="6.2.1、添加元素"></a>6.2.1、添加元素</h3><p>zadd key score member score2 member2 … ：将所有成员以及该成员的分数存放到sorted-set中。如果该元素已经存在则会用新的分数替换原有的分数。返回值是新加入到集合中的元素个数，不包含之前已经存在的元素<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image75.png" alt="image75"><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image76.png" alt="image76"></p>
<h3 id="6-2-2、获得元素"><a href="#6-2-2、获得元素" class="headerlink" title="6.2.2、获得元素"></a>6.2.2、获得元素</h3><p>zscore key member：返回指定成员的分数<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image77.png" alt="image77"><br>zcard key：获取集合中的成员数量<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image78.png" alt="image78"></p>
<h3 id="6-2-3、删除元素"><a href="#6-2-3、删除元素" class="headerlink" title="6.2.3、删除元素"></a>6.2.3、删除元素</h3><p>zrem key member[member…]：移除集合中指定的成员，可以指定多个成员。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image79.png" alt="image79"></p>
<h3 id="6-2-4、范围查询"><a href="#6-2-4、范围查询" class="headerlink" title="6.2.4、范围查询"></a>6.2.4、范围查询</h3><p>zrange key start end [withscores]：获取集合中脚标为start-end的成员，[withscores]参数表明返回的成员包含其分数<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image80.png" alt="image80"><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image81.png" alt="image81"><br>zrevrange key start stop [withscores]：照元素分数从大到小的顺序返回索引从start到stop之间的所有元素（包含两端的元素）<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image82.png" alt="image82"><br>zremrangebyrank key start stop: 按照排名范围删除元素<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image83.png" alt="image83"><br>zremrangebyscore key min max：按照分数范围删除元素<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image84.png" alt="image84"></p>
<h3 id="6-2-5、扩展命令"><a href="#6-2-5、扩展命令" class="headerlink" title="6.2.5、扩展命令"></a>6.2.5、扩展命令</h3><p>zrangebyscore key min max [withscores] [limit offset count]：返回分数在[min,max]的成员并按照分数从低到高排序。[withscores]：显示分数；[limit offset count]：offset，表明从脚标为offset的元素开始并返回count个成员。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image85.png" alt="image85"><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image86.png" alt="image86"><br>zincrby key increment member：设置指定成员的增加的分数。返回值是更改后的分数。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image87.png" alt="image87"><br>zcount key min max：获取分数在[min,max]之间的成员<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image88.png" alt="image88"><br>zrank key member：返回成员在集合中的排名。（从小到大）<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image89.png" alt="image89"><br>zrevrank key member：返回成员在集合中的排名。（从大到小）<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image90.png" alt="image90"></p>
<h2 id="6-3、使用场景"><a href="#6-3、使用场景" class="headerlink" title="6.3、使用场景"></a>6.3、使用场景</h2><p>  1、可以用于一个大型在线游戏的积分排行榜。每当玩家的分数发生变化时，可以执行ZADD命令更新玩家的分数，此后再通过ZRANGE命令获取积分TOPTEN的用户信息。当然我们也可以利用ZRANK命令通过username来获取玩家的排行信息。最后我们将组合使用ZRANGE和ZRANK命令快速的获取和某个玩家积分相近的其他用户的信息。<br>  2、Sorted-Set类型还可用于构建索引数据。</p>
<h1 id="7、keys的通用操作"><a href="#7、keys的通用操作" class="headerlink" title="7、keys的通用操作"></a>7、keys的通用操作</h1><p>keys pattern：获取所有与pattern匹配的key，返回所有与该key匹配的keys。*表示任意一个或多个字符，?表示任意一个字符<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image91.png" alt="image91"><br>del key1 key2…：删除指定的key<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image92.png" alt="image92"><br>exists key：判断该key是否存在，1代表存在，0代表不存在<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image93.png" alt="image93"><br>rename key newkey：为当前的key重命名<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image94.png" alt="image94"><br>expire key ：设置过期时间，单位：秒<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image95.png" alt="image95"><br>ttl key：获取该key所剩的超时时间，如果没有设置超时，返回-1。如果返回-2表示超时不存在。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image96.png" alt="image96"><br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image97.png" alt="image97"><br>type key：获取指定key的类型。该命令将以字符串的格式返回。    返回的字符串为string、list、set、hash和zset，如果key不存在返回none。<br><img src="http://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/no-sql/redis%E4%BD%BF%E7%94%A8/image98.png" alt="image98"></p>
]]></content>
      
        <categories>
            
            <category> redis </category>
            
        </categories>
        
        
        <tags>
            
            <tag> redis </tag>
            
            <tag> 命令 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[安装 Ruby, Rails 运行环境]]></title>
      <url>/2017/04/12/%E5%AE%89%E8%A3%85%20Ruby,%20Rails%20%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/</url>
      <content type="html"><![CDATA[<h2 id="步骤1-－-安装-RVM"><a href="#步骤1-－-安装-RVM" class="headerlink" title="步骤1 － 安装 RVM"></a>步骤1 － 安装 RVM</h2><p>直接以如下命令行安装可能会不成功，因为rvm.io站点有时会被墙：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.rvm.io | bash -s stable</span><br><span class="line">#或者</span><br><span class="line">curl -L https://rvm.io | bash -s stable</span><br></pre></td></tr></table></figure>
<p>没关系，我们可以直接从git仓库里下载并安装RVM，首先本地新建文件夹rvm:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir rvm</span><br><span class="line">cd rvm</span><br></pre></td></tr></table></figure>
<p>然后依次执行如下命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Install mpapis public key (might need `gpg2` and or `sudo`)</span><br><span class="line">gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3</span><br><span class="line"></span><br><span class="line"># Download the installer</span><br><span class="line">curl -O https://raw.githubusercontent.com/rvm/rvm/master/binscripts/rvm-installer</span><br><span class="line">curl -O https://raw.githubusercontent.com/rvm/rvm/master/binscripts/rvm-installer.asc</span><br><span class="line"></span><br><span class="line"># Verify the installer signature (might need `gpg2`), and if it validates...</span><br><span class="line">gpg --verify rvm-installer.asc &amp;&amp;</span><br><span class="line"></span><br><span class="line"># Run the installer</span><br><span class="line">bash rvm-installer stable</span><br></pre></td></tr></table></figure>
<p>如果gpg –keyserver命令失败，用如下命令代替:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://rvm.io/mpapis.asc | gpg --import -</span><br></pre></td></tr></table></figure>
<p>如果不出什么错误，RVM已经安装到系统上了，可以使用了。然后，载入 RVM 环境（新开 Termal 就不用这么做了，会自动重新载入的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source ~/.rvm/scripts/rvm</span><br></pre></td></tr></table></figure>
<p>修改 RVM 下载 Ruby 的源，到 Ruby China 的镜像:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;ruby_url=https://cache.ruby-china.org/pub/ruby&quot; &gt; ~/.rvm/user/db</span><br></pre></td></tr></table></figure>
<p>检查一下是否安装正确</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rvm -v</span><br><span class="line">rvm 1.22.17 (stable) by Wayne E. Seguin &lt;wayneeseguin@gmail.com&gt;, Michal Papis &lt;mpapis@gmail.com&gt; [https://rvm.io/]</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-－-用-RVM-安装-Ruby-环境"><a href="#步骤2-－-用-RVM-安装-Ruby-环境" class="headerlink" title="步骤2 － 用 RVM 安装 Ruby 环境"></a>步骤2 － 用 RVM 安装 Ruby 环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rvm requirements</span><br><span class="line">$ rvm install 2.3.0</span><br></pre></td></tr></table></figure>
<p>同样继续等待漫长的下载，编译过程，完成以后，Ruby, Ruby Gems 就安装好了。</p>
<h2 id="步骤3-－-设置-Ruby-版本"><a href="#步骤3-－-设置-Ruby-版本" class="headerlink" title="步骤3 － 设置 Ruby 版本"></a>步骤3 － 设置 Ruby 版本</h2><p>RVM 装好以后，需要执行下面的命令将指定版本的 Ruby 设置为系统默认版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rvm use 2.3.0 --default</span><br></pre></td></tr></table></figure>
<p>同样，也可以用其他版本号，前提是你有用 rvm install 安装过那个版本</p>
<p>这个时候你可以测试是否正确</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ruby -v</span><br><span class="line">ruby 2.3.0 ...</span><br><span class="line"></span><br><span class="line">$ gem -v</span><br><span class="line">2.1.6</span><br><span class="line"></span><br><span class="line">$ gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/</span><br></pre></td></tr></table></figure>
<h3 id="安装-Bundler"><a href="#安装-Bundler" class="headerlink" title="安装 Bundler"></a>安装 Bundler</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem install bundler</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-－-安装-Rails-环境"><a href="#步骤4-－-安装-Rails-环境" class="headerlink" title="步骤4 － 安装 Rails 环境"></a>步骤4 － 安装 Rails 环境</h2><p>上面 3 个步骤过后，Ruby 环境就安装好了，接下来安装 Rails</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem install rails</span><br></pre></td></tr></table></figure>
<p>然后测试安装是否正确</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rails -v</span><br><span class="line">Rails 4.2.5</span><br></pre></td></tr></table></figure>
<p>转载：</p>
<p><a href="https://yq.aliyun.com/articles/24866" target="_blank" rel="noopener">inux下安装ruby版本管理器RVM</a></p>
<p><a href="https://ruby-china.org/wiki/install_ruby_guide" target="_blank" rel="noopener">如何快速正确的安装 Ruby, Rails 运行环境</a></p>
]]></content>
      
        <categories>
            
            <category> redis </category>
            
        </categories>
        
        
        <tags>
            
            <tag> redis </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[jvm虚拟机]]></title>
      <url>/2017/01/11/jvm%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
      <content type="html"><![CDATA[<h1 id="jvm内存概况"><a href="#jvm内存概况" class="headerlink" title="jvm内存概况"></a>jvm内存概况</h1><p>JVM内存包含大致如下：<br><img src="http://i2.51cto.com/images/blog/201802/02/f157091262e858690f68ad993b01e44c.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="jvm内存详解-----详解------详解"></p>
<hr>
<p>Java内存≈Heap(堆内存)+PermGen(方法区)+Thrend(栈)<br>Heap（堆内存）=Young（年轻代）+Old（老年代）</p>
<p>Young（年轻代）=EdenSpace+From Survivor+To Survivor</p>
<h1 id="设置jvm内存关键字"><a href="#设置jvm内存关键字" class="headerlink" title="设置jvm内存关键字"></a>设置jvm内存关键字</h1><table>
<thead>
<tr>
<th>关键字</th>
<th>解释</th>
<th>关键字</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>-Xms</td>
<td>堆内存最小空间</td>
<td>-Xmx</td>
<td>堆内存最大空间</td>
</tr>
<tr>
<td>-XX:NewSize</td>
<td>新生代最小空间</td>
<td>-XX:MaxNewSize</td>
<td>新生代最大空间</td>
</tr>
<tr>
<td>-XX:PermSize</td>
<td>永久带最小空间(方法区)</td>
<td>–XX:MaxPermSize</td>
<td>永久带最大空间（方法区）</td>
</tr>
<tr>
<td>-Xss</td>
<td>设置每个线程栈的大小</td>
<td>-XX:SurvivorRatio</td>
<td>Eden和其中一个Survivor的比值</td>
</tr>
<tr>
<td>-XX:InitialTenuringThreshol</td>
<td>晋升到老年代的对象年龄的最小值</td>
<td>-XX:MaxTenuringThreshold</td>
<td>晋升到老年代的对象年龄的最大值</td>
</tr>
</tbody>
</table>
<p>没有直接设置老年代大小的参数，但是可以通过设置堆内存和新生代内存大大小来计算老年代的大小。jvm中新生代和From survivor和To survivor的比例是8：1：1所以<br>老年代内存大小=堆内存-新生代内存大小-（新生代 x 1/5）<br>从更高的维度来看内存之间的关系会得到如下结论，方法去和堆内存都是所有线程共享的内存区域。而java栈是线程私有的内存空间。</p>
<h1 id="Java堆内存（Heap）解释"><a href="#Java堆内存（Heap）解释" class="headerlink" title="Java堆内存（Heap）解释"></a>Java堆内存（Heap）解释</h1><p>对于大多数应用程序来说，Java堆是Java虚拟机所管理的虚拟内存中最大的一块内存，Java堆是被所有线程共享的一块内存区域。在虚拟机启动时创建，此内存唯一目的是存放对象实例。<br>Java对内存垃圾收集器（GC）的主要工作对象。<br>jvm堆内存的最大空间和最小空间的微妙之处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-Xms指定堆内存初始化分配的空间，如果不指定默认是物理内存的1/64；</span><br><span class="line">-Xmx指定堆内存的最大分配空间，如果不指定默认是无内存的1/4；</span><br><span class="line">默认情况下堆内存可用空间小于40%时候，JVM会增加堆内存到最大内存或物理内存的1/4；</span><br><span class="line">默认情况下堆内存可用空间大于70%时候，JVM会减小堆内存到最小内存或物理内存的1/64;</span><br><span class="line">因此服务器设置的初始化内存和最大内存值为一样，是为了避免GC发生后不断调整堆的大小。建议堆的最大值是可用内存的80%</span><br></pre></td></tr></table></figure>
<p>Java Heap中包括年轻代和老年代，其实还包括一个Permanent。<br>年轻代保存实例化的对象，当该区被填满时，GC会将对象移动到old区。Permanent区负责保存反射对象。</p>
<h2 id="Eden、From-survivor、To-survivor"><a href="#Eden、From-survivor、To-survivor" class="headerlink" title="Eden、From survivor、To survivor"></a>Eden、From survivor、To survivor</h2><p>介绍下堆内存中的Eden、From survivor、To survivor直接微妙的联系</p>
<ol>
<li>我们先来屡屡，为什么需要把堆分代？不分代不能完成他所做的事情么？其实不分代完全可以，分代的唯一理由就是优化GC性能。你先想想，如果没有分代，那我们所有的对象都在一块，GC的时候我们要找到哪些对象没用，这样就会对堆的所有区域进行扫描。而我们的很多对象都是朝生夕死的，如果分代的话，我们把新创建的对象放到某一地方，当GC的时候先把这块存“朝生夕死”对象的区域进行回收，这样就会腾出很大的空间出来。</li>
<li>HotSpot JVM把年轻代分为了三部分：1个Eden区和2个Survivor区（分别叫from和to）。默认比例为8：1,为啥默认会是这个比例，接下来我们会聊到。一般情况下，新创建的对象都会被分配到Eden区(一些大对象特殊处理),这些对象经过第一次Minor GC后，如果仍然存活，将会被移到Survivor区。对象在Survivor区中每熬过一次Minor GC，年龄就会增加1岁，当它的年龄增加到一定程度时，就会被移动到年老代中。</li>
</ol>
<p>因为年轻代中的对象基本都是朝生夕死的(80%以上)，所以在年轻代的垃圾回收算法使用的是复制算法，复制算法的基本思想就是将内存分为两块，每次只用其中一块，当这一块内存用完，就将还活着的对象复制到另外一块上面。复制算法不会产生内存碎片。</p>
<p>在GC开始的时候，对象只会存在于Eden区和名为“From”的Survivor区，Survivor区“To”是空的。紧接着进行GC，Eden区中所有存活的对象都会被复制到“To”，而在“From”区中，仍存活的对象会根据他们的年龄值来决定去向。年龄达到一定值(年龄阈值，可以通过-XX:MaxTenuringThreshold来设置)的对象会被移动到年老代中，没有达到阈值的对象会被复制到“To”区域。经过这次GC后，Eden区和From区已经被清空。这个时候，“From”和“To”会交换他们的角色，也就是新的“To”就是上次GC前的“From”，新的“From”就是上次GC前的“To”。不管怎样，都会保证名为To的Survivor区域是空的。Minor GC会一直重复这样的过程，直到“To”区被填满，“To”区被填满之后，会将所有对象移动到年老代中。<img src="http://i2.51cto.com/images/blog/201802/02/de44f64c1c09f0c69af30571cf645626.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="jvm内存详解-----详解------详解"></p>
<h2 id="一个对象的这一辈子"><a href="#一个对象的这一辈子" class="headerlink" title="一个对象的这一辈子"></a>一个对象的这一辈子</h2><p>我是一个普通的Java对象，我出生在Eden区，在Eden区我还看到和我长的很像的小兄弟，我们在Eden区中玩了挺长时间。有一天Eden区中的人实在是太多了，我就被迫去了Survivor区的“From”区，自从去了Survivor区，我就开始漂了，有时候在Survivor的“From”区，有时候在Survivor的“To”区，居无定所。直到我18岁的时候，爸爸说我成人了，该去社会上闯闯了。于是我就去了年老代那边，年老代里，人很多，并且年龄都挺大的，我在这里也认识了很多人。在年老代里，我生活了20年(每次GC加一岁)，然后被回收。</p>
<h1 id="方法区（PermGen）解释"><a href="#方法区（PermGen）解释" class="headerlink" title="方法区（PermGen）解释"></a>方法区（PermGen）解释</h1><p>各个线程共享的内存区域，用于存储以备虚拟机加载的类信息，常量、静态变量、即时编译器、编译后的代码等数据。又名Non-Heap、永久代。并不是说数据进入永久代就永久存在了。<br>这个区域的回收主要是针对常量池的回收和对类型的写在，一般来说这个区域的回收成绩比较难以令人满意，尤其是类型的卸载条件相当苛刻。<br>jvm非堆内存的最大空间和最小空间的微妙感觉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">方法区用于存放Class和Meta信息，Class在被Load的时候被放入该区域。它和存放类实例的Heap区域不同，GC不会再主程序运行期间对方法去进行GC操作。</span><br><span class="line">-XX：PermSize设置非堆内存初始值，默认是物理内存的1/64;</span><br><span class="line">-XX:MaxPermSize设置非堆内存最大值，默认是物理内存的1/4;</span><br><span class="line">因为对PermGen区的GC回收条件比较苛刻，所以如果你的APP一次性会LOAD很多Class的话，可能会出现PermGen space错误的。</span><br></pre></td></tr></table></figure>
<h1 id="GC线程"><a href="#GC线程" class="headerlink" title="GC线程"></a>GC线程</h1><p>Jvm有2个GC线程，第一个线程负责回收Heap的Young区。第二个线程在Heap不足时，遍历Heap，使Young区升级为Older区，Older区的大小等于堆内存大小减去新生代大小。不能将堆内存最小值设置过大，因为第二个线程被迫运行会降低jvm的性能。<br>频繁发生GC的原因有如下几个原因：</p>
<ul>
<li><p>程序内调用了System.gc()或Runtime.gc()</p>
</li>
<li><p>一些中间件调用自己的GC方法，此时需要设置参数禁止这些GC。</p>
</li>
<li><p>Java的Heap太小，一般默认的Heap值都很小。</p>
</li>
<li><p>频繁实例化对象，Release对象 此时尽量保存并重用对象，例如使用StringBuffer()和String().<br>如果你发现每次GC后，Heap的剩余空间会是总空间的50%，这表示你的Heap处于健康状态，许多Server端的Java程序每次GC后最好能有65%的剩余空间。<br>——–以下是网友经验之谈——-<br>1.Server端Jvm最好将-Xms和-Xmx设为相同值。为了优化GC，最好让-Xmn（新生代）与等于堆最大内存的1/3。<br>2.一个GUI程序最好每10秒到20秒运行一次GC，每次在半秒之内完成。注意</p>
<p>1.增加Heap的大小虽然会降低GC频率，但也增加了每次GC的时间。并且GC运行时，所有的用户线程将暂停，也就是GC期间，Java应用程序不做任何工作。<br>2.Heap大小并不决定进程的内存使用量。进程的内存使用量要大于-Xmx定义的值，因为Java为其他任务分配内存，例如每个线程的Stack等</p>
<p> 内存溢出</p>
<p>弄java得程序员肯定对内存溢出这个不陌生吧，对我来说确实是一个挺无奈的关键字，之前出现这个问题，直接给jvm加内存，可是治标不治本，因为不知道原理，通过近期的研究算是吧jvm的基本机制弄得明白了，来看看jvm内存溢出的几种情况。</p>
<h2 id="OutOfMemoryError：Java-heap-space"><a href="#OutOfMemoryError：Java-heap-space" class="headerlink" title="OutOfMemoryError：Java heap space"></a>OutOfMemoryError：Java heap space</h2><p>这是jvm的堆内存溢出，在jvm中98%的内存都在等待GC回收，且Heap Size不足2%的可用空间时，将抛出此错误，对应的解决办法增加-xmx和-xms的大小。</p>
<ul>
<li><h2 id="OutOfMemoryError：PermGen-Space"><a href="#OutOfMemoryError：PermGen-Space" class="headerlink" title="OutOfMemoryError：PermGen Space"></a>OutOfMemoryError：PermGen Space</h2><p>这是jvm的非堆内存溢出，可能情况有如下几种</p>
</li>
<li><p>如果web app下用大量的第三方jar，其总大小超过非堆内存的最大值，会抛出此异常</p>
</li>
<li><p>项目拥有太多的class文件，恰好maxPermSize设置的小于class总大小，会抛出此异常</p>
</li>
<li><p>tomcat部署的时候，不会清理前面加载的环境，只会将context更改为新部署的代码，所以非堆内存越来越多OutOfMemoryError：unable to new native thread：</p>
<p>这是jvm无法创建新线程，这个错误比较少见，也比较奇怪。主要是jvm与内存的比例有关。这种怪事因为jvm已经被系统分配了大量的内存。并且它至少占用可用内存的一半空间。可以尝试重启tomcat或加大非堆内存对应的值。</p>
</li>
</ul>
</li>
</ul>
<p>转载：<a href="http://blog.51cto.com/xinsir/2068032" target="_blank" rel="noopener">http://blog.51cto.com/xinsir/2068032</a></p>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 复习 </tag>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[mongoDB文档数据库]]></title>
      <url>/2016/10/05/mongoDB%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      <content type="html"><![CDATA[<h1 id="1-MongoDB简介"><a href="#1-MongoDB简介" class="headerlink" title="1.MongoDB简介"></a>1.MongoDB简介</h1><h2 id="1-1什么是MongoDB"><a href="#1-1什么是MongoDB" class="headerlink" title="1.1什么是MongoDB"></a>1.1什么是MongoDB</h2><p>​        MongoDB 是一个跨平台的，面向文档的数据库，是当前 NoSQL 数据库产品中最热门的一种。它介于关系数据库和非关系数据库之间，是非关系数据库当中功能最丰富，最像关系数据库的产品。它支持的数据结构非常松散，是类似JSON  的 BSON 格式，因此可以存储比较复杂的数据类型。</p>
<p>MongoDB 的官方网站地址是：<a href="http://www.mongodb.org/" target="_blank" rel="noopener">http://www.mongodb.org/</a></p>
<h2 id="1-2-MongoDB特点"><a href="#1-2-MongoDB特点" class="headerlink" title="1.2 MongoDB特点"></a>1.2 MongoDB特点</h2><p>​       MongoDB 最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它是一个面向集合的,模式自由的文档型数据库。</p>
<p>具体特点总结如下：</p>
<p>（1）面向集合存储，易于存储对象类型的数据</p>
<p>（2）模式自由</p>
<p>（3）支持动态查询</p>
<p>（4）支持完全索引，包含内部对象</p>
<p>（5）支持复制和故障恢复</p>
<p>（6）使用高效的二进制数据存储，包括大型对象（如视频等）</p>
<p>（7）自动处理碎片，以支持云计算层次的扩展性</p>
<p>（8）支持 Python，PHP，Ruby，Java，C，C#，Javascript，Perl 及 C++语言的驱动程序，社区中也提供了对 Erlang 及.NET 等平台的驱动程序</p>
<p>（9） 文件存储格式为 BSON（一种 JSON 的扩展）</p>
<h2 id="1-3-MongoDB体系结构"><a href="#1-3-MongoDB体系结构" class="headerlink" title="1.3 MongoDB体系结构"></a>1.3 MongoDB体系结构</h2><p>MongoDB 的逻辑结构是一种层次结构。主要由：</p>
<p>文档(document)、集合(collection)、数据库(database)这三部分组成的。逻辑结构是面向用户</p>
<p>的，用户使用 MongoDB 开发应用程序使用的就是逻辑结构。</p>
<p>（1）MongoDB 的文档（document），相当于关系数据库中的一行记录。</p>
<p>（2）多个文档组成一个集合（collection），相当于关系数据库的表。</p>
<p>（3）多个集合（collection），逻辑上组织在一起，就是数据库（database）。</p>
<p>（4）一个 MongoDB 实例支持多个数据库（database）。</p>
<p>文档(document)、集合(collection)、数据库(database)的层次结构如下图:</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image4.png" alt="image4"></p>
<p>下表是MongoDB与MySQL数据库逻辑结构概念的对比</p>
<table>
<thead>
<tr>
<th>MongoDb</th>
<th>关系型数据库Mysql</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据库(databases)</td>
<td>数据库(databases)</td>
</tr>
<tr>
<td>集合(collections)</td>
<td>表(table)</td>
</tr>
<tr>
<td>文档(document)</td>
<td>行(row)</td>
</tr>
</tbody>
</table>
<h1 id="2-基本增删改查操作"><a href="#2-基本增删改查操作" class="headerlink" title="2.基本增删改查操作"></a>2.基本增删改查操作</h1><h2 id="2-1选择或创建数据库"><a href="#2-1选择或创建数据库" class="headerlink" title="2.1选择或创建数据库"></a>2.1选择或创建数据库</h2><p>使用use 数据库名称即可选择数据库，如果该数据库不存在会自动创建</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image12.png" alt="image12"></p>
<h2 id="2-2插入文档"><a href="#2-2插入文档" class="headerlink" title="2.2插入文档"></a>2.2插入文档</h2><p>文档相当于关系数据库中的记录</p>
<p>首先我们定义一个文档变量，格式为变量名称={}; 例如：</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image13.png" alt="image13"></p>
<p>接下来就是将这个变量存入MongoDB </p>
<p>格式为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.save(变量);</span><br></pre></td></tr></table></figure>
<p>这里的集合就相当于关系数据库中的表。例如：</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image14.png" alt="image14"></p>
<p>这样就在student集合中存入文档。如果这个student集合不存在，就会自动创建。</p>
<p>当然，你也可以不用定义变量，直接把变量值放入save方法中也是可以地。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image15.png" alt="image15"></p>
<p>为了方便后期测试，我们再多加点数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.student.save(&#123;name:<span class="string">"沙和尚"</span>,sex:<span class="string">"男"</span>,age:<span class="number">25</span>,address:<span class="string">"流沙河路11号"</span>&#125;);</span><br><span class="line">db.student.save(&#123;name:<span class="string">"唐僧"</span>,sex:<span class="string">"男"</span>,age:<span class="number">35</span>,address:<span class="string">"东土大唐"</span>&#125;);</span><br><span class="line">db.student.save(&#123;name:<span class="string">"白骨精"</span>,sex:<span class="string">"女"</span>,age:<span class="number">18</span>,address:<span class="string">"白骨洞"</span>&#125;);</span><br><span class="line">db.student.save(&#123;name:<span class="string">"白龙马"</span>,sex:<span class="string">"男"</span>,age:<span class="number">20</span>,address:<span class="string">"西海"</span>&#125;);</span><br><span class="line">db.student.save(&#123;name:<span class="string">"哪吒"</span>,sex:<span class="string">"男"</span>,age:<span class="number">15</span>,address:<span class="string">"莲花湾小区"</span>&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="2-3查询集合"><a href="#2-3查询集合" class="headerlink" title="2.3查询集合"></a>2.3查询集合</h2><p>我们要查询某集合的所有文档，使用find()方法。语法格式为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find();</span><br></pre></td></tr></table></figure>
<p>例如，我们要查询student集合中的所有文档：</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image16.png" alt="image16"> </p>
<p>这里你会发现每条文档会有一个叫_id的字段，这个相当于我们原来关系数据库中表的主键，当你在插入文档记录时没有指定该字段，MongDB会自动创建，其类型是ObjectID类型。</p>
<p>如果我们在插入文档记录时指定该字段也可以，其类型可以使ObjectID类型，也可以是MongoDB支持的任意类型. 例如：</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image17.png" alt="image17"></p>
<p>我们再次查询</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image18.png" alt="image18"></p>
<p>如果我想按一定条件来查询，比如我想查询性别为“女”的记录，怎么办？很简单！</p>
<p>只要在find()中添加参数即可，参数也是json格式，如下： </p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image19.png" alt="image19"></p>
<p>为了避免游标可能带来的开销，MongoDB还提供了一个叫findOne()的方法，用来返回结果集的第一条记录。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image20.png" alt="image20"></p>
<p>性别为男的有很多条，这里只返回了第一条记录。</p>
<p>当我们需要返回查询结果的前几条记录时，可以使用limit方法，例如：</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image21.png" alt="image21"></p>
<h2 id="2-4修改文档"><a href="#2-4修改文档" class="headerlink" title="2.4修改文档"></a>2.4修改文档</h2><p>我们要想修改记录，可以使用update方法 .</p>
<p>例如：我向将姓名为孙悟空的学员文档中的age字段值改为31，执行下列语句，看会发生什么？</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image22.png" alt="image22"></p>
<p>再次查询：</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image23.png" alt="image23"></p>
<p>哦，悲剧了~~ 原来的孙悟空的文档只剩下_id 和age两个字段了。</p>
<p>那如何保留其它字段值呢？</p>
<p>我们需要使用MongoDB提供的修改器$set 来实现，请看下列代码。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image24.png" alt="image24"></p>
<p>再次查询，会发现“猪八戒”文档中原有的其它字段还保留下来，而更新age字段也成功了。</p>
<h2 id="2-5删除文档"><a href="#2-5删除文档" class="headerlink" title="2.5删除文档"></a>2.5删除文档</h2><p>删除文档使用remove()方法，格式为：</p>
<p>请慎用remove({}), 它会一条不剩地把你的集合所有文档删的干干净净。</p>
<p>我们现在演示一下，删除name为“哪吒”的记录：</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image25.png" alt="image25"></p>
<p>再次查询，会发现哪吒的文档不见了。</p>
<h1 id="3-高级查询"><a href="#3-高级查询" class="headerlink" title="3.高级查询"></a>3.高级查询</h1><h2 id="3-1模糊查询"><a href="#3-1模糊查询" class="headerlink" title="3.1模糊查询"></a>3.1模糊查询</h2><p>MongoDB的模糊查询是通过正则表达式的方式实现的。格式为：</p>
<p>  /模糊查询字符串/</p>
<p>例如，我要查询student集合中address字段中含有“洞”的所有文档，代码如下：</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image26.png" alt="image26"></p>
<p>如果要查询name字段中以“白”开头的，代码如下：</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image27.png" alt="image27"></p>
<h2 id="3-2-Null值处理"><a href="#3-2-Null值处理" class="headerlink" title="3.2 Null值处理"></a>3.2 Null值处理</h2><p>如果我们想找出集合中某字段值为空的文档，如何查询呢？其实和我们之前的条件查询是一样的，条件值写为null就可以了。</p>
<p>我们现在集合中的文档都是没有空值的，为了方便测试，现在我们将数据做些修改：</p>
<p>将“唐僧”的address改为空</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image28.png" alt="image28"> </p>
<p>再次查询：</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image29.png" alt="image29"></p>
<p>我们会发现不仅会显示“唐僧”这条文档，之前因为修改导致address字段丢失的那条记录也出现了。也就是说，这种查询会查询出该字段为null的以及不存在该字段的文档记录。</p>
<h2 id="3-3大于小于"><a href="#3-3大于小于" class="headerlink" title="3.3大于小于"></a>3.3大于小于</h2><p>&lt;, &lt;=, &gt;, &gt;= 这个操作符也是很常用的，格式如下</p>
<p>db.collection.find({ “field” : { $gt: value } } ); // 大于: field &gt; value</p>
<p>db.collection.find({ “field” : { $lt: value } } ); // 小于: field &lt; value</p>
<p>db.collection.find({ “field” : { $gte: value } } ); // 大于等于: field &gt;= value</p>
<p>db.collection.find({ “field” : { $lte: value } } ); // 小于等于: field &lt;= value</p>
<p>示例：查询年龄大于等于20岁的学员记录</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image30.png" alt="image30"></p>
<h2 id="3-4不等于"><a href="#3-4不等于" class="headerlink" title="3.4不等于"></a>3.4不等于</h2><p>不等于使用$ne操作符。</p>
<p>示例：查询sex字段不为“男”的文档</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image31.png" alt="image31"> </p>
<h2 id="3-5判断字段是否存在"><a href="#3-5判断字段是否存在" class="headerlink" title="3.5判断字段是否存在"></a>3.5判断字段是否存在</h2><p>判断字段是否存在使用$exists操作符。</p>
<p>示例：查询所有含有address字符的文档。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image32.png" alt="image3"></p>
<p>示例：查询所有不含有address字符的文档。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image33.png" alt="image33"></p>
<h2 id="3-6包含与不包含"><a href="#3-6包含与不包含" class="headerlink" title="3.6包含与不包含"></a>3.6包含与不包含</h2><p>包含使用$in操作符。</p>
<p>示例：查询student集合中age字段包含20,25,30的文档</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image34.png" alt="image34"></p>
<p>示例：查询student集合中age字段不包含20,25,30的文档</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image35.png" alt="image35"></p>
<h2 id="3-7统计记录条数"><a href="#3-7统计记录条数" class="headerlink" title="3.7统计记录条数"></a>3.7统计记录条数</h2><p>统计记录条件使用count()方法。</p>
<p>示例：查询student集合的文档条数。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image36.png" alt="image36"></p>
<p>示例：查询student集合中age字段小于等于20的文档条数。</p>
<p><img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image37.png" alt="image37"> </p>
<h2 id="3-8条件连接–并且"><a href="#3-8条件连接–并且" class="headerlink" title="3.8条件连接–并且"></a>3.8条件连接–并且</h2><p>我们如果需要查询同时满足两个以上条件，需要使用$and操作符将条件进行关联。（相当于SQL的and）</p>
<p>格式为：$and:[ {  },{  },{   } ]</p>
<p>示例：查询student集合中age大于等于20 并且age小于30的文档</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image38.png" alt="image38"></p>
<h2 id="3-9-条件连接–或者"><a href="#3-9-条件连接–或者" class="headerlink" title="3.9 条件连接–或者"></a>3.9 条件连接–或者</h2><p>如果两个以上条件之间是或者的关系，我们使用$or操作符进行关联，与前面$and的使用方式相同</p>
<p>格式为：$or:[ {  },{  },{   } ]</p>
<p>示例：查询student集合中sex为女，或者年龄小于20的文档记录</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image39.png" alt="image39"></p>
<h1 id="4-java连接MongoDB"><a href="#4-java连接MongoDB" class="headerlink" title="4.java连接MongoDB"></a>4.java连接MongoDB</h1><h2 id="4-1查询文档"><a href="#4-1查询文档" class="headerlink" title="4.1查询文档"></a>4.1查询文档</h2><h2 id="4-1-1查询全部记录"><a href="#4-1-1查询全部记录" class="headerlink" title="4.1.1查询全部记录"></a>4.1.1查询全部记录</h2><p>（1）创建maven工程mongoDBDemo ，引入依赖。 </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mongodb&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mongodb-driver&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.4.1&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<p>（2）编写代码，遍历student集合所有数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MongoClient client=<span class="keyword">new</span> MongoClient();<span class="comment">//创建连接对象</span></span><br><span class="line">MongoDatabase database = client.getDatabase(<span class="string">"itcastdb"</span>);<span class="comment">//获取数据库		</span></span><br><span class="line">MongoCollection&lt;Document&gt; collection = database.getCollection(<span class="string">"student"</span>);<span class="comment">//获取集合</span></span><br><span class="line">		</span><br><span class="line">FindIterable&lt;Document&gt; list = collection.find();<span class="comment">//获取文档集合</span></span><br><span class="line"><span class="keyword">for</span>( Document doc: list)&#123;<span class="comment">//遍历集合中的文档输出数据</span></span><br><span class="line">	System.out.println(<span class="string">"name:"</span>+ doc.getString(<span class="string">"name"</span>) );</span><br><span class="line">	System.out.println(<span class="string">"sex:"</span>+ doc.getString(<span class="string">"sex"</span>) );</span><br><span class="line">	System.out.println(<span class="string">"age:"</span>+ doc.getDouble(<span class="string">"age"</span>) );<span class="comment">//默认为浮点型</span></span><br><span class="line">	System.out.println(<span class="string">"address:"</span>+ doc.getString(<span class="string">"address"</span>) );</span><br><span class="line">	System.out.println(<span class="string">"--------------------------"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MongoDB的数字类型默认使用64位浮点型数值。{“x”：3.14}或{“x”：3}。对于整型值，可以使用NumberInt（4字节符号整数），{“x”:NumberInt(“3”)}  或NumberLong（8字节符号整数）{“x”:NumberLong(“3”)}</p>
<h2 id="4-1-2匹配查询"><a href="#4-1-2匹配查询" class="headerlink" title="4.1.2匹配查询"></a>4.1.2匹配查询</h2><p>MongoDB使用BasicDBObject类型封装查询条件，构造方法的参数为key 和value .</p>
<p>示例：查询student集合中name为猪八戒的文档</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构建查询条件</span></span><br><span class="line">BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(<span class="string">"name"</span>, <span class="string">"猪八戒"</span>);		</span><br><span class="line">FindIterable&lt;Document&gt; list = collection.find(bson);<span class="comment">//获取文档集合</span></span><br><span class="line"><span class="comment">//....遍历集合</span></span><br></pre></td></tr></table></figure>
<h2 id="4-1-3模糊查询"><a href="#4-1-3模糊查询" class="headerlink" title="4.1.3模糊查询"></a>4.1.3模糊查询</h2><p>构建模糊查询条件是通过正则表达式的方式来实现的</p>
<p>（1）完全匹配Pattern pattern = Pattern.compile(“^name$”);</p>
<p>（2）右匹配Pattern pattern = Pattern.compile(“^.*name$”);</p>
<p>（3）左匹配Pattern pattern = Pattern.compile(“^name.*$”);</p>
<p>（4）模糊匹配Pattern pattern = Pattern.compile(“^.<em>name.</em>$”);</p>
<p>示例：模糊查询student集合中address 中含有洞的文档记录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模糊查询：like %洞%</span></span><br><span class="line">Pattern queryPattern = Pattern.compile(<span class="string">"^.*洞.*$"</span>);</span><br><span class="line">BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(<span class="string">"address"</span>, queryPattern);	</span><br><span class="line">FindIterable&lt;Document&gt; list = collection.find(bson);<span class="comment">//获取文档集合</span></span><br><span class="line"><span class="comment">//....遍历集合</span></span><br></pre></td></tr></table></figure>
<h2 id="4-1-4大于小于"><a href="#4-1-4大于小于" class="headerlink" title="4.1.4大于小于"></a>4.1.4大于小于</h2><p>在MongoDB提示符下条件json字符串为{ age: { $lt :20 } } ，对应的java代码也是BasicDBObject 的嵌套。</p>
<p>示例：查询student集合中age小于20的文档记录 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询年龄小于20的		</span></span><br><span class="line">BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(<span class="string">"age"</span>, <span class="keyword">new</span> BasicDBObject(<span class="string">"$lt"</span>,<span class="number">20</span>));</span><br><span class="line">FindIterable&lt;Document&gt; list = collection.find(bson);<span class="comment">//获取文档集</span></span><br><span class="line"><span class="comment">//....遍历集合</span></span><br></pre></td></tr></table></figure>
<h2 id="4-1-5条件连接–并且"><a href="#4-1-5条件连接–并且" class="headerlink" title="4.1.5条件连接–并且"></a>4.1.5条件连接–并且</h2><p>示例：查询年龄大于等于20并且小于30的文档记录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询年龄大于等于20的			</span></span><br><span class="line">BasicDBObject bson1=<span class="keyword">new</span> BasicDBObject(<span class="string">"age"</span>, <span class="keyword">new</span> BasicDBObject(<span class="string">"$gte"</span>,<span class="number">20</span>));</span><br><span class="line"><span class="comment">//查询年龄小于30的</span></span><br><span class="line">BasicDBObject bson2=<span class="keyword">new</span> BasicDBObject(<span class="string">"age"</span>, <span class="keyword">new</span> BasicDBObject(<span class="string">"$lt"</span>,<span class="number">30</span>));</span><br><span class="line"><span class="comment">//构建查询条件and</span></span><br><span class="line">BasicDBObject bson=<span class="keyword">new</span>  BasicDBObject(<span class="string">"$and"</span>, Arrays.asList(bson1,bson2)  );</span><br></pre></td></tr></table></figure>
<h2 id="4-1-6条件连接–或者"><a href="#4-1-6条件连接–或者" class="headerlink" title="4.1.6条件连接–或者"></a>4.1.6条件连接–或者</h2><p>示例：查询年龄小于等于20或者性别为女的文档记录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BasicDBObject bson1=<span class="keyword">new</span> BasicDBObject(<span class="string">"age"</span>, <span class="keyword">new</span> BasicDBObject(<span class="string">"$lte"</span>,<span class="number">20</span>));		</span><br><span class="line">BasicDBObject bson2=<span class="keyword">new</span> BasicDBObject(<span class="string">"sex"</span>, <span class="string">"女"</span>);</span><br><span class="line"><span class="comment">//构建查询条件or</span></span><br><span class="line">BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(<span class="string">"$or"</span>, Arrays.asList( bson1, bson2 )  );</span><br></pre></td></tr></table></figure>
<h2 id="4-2增加文档"><a href="#4-2增加文档" class="headerlink" title="4.2增加文档"></a>4.2增加文档</h2><p>我们使用insertOne方法来插入文档。</p>
<p>示例：添加文档记录–名称：铁扇公主  性别:女 年龄：28   地址：芭蕉洞</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取连接</span></span><br><span class="line">MongoClient client=<span class="keyword">new</span> MongoClient();</span><br><span class="line"><span class="comment">//得到数据库</span></span><br><span class="line">MongoDatabase database = client.getDatabase(<span class="string">"itcastdb"</span>);</span><br><span class="line"><span class="comment">//得到集合封装对象</span></span><br><span class="line">MongoCollection&lt;Document&gt; collection = database.getCollection(<span class="string">"student"</span>);</span><br><span class="line">Map&lt;String, Object&gt; map=<span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="string">"name"</span>, <span class="string">"铁扇公主"</span>);</span><br><span class="line">map.put(<span class="string">"sex"</span>, <span class="string">"女"</span>);</span><br><span class="line">map.put(<span class="string">"age"</span>, <span class="number">35.0</span>);</span><br><span class="line">map.put(<span class="string">"address"</span>, <span class="string">"芭蕉洞"</span>);		</span><br><span class="line">Document doc=<span class="keyword">new</span> Document(map);		</span><br><span class="line">collection.insertOne(doc);<span class="comment">//插入一条记录</span></span><br><span class="line"><span class="comment">//collection.insertMany(documents);//一次性插入多条文档</span></span><br></pre></td></tr></table></figure>
<h2 id="4-3删除文档"><a href="#4-3删除文档" class="headerlink" title="4.3删除文档"></a>4.3删除文档</h2><p>示例：将名称为铁扇公主的文档删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取连接</span></span><br><span class="line">MongoClient client=<span class="keyword">new</span> MongoClient();</span><br><span class="line"><span class="comment">//得到数据库</span></span><br><span class="line">MongoDatabase database = client.getDatabase(<span class="string">"itcastdb"</span>);</span><br><span class="line"><span class="comment">//得到集合封装对象</span></span><br><span class="line">MongoCollection&lt;Document&gt; collection = database.getCollection(<span class="string">"student"</span>);</span><br><span class="line">BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(<span class="string">"name"</span>, <span class="string">"铁扇公主"</span>);</span><br><span class="line">collection.deleteOne(bson);<span class="comment">//删除记录（符合条件的第一条记录）</span></span><br><span class="line"><span class="comment">//collection.deleteMany(bson);//删除符合条件的全部记录</span></span><br></pre></td></tr></table></figure>
<h2 id="4-4修改文档"><a href="#4-4修改文档" class="headerlink" title="4.4修改文档"></a>4.4修改文档</h2><p>示例：将红孩儿的地址修改为“南海”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取连接</span></span><br><span class="line">MongoClient client=<span class="keyword">new</span> MongoClient();</span><br><span class="line"><span class="comment">//得到数据库</span></span><br><span class="line">MongoDatabase database = client.getDatabase(<span class="string">"itcastdb"</span>);</span><br><span class="line"><span class="comment">//得到集合封装对象</span></span><br><span class="line">MongoCollection&lt;Document&gt; collection = database.getCollection(<span class="string">"student"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改的条件</span></span><br><span class="line">BasicDBObject bson= <span class="keyword">new</span> BasicDBObject(<span class="string">"name"</span>, <span class="string">"红孩儿"</span>);</span><br><span class="line"><span class="comment">//修改后的值</span></span><br><span class="line">BasicDBObject bson2 = <span class="keyword">new</span> BasicDBObject(<span class="string">"$set"</span>,<span class="keyword">new</span> BasicDBObject(<span class="string">"address"</span>, <span class="string">"南海"</span>));</span><br><span class="line"><span class="comment">//参数1：修改条件  参数2：修改后的值</span></span><br><span class="line">collection.updateOne(bson, bson2);</span><br><span class="line"><span class="comment">//collection.updateMany(filter, update);//修改符合条件的所有记录</span></span><br></pre></td></tr></table></figure>
<p>updateMany方法用于修改符合条件的所有记录</p>
<p>updateOne方法用于修改符合条件的第一条记录</p>
<h1 id="5-MongoDB连接池"><a href="#5-MongoDB连接池" class="headerlink" title="5.MongoDB连接池"></a>5.MongoDB连接池</h1><h2 id="5-1代码实现"><a href="#5-1代码实现" class="headerlink" title="5.1代码实现"></a>5.1代码实现</h2><p>MongoClient 被设计为线程安全的类，也就是我们在使用该类时不需要考虑并发的情况，这样我们可以考虑把MongoClient 做成一个静态变量，为所有线程公用，不必每次都销毁。这样可以极大提高执行效率。实际上，这是MongoDB提供的内置的连接池来实现的。    </p>
<p>​    首先我们先创建一个“管理类”，相当于我们原来的BaseDao </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.haha.demo;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClient;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClientOptions;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClientOptions.Builder;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.WriteConcern;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> MongoClient mongoClient=<span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//对mongoClient初始化</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;		</span><br><span class="line">		mongoClient=<span class="keyword">new</span> MongoClient();	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MongoDatabase <span class="title">getDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(mongoClient==<span class="keyword">null</span>)&#123;</span><br><span class="line">			init();</span><br><span class="line">		&#125;		</span><br><span class="line">		<span class="keyword">return</span> mongoClient.getDatabase(<span class="string">"itcastdb"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​    然后我们创建一个StudentDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.haha.demo;</span><br><span class="line"><span class="keyword">import</span> org.bson.Document;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoCollection;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 学员数据访问层</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String name,String sex,<span class="keyword">double</span> age,String address)</span></span>&#123;</span><br><span class="line">		MongoDatabase database = MongoManager.getDatabase();</span><br><span class="line">		MongoCollection&lt;Document&gt; collection = database.getCollection(<span class="string">"student2"</span>);</span><br><span class="line">		Document docment=<span class="keyword">new</span> Document();</span><br><span class="line">		docment.put(<span class="string">"name"</span>, name);</span><br><span class="line">		docment.put(<span class="string">"sex"</span>, sex);		</span><br><span class="line">		docment.put(<span class="string">"age"</span>, age);</span><br><span class="line">		docment.put(<span class="string">"address"</span>, address);</span><br><span class="line">		collection.insertOne(docment);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们现在做个测试，循环插入2万条数据，看看执行时间是多长时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.haha.demo;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">long</span> startTime = <span class="keyword">new</span> Date().getTime();<span class="comment">//开始时间</span></span><br><span class="line">		</span><br><span class="line">		StudentDao studentDao=<span class="keyword">new</span> StudentDao();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20000</span>;i++)&#123;</span><br><span class="line">			studentDao.save(<span class="string">"测试"</span>+i, <span class="string">"男"</span>, <span class="number">25.0</span>, <span class="string">"测试地址"</span>+i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> endTime = <span class="keyword">new</span> Date().getTime();<span class="comment">//完成时间</span></span><br><span class="line">		System.out.println(<span class="string">"完成时间："</span>+(endTime-startTime)+<span class="string">"毫秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过测试：所用毫秒数为3589 </p>
<h2 id="5-2参数设置"><a href="#5-2参数设置" class="headerlink" title="5.2参数设置"></a>5.2参数设置</h2><p>我们在刚才的代码基础上进行连接池参数的设置</p>
<p>修改MongoManager的init方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对mongoClient初始化</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//连接池选项</span></span><br><span class="line">		Builder builder = <span class="keyword">new</span> MongoClientOptions.Builder();<span class="comment">//选项构建者	</span></span><br><span class="line">		builder.connectTimeout(<span class="number">5000</span>);<span class="comment">//设置连接超时时间</span></span><br><span class="line">		builder.socketTimeout(<span class="number">5000</span>);<span class="comment">//读取数据的超时时间</span></span><br><span class="line">		builder.connectionsPerHost(<span class="number">30</span>);<span class="comment">//每个地址最大请求数		</span></span><br><span class="line">		builder.writeConcern(WriteConcern.NORMAL);<span class="comment">//写入策略，仅抛出网络异常</span></span><br><span class="line">		MongoClientOptions options = builder.build();</span><br><span class="line">		mongoClient=<span class="keyword">new</span> MongoClient(<span class="string">"127.0.0.1"</span>,options);	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次进行测试：所用的毫秒1544</p>
<p>下面是写入策略。</p>
<p>WriteConcern.NONE:没有异常抛出</p>
<p>WriteConcern.NORMAL:仅抛出网络错误异常，没有服务器错误异常</p>
<p>WriteConcern.SAFE:抛出网络错误异常、服务器错误异常；并等待服务器完成写操作。</p>
<p>WriteConcern.MAJORITY: 抛出网络错误异常、服务器错误异常；并等待一个主服务器完成写操作。</p>
<p>WriteConcern.FSYNC_SAFE: 抛出网络错误异常、服务器错误异常；写操作等待服务器将数据刷新到磁盘。</p>
<p>WriteConcern.JOURNAL_SAFE:抛出网络错误异常、服务器错误异常；写操作等待服务器提交到磁盘的日志文件。</p>
<p>WriteConcern.REPLICAS_SAFE:抛出网络错误异常、服务器错误异常；等待至少2台服务器完成写操作。</p>
<h1 id="6-综合案例-《网站点击日志分析组件》"><a href="#6-综合案例-《网站点击日志分析组件》" class="headerlink" title="6.综合案例-《网站点击日志分析组件》"></a>6.综合案例-《网站点击日志分析组件》</h1><h1 id="6-1需求分析"><a href="#6-1需求分析" class="headerlink" title="6.1需求分析"></a>6.1需求分析</h1><p>《花生二手车》交易网站日访问IP高达2万+ ，每秒点击频率在2000次左右。为了能够对访问用户的行为做进一步的分析，产品部提出需求，用户每次点击浏览二手车都要记录该用户ID、访问IP、访问时间、点击车型、点击商品ID、价格等信息。</p>
<p> <img src="https://mrblogimgs.oss-cn-qingdao.aliyuncs.com/img/MongoDB/image40.png" alt="image40"></p>
<h2 id="6-2数据库设计"><a href="#6-2数据库设计" class="headerlink" title="6.2数据库设计"></a>6.2数据库设计</h2><p>浏览日志browseLog</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段类型</th>
<th>字段含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>userid</td>
<td>字符</td>
<td>用户ID</td>
</tr>
<tr>
<td>ip</td>
<td>字符</td>
<td>访问IP</td>
</tr>
<tr>
<td>browseTime</td>
<td>时间</td>
<td>访问时间</td>
</tr>
<tr>
<td>model</td>
<td>字符</td>
<td>点击车型</td>
</tr>
<tr>
<td>goodsid</td>
<td>字符</td>
<td>点击商品ID</td>
</tr>
<tr>
<td>price</td>
<td>数值</td>
<td>价格</td>
</tr>
<tr>
<td>remark</td>
<td>字符</td>
<td>备注</td>
</tr>
</tbody>
</table>
<h2 id="6-3日志写入"><a href="#6-3日志写入" class="headerlink" title="6.3日志写入"></a>6.3日志写入</h2><p>（1）创建工程sitelog ，在pom.xml中引入依赖。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">   &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;org.mongodb&lt;/groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;mongodb-driver&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;3.4.1&lt;/version&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br><span class="line"> &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<p>（2）在src/main/resources 添加配置文件sitelog.properties</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">host=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">port=<span class="number">27017</span></span><br></pre></td></tr></table></figure>
<p>这个配置文件用于配置主机地址和端口</p>
<p>（3）创建包com.huasheng.sitelog，建立Config 类，用于读取配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huasheng.sitelog;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span>&#123;			</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Properties p=<span class="keyword">new</span> Properties();</span><br><span class="line">			InputStream input=Config.class.getResourceAsStream(<span class="string">"/sitelog.propertis"</span>);</span><br><span class="line">			p.load(input);</span><br><span class="line">			host=p.getProperty(<span class="string">"host"</span>);</span><br><span class="line">			port=Integer.parseInt( p.getProperty(<span class="string">"port"</span>));</span><br><span class="line">			input.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="comment">//加载		</span></span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String host;<span class="comment">//主机地址</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> port;<span class="comment">//端口</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> host;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getPort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> port;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）创建管理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huasheng.sitelog;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClient;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClientOptions;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClientOptions.Builder;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.ServerAddress;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.WriteConcern;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mongo数据库连接管理类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoManager</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> MongoClient mongoClient=<span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建一个选项构造器</span></span><br><span class="line">		Builder builder = <span class="keyword">new</span> MongoClientOptions.Builder();</span><br><span class="line">		builder.connectTimeout(<span class="number">5000</span>);<span class="comment">//设置连接超时时间</span></span><br><span class="line">		builder.socketTimeout(<span class="number">5000</span>);<span class="comment">//读取数据的超时时间</span></span><br><span class="line">		builder.connectionsPerHost(<span class="number">30</span>);<span class="comment">//设置每个地址最大连接数</span></span><br><span class="line">		builder.writeConcern(WriteConcern.NORMAL);<span class="comment">//设置写入策略  ,只有网络异常才会抛出</span></span><br><span class="line">		<span class="comment">//得到选项封装</span></span><br><span class="line">		MongoClientOptions options = builder.build();		</span><br><span class="line">		mongoClient=<span class="keyword">new</span> MongoClient(<span class="keyword">new</span> ServerAddress(Config.getHost(), Config.getPort()),options);		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MongoDatabase <span class="title">getDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(mongoClient==<span class="keyword">null</span>)&#123;</span><br><span class="line">			init();</span><br><span class="line">		&#125;		</span><br><span class="line">		<span class="keyword">return</span> mongoClient.getDatabase(<span class="string">"itcastdb"</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（5）日志工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huasheng.sitelog;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.bson.Document;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoCollection;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 站点日志数据工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SiteLogUtil</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 写入日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> logname 日志名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> map 日志数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String logname,Map&lt;String, Object&gt; map)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		MongoDatabase database = MongoManager.getDatabase();</span><br><span class="line">		MongoCollection&lt;Document&gt; collection = database.getCollection(logname);</span><br><span class="line">		Document doc=<span class="keyword">new</span> Document(map);		</span><br><span class="line">		collection.insertOne(doc);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（6）编写测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Map map=<span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="string">"userid"</span>, <span class="string">"8888"</span>);</span><br><span class="line">map.put(<span class="string">"ip"</span>, <span class="string">"188.188.200.2"</span>);</span><br><span class="line">map.put(<span class="string">"browseTime"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">map.put(<span class="string">"model"</span>, <span class="string">"大众"</span>);</span><br><span class="line">map.put(<span class="string">"goodsid"</span>, <span class="string">"123123"</span>);</span><br><span class="line">map.put(<span class="string">"price"</span>, <span class="number">15.3</span>);</span><br><span class="line">map.put(<span class="string">"remark"</span>, <span class="string">"八成新，贱卖了"</span>);</span><br><span class="line">SiteLogUtil.save(<span class="string">"browseLog"</span>, map);<span class="comment">//存入日志</span></span><br></pre></td></tr></table></figure>
<h2 id="6-4日志查询"><a href="#6-4日志查询" class="headerlink" title="6.4日志查询"></a>6.4日志查询</h2><h2 id="6-4-1条件查询"><a href="#6-4-1条件查询" class="headerlink" title="6.4.1条件查询"></a>6.4.1条件查询</h2><p>（1）在SiteLogUtil类中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 按条件查询</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> logName</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> FindIterable&lt;Document&gt; <span class="title">list</span><span class="params">(String logName,Map&lt;String, Object&gt; map)</span></span>&#123;</span><br><span class="line">		MongoDatabase database = MongoManager.getDatabase();</span><br><span class="line">		MongoCollection&lt;Document&gt; collection = database.getCollection(logName);</span><br><span class="line">		BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(map);<span class="comment">//构建查询条件			</span></span><br><span class="line">		<span class="keyword">return</span> collection.find(bson);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>（2）编写测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map =<span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="string">"userid"</span>, <span class="string">"8888"</span>);		</span><br><span class="line">FindIterable&lt;Document&gt; list = SiteLogUtil.list(<span class="string">"browseLog"</span>, map);</span><br><span class="line">String json = JSON.serialize(list);</span><br><span class="line">System.out.println(json);</span><br></pre></td></tr></table></figure>
<h2 id="6-4-2分页查询"><a href="#6-4-2分页查询" class="headerlink" title="6.4.2分页查询"></a>6.4.2分页查询</h2><p>（1）在SiteLogUtil类中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询日志</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> logName 日志名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map 条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageIndex 页码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize 页大小</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Object&gt; <span class="title">listPage</span><span class="params">(String logName,Map&lt;String, Object&gt; map,<span class="keyword">int</span> pageIndex,<span class="keyword">int</span> pageSize)</span></span>&#123;</span><br><span class="line">	MongoDatabase database = MongoManager.getDatabase();</span><br><span class="line">	MongoCollection&lt;Document&gt; collection = database.getCollection(logName);		</span><br><span class="line">	BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(map);<span class="comment">//构建查询条件			</span></span><br><span class="line">	FindIterable&lt;Document&gt; find = collection.find(bson);</span><br><span class="line">	<span class="keyword">int</span> skip= (pageIndex-<span class="number">1</span>)*pageSize;</span><br><span class="line">	find.skip( skip);<span class="comment">//跳过记录数</span></span><br><span class="line">	find.limit(pageSize);<span class="comment">//一页查询记录数</span></span><br><span class="line">	<span class="comment">//&#123; total:x,rows:[]  &#125;</span></span><br><span class="line">	<span class="keyword">long</span> count = collection.count(bson);</span><br><span class="line">	Map&lt;String,Object&gt; m=<span class="keyword">new</span> HashMap();</span><br><span class="line">	m.put(<span class="string">"total"</span>, count);</span><br><span class="line">	m.put(<span class="string">"rows"</span>, find);</span><br><span class="line">	<span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）添加测试数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++)&#123;</span><br><span class="line">	</span><br><span class="line">	Map&lt;String, Object&gt; map=<span class="keyword">new</span> HashMap();</span><br><span class="line">	map.put(<span class="string">"userid"</span>, <span class="string">"900"</span>+i);<span class="comment">//用户ID</span></span><br><span class="line">	map.put(<span class="string">"ip"</span>, <span class="string">"121.211.112.212"</span>);</span><br><span class="line">	map.put(<span class="string">"browseTime"</span>, <span class="keyword">new</span> Date());<span class="comment">//浏览时间</span></span><br><span class="line">	map.put(<span class="string">"model"</span>, <span class="string">"大众"</span>+i);<span class="comment">//型号</span></span><br><span class="line">	map.put(<span class="string">"goodsid"</span>, <span class="string">"123456"</span>);<span class="comment">//商品ID</span></span><br><span class="line">	map.put(<span class="string">"price"</span>, <span class="number">11.8</span>);<span class="comment">//价格</span></span><br><span class="line">	map.put(<span class="string">"remark"</span>, <span class="string">"八成新，快来买吧"</span>);</span><br><span class="line">	</span><br><span class="line">	SiteLogUtil.save(<span class="string">"browseLog"</span>, map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）编写测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map=<span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="string">"goodsid"</span>, <span class="string">"123456"</span>);</span><br><span class="line">Map&lt;String, Object&gt; m = SiteLogUtil.listPage(<span class="string">"browseLog"</span>, map, <span class="number">2</span>, <span class="number">10</span>);</span><br><span class="line">String json = JSON.serialize(m);</span><br><span class="line">System.out.println(json);</span><br></pre></td></tr></table></figure>
<p>使用Maven 的package命令进行打包。</p>
<p>创建WEB工程，引入jar包，调用此方法即可实现日志查询。代码略。</p>
]]></content>
      
        <categories>
            
            <category> 数据库 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> mongoDB </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
